var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,a=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;import{p as l,a as c,e as r,o as i,f as d,g as p,i as u,q as g,a9 as y,j as f,w as v,u as h,r as C,d as I,x as _,y as b,t as k,k as x,F as L,h as w,aa as $,m as O}from"./vendor.55e40976.js";const R={name:"replyComment",components:{},props:["params"],data:()=>({msg:"",maxLen:140}),computed:{},methods:{subReplyComment(){this.$emit("replyMsg",this.msg)}},watch:{msg(){this.msg=this.maxLen>=this.msg?this.msg:this.msg.substring(0,this.maxLen)}}},j=v();l("data-v-0389d02b");const M={class:"reply-comment"},D={class:"comment_textarea"},P={class:"pre"},B={class:"comment_box_footer"},S={class:"comment_limit"},q={class:"num"},E=f("评论");c();const U=j(((e,t,s,n,o,m)=>{const a=r("el-button");return i(),d("div",M,[p("h3",null,"我回复@"+u(s.params.user.nickname)+":",1),p("div",D,[p("div",P,u(o.msg),1),g(p("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"期待你的神评论……","onUpdate:modelValue":t[1]||(t[1]=e=>o.msg=e)},null,512),[[y,o.msg]])]),p("div",B,[p("span",S,[p("em",q,u(o.msg.length),1),f("/"+u(o.maxLen),1)]),p(a,{type:"primary",size:"mini",round:"",onClick:m.subReplyComment},{default:j((()=>[E])),_:1},8,["onClick"])])])}));R.render=U,R.__scopeId="data-v-0389d02b";const H={name:"Comments",components:{ReplyComment:R},props:{sId:{type:[Number,String],default:0},type:{type:Number,default:0}},setup(e){const{proxy:l}=O(),c=h(),r=C({msg:"",maxLen:140,curId:e.sId,limit:20,offset:0,before:0,hotComments:[],comments:[],total:0,currentPage:0,isEmpty:!1,replyCommentId:0,replyIndex:-1}),i=I((()=>c.getters.userInfo)),d=I((()=>c.getters.isLogin)),p=I((()=>function(e,t){return e.commentId===r.replyCommentId&&r.replyIndex===t})),u=()=>{switch(e.type){case 0:g("commentSong");break;case 1:g("commentMv");break;case 3:g("albumComment");break;case 5:g("commentVideo")}},g=async e=>{const{data:t}=await l.$http[e]({id:r.curId,limit:r.limit,offset:r.offset,before:r.before,timestamp:(new Date).valueOf()});y(t)},y=e=>{if(200!==e.code)return l.$msg.error("数据请求失败");r.total=e.total,r.hotComments=e.hotComments||[],r.hotComments.map((e=>(e.isHot=!0,e))),r.comments=[...r.hotComments,...e.comments],r.isEmpty=0===r.before&&!r.comments.length},f=async(t,s,n)=>{const o={t:t,type:e.type,id:r.curId,content:s,commentId:n},{data:m}=await l.$http.comment(o);if(200!==m.code)return l.$msg.error("数据请求失败");r.msg="",u(),0===t?l.$msg.success("删除评论成功！"):1===t?l.$msg.success("评论成功！"):2===t&&(l.$msg.success("回复评论成功！"),r.replyCommentId=0,r.replyIndex=-1)};return _((()=>{u()})),b((()=>e.sId),((e,t)=>{r.curId=e,r.offset=0,u()})),b((()=>r.msg),(()=>{r.msg=r.maxLen>=r.msg?r.msg:r.msg.substring(0,r.maxLen)})),v=((e,t)=>{for(var s in t||(t={}))o.call(t,s)&&a(e,s,t[s]);if(n)for(var s of n(t))m.call(t,s)&&a(e,s,t[s]);return e})({},k(r)),t(v,s({userInfo:i,isLogin:d,subComment:async()=>{d.value?f(1,r.msg):c.commit("setLoginDialog",!0)},delComment:e=>{l.$msgBox.confirm("确定删除评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",center:!0}).then((()=>{f(0,"",e.commentId)})).catch((()=>{}))},replyMsg:e=>{d.value?f(2,e,r.replyCommentId):c.commit("setLoginDialog",!0)},replyComment:(e,t)=>{d.value?(r.replyCommentId=r.replyCommentId===e.commentId&&r.replyIndex===t?0:e.commentId,r.replyIndex=t):c.commit("setLoginDialog",!0)},likeComment:async t=>{if(!d.value)return void c.commit("setLoginDialog",!0);const{data:s}=await l.$http.commentLike({id:r.curId,cid:t.commentId,t:Number(!t.liked),type:e.type});if(200!==s.code)return l.$msg.error("数据请求失败");u()},isShowReply:p,currentChange:e=>{r.offset=(e-1)*r.limit}}));var v}},N=v();l("data-v-1c9ca5d5");const T={class:"comments"},V={class:"comment_hd"},z=f("评论"),J={key:0,class:"userInfo"},F=p("div",{slot:"placeholder",class:"image-slot"},[p("i",{class:"iconfont icon-placeholder"})],-1),A={class:"comment_textarea"},G={class:"pre"},K={class:"comment_box_footer"},Q=f("评论"),W={class:"comment_limit"},X={class:"num"},Y={class:"comment_area"},Z=p("div",{slot:"placeholder",class:"image-slot"},[p("i",{class:"iconfont icon-placeholder"})],-1),ee={class:"comment_info"},te={class:"comment_content"},se={class:"comment_footer"},ne={class:"comment_time"},oe={class:"comment_oper"},me=p("i",{class:"iconfont icon-del"},null,-1),ae=p("i",{class:"iconfont icon-praise"},null,-1),le=p("i",{class:"iconfont icon-comment"},null,-1),ce={key:0,class:"isHot"},re=p("i",{class:"iconfont icon-choicest"},null,-1),ie={class:"pagination"},de={key:1,class:"comments_status"},pe={key:0,class:"loading"},ue={key:1,class:"empty"},ge=p("p",null,[p("i",{class:"iconfont icon-empty-main"})],-1),ye=p("p",null,"暂无留言",-1);c();const fe=N(((e,t,s,n,o,m)=>{const a=r("el-image"),l=r("el-button"),c=r("el-form"),v=r("router-link"),h=r("reply-comment"),C=r("el-pagination");return i(),d("div",T,[p("div",V,[p("h2",null,[z,p("em",null,"共"+u(e.total)+"条评论",1)]),n.userInfo?(i(),d("div",J,[p("span",null,u(n.userInfo.nickname),1),p(a,{src:n.userInfo.avatarUrl,class:"avatar"},{default:N((()=>[F])),_:1},8,["src"])])):x("",!0)]),p(c,{class:"comment_box"},{default:N((()=>[p("div",A,[p("div",G,u(e.msg),1),g(p("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"期待你的神评论……","onUpdate:modelValue":t[1]||(t[1]=t=>e.msg=t)},null,512),[[y,e.msg]])]),p("div",K,[p(l,{type:"primary",size:"mini",onClick:n.subComment},{default:N((()=>[Q])),_:1},8,["onClick"]),p("span",W,[p("em",X,u(e.msg.length),1),f("/"+u(e.maxLen),1)])])])),_:1}),p("div",Y,[e.comments.length?(i(),d(L,{key:0},[(i(!0),d(L,null,w(e.comments,((t,s)=>(i(),d("div",{class:"comment_item",key:t.commentId+s+""},[p(v,{to:{path:"/user",query:{id:t.user.userId}},class:"comment_avatar"},{default:N((()=>[p(a,{src:t.user.avatarUrl+"?param=120y120"},{default:N((()=>[Z])),_:2},1032,["src"])])),_:2},1032,["to"]),p("div",ee,[p(v,{to:{path:"/user",query:{id:t.user.userId}}},{default:N((()=>[f(u(t.user.nickname),1)])),_:2},1032,["to"]),p("div",te,u(t.content),1),(i(!0),d(L,null,w(t.beReplied,(e=>(i(),d("div",{class:"comment_reply",key:e.beRepliedCommentId},[p(v,{to:{path:"/user",query:{id:e.user.userId}}},{default:N((()=>[f(u(e.user.nickname),1)])),_:2},1032,["to"]),f(": "+u(e.content),1)])))),128)),p("div",se,[p("div",ne,u(e.$utils.formatMsgTime(t.time)),1),p("div",oe,[n.userInfo&&n.userInfo.userId===t.user.userId?(i(),d("em",{key:0,class:"comment_del",onClick:e=>n.delComment(t)},[me],8,["onClick"])):x("",!0),p("span",{class:[t.liked?"active":""],onClick:e=>n.likeComment(t)},[ae,f("("+u(t.likedCount)+")",1)],10,["onClick"]),p("span",{class:"replyComment",onClick:e=>n.replyComment(t,s)},[le],8,["onClick"])])]),t.isHot?(i(),d("div",ce,[re])):x("",!0),p($,{name:"fade",mode:"out-in"},{default:N((()=>[n.isShowReply(t,s)?(i(),d(h,{key:0,params:t,onReplyMsg:n.replyMsg},null,8,["params","onReplyMsg"])):x("",!0)])),_:2},1024)])])))),128)),p("div",ie,[p(C,{onCurrentChange:n.currentChange,layout:"prev, pager, next",total:e.total},null,8,["onCurrentChange","total"])])],64)):(i(),d("div",de,[e.isEmpty?(i(),d("div",ue,[ge,ye])):(i(),d("div",pe,"评论加载中..."))]))])])}));H.render=fe,H.__scopeId="data-v-1c9ca5d5";export{H as _};
