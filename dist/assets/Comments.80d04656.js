var A=Object.defineProperty,G=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var M=(o,s,m)=>s in o?A(o,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[s]=m,S=(o,s)=>{for(var m in s||(s={}))Q.call(s,m)&&M(o,m,s[m]);if(R)for(var m of R(s))W.call(s,m)&&M(o,m,s[m]);return o},B=(o,s)=>G(o,K(s));import{p as T,a as H,e as f,o as r,f as i,g as t,i as a,q,a9 as U,j as u,w as E,u as X,r as Y,d as L,x as Z,y as D,t as ee,k as b,F as w,h as V,aa as te,m as se}from"./vendor.a7e3494f.js";const $={name:"replyComment",components:{},props:["params"],data(){return{msg:"",maxLen:140}},computed:{},methods:{subReplyComment(){this.$emit("replyMsg",this.msg)}},watch:{msg(){this.msg=this.maxLen>=this.msg?this.msg:this.msg.substring(0,this.maxLen)}}},N=E();T("data-v-623b5f6f");const oe={class:"reply-comment"},ne={class:"comment_textarea"},ce={class:"pre"},me={class:"comment_box_footer"},ae={class:"comment_limit"},le={class:"num"},re=u("\u8BC4\u8BBA");H();const ie=N((o,s,m,e,p,h)=>{const y=f("el-button");return r(),i("div",oe,[t("h3",null,"\u6211\u56DE\u590D@"+a(m.params.user.nickname)+":",1),t("div",ne,[t("div",ce,a(p.msg),1),q(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":s[1]||(s[1]=g=>p.msg=g)},null,512),[[U,p.msg]])]),t("div",me,[t("span",ae,[t("em",le,a(p.msg.length),1),u("/"+a(p.maxLen),1)]),t(y,{type:"primary",size:"mini",round:"",onClick:h.subReplyComment},{default:N(()=>[re]),_:1},8,["onClick"])])])});$.render=ie;$.__scopeId="data-v-623b5f6f";const z={name:"Comments",components:{ReplyComment:$},props:{sId:{type:[Number,String],default:0},type:{type:Number,default:0}},setup(o){const{proxy:s}=se(),m=X(),e=Y({msg:"",maxLen:140,curId:o.sId,limit:20,offset:0,before:0,hotComments:[],comments:[],total:0,currentPage:0,isEmpty:!1,replyCommentId:0,replyIndex:-1}),p=L(()=>m.getters.userInfo),h=L(()=>m.getters.isLogin),y=L(()=>function(n,l){return n.commentId===e.replyCommentId&&e.replyIndex===l}),g=()=>{switch(o.type){case 0:v("commentSong");break;case 1:v("commentMv");break;case 3:v("albumComment");break;case 5:v("commentVideo");break}},v=async n=>{const{data:l}=await s.$http[n]({id:e.curId,limit:e.limit,offset:e.offset,before:e.before,timestamp:new Date().valueOf()});C(l)},C=n=>{if(n.code!==200)return s.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.total=n.total,e.hotComments=n.hotComments||[],e.hotComments.map(l=>(l.isHot=!0,l)),e.comments=[...e.hotComments,...n.comments],e.isEmpty=e.before===0&&!e.comments.length},I=async(n,l,j)=>{const O={t:n,type:o.type,id:e.curId,content:l,commentId:j},{data:P}=await s.$http.comment(O);if(P.code!==200)return s.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.msg="",g(),n===0?s.$msg.success("\u5220\u9664\u8BC4\u8BBA\u6210\u529F\uFF01"):n===1?s.$msg.success("\u8BC4\u8BBA\u6210\u529F\uFF01"):n===2&&(s.$msg.success("\u56DE\u590D\u8BC4\u8BBA\u6210\u529F\uFF01"),e.replyCommentId=0,e.replyIndex=-1)},x=async()=>{if(!h.value){m.commit("setLoginDialog",!0);return}I(1,e.msg)},c=n=>{s.$msgBox.confirm("\u786E\u5B9A\u5220\u9664\u8BC4\u8BBA\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",center:!0}).then(()=>{I(0,"",n.commentId)}).catch(()=>{})},k=(n,l)=>{if(!h.value){m.commit("setLoginDialog",!0);return}e.replyCommentId=e.replyCommentId===n.commentId&&e.replyIndex===l?0:n.commentId,e.replyIndex=l},d=n=>{if(!h.value){m.commit("setLoginDialog",!0);return}I(2,n,e.replyCommentId)},F=async n=>{if(!h.value){m.commit("setLoginDialog",!0);return}const{data:l}=await s.$http.commentLike({id:e.curId,cid:n.commentId,t:Number(!n.liked),type:o.type});if(l.code!==200)return s.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");g()},J=n=>{e.offset=(n-1)*e.limit};return Z(()=>{g()}),D(()=>o.sId,(n,l)=>{e.curId=n,e.offset=0,g()}),D(()=>e.msg,()=>{e.msg=e.maxLen>=e.msg?e.msg:e.msg.substring(0,e.maxLen)}),B(S({},ee(e)),{userInfo:p,isLogin:h,subComment:x,delComment:c,replyMsg:d,replyComment:k,likeComment:F,isShowReply:y,currentChange:J})}},_=E();T("data-v-cfb56c98");const de={class:"comments"},_e={class:"comment_hd"},ue=u("\u8BC4\u8BBA"),pe={key:0,class:"userInfo"},he=t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1),ge={class:"comment_textarea"},fe={class:"pre"},ye={class:"comment_box_footer"},ve=u("\u8BC4\u8BBA"),Ce={class:"comment_limit"},Ie={class:"num"},ke={class:"comment_area"},be=t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1),xe={class:"comment_info"},Le={class:"comment_content"},we={class:"comment_footer"},$e={class:"comment_time"},Re={class:"comment_oper"},Me=t("i",{class:"iconfont icon-del"},null,-1),Se=t("i",{class:"iconfont icon-praise"},null,-1),Be=t("i",{class:"iconfont icon-comment"},null,-1),De={key:0,class:"isHot"},Ve=t("i",{class:"iconfont icon-choicest"},null,-1),Ne={class:"pagination"},Te={key:1,class:"comments_status"},He={key:0,class:"loading"},qe={key:1,class:"empty"},Ue=t("p",null,[t("i",{class:"iconfont icon-empty-main"})],-1),Ee=t("p",null,"\u6682\u65E0\u7559\u8A00",-1);H();const ze=_((o,s,m,e,p,h)=>{const y=f("el-image"),g=f("el-button"),v=f("el-form"),C=f("router-link"),I=f("reply-comment"),x=f("el-pagination");return r(),i("div",de,[t("div",_e,[t("h2",null,[ue,t("em",null,"\u5171"+a(o.total)+"\u6761\u8BC4\u8BBA",1)]),e.userInfo?(r(),i("div",pe,[t("span",null,a(e.userInfo.nickname),1),t(y,{src:e.userInfo.avatarUrl,class:"avatar"},{default:_(()=>[he]),_:1},8,["src"])])):b("",!0)]),t(v,{class:"comment_box"},{default:_(()=>[t("div",ge,[t("div",fe,a(o.msg),1),q(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":s[1]||(s[1]=c=>o.msg=c)},null,512),[[U,o.msg]])]),t("div",ye,[t(g,{type:"primary",size:"mini",onClick:e.subComment},{default:_(()=>[ve]),_:1},8,["onClick"]),t("span",Ce,[t("em",Ie,a(o.msg.length),1),u("/"+a(o.maxLen),1)])])]),_:1}),t("div",ke,[o.comments.length?(r(),i(w,{key:0},[(r(!0),i(w,null,V(o.comments,(c,k)=>(r(),i("div",{class:"comment_item",key:c.commentId+k+""},[t(C,{to:{path:"/user",query:{id:c.user.userId}},class:"comment_avatar"},{default:_(()=>[t(y,{src:c.user.avatarUrl+"?param=120y120"},{default:_(()=>[be]),_:2},1032,["src"])]),_:2},1032,["to"]),t("div",xe,[t(C,{to:{path:"/user",query:{id:c.user.userId}}},{default:_(()=>[u(a(c.user.nickname),1)]),_:2},1032,["to"]),t("div",Le,a(c.content),1),(r(!0),i(w,null,V(c.beReplied,d=>(r(),i("div",{class:"comment_reply",key:d.beRepliedCommentId},[t(C,{to:{path:"/user",query:{id:d.user.userId}}},{default:_(()=>[u(a(d.user.nickname),1)]),_:2},1032,["to"]),u(": "+a(d.content),1)]))),128)),t("div",we,[t("div",$e,a(o.$utils.formatMsgTime(c.time)),1),t("div",Re,[e.userInfo&&e.userInfo.userId===c.user.userId?(r(),i("em",{key:0,class:"comment_del",onClick:d=>e.delComment(c)},[Me],8,["onClick"])):b("",!0),t("span",{class:[c.liked?"active":""],onClick:d=>e.likeComment(c)},[Se,u("("+a(c.likedCount)+")",1)],10,["onClick"]),t("span",{class:"replyComment",onClick:d=>e.replyComment(c,k)},[Be],8,["onClick"])])]),c.isHot?(r(),i("div",De,[Ve])):b("",!0),t(te,{name:"fade",mode:"out-in"},{default:_(()=>[e.isShowReply(c,k)?(r(),i(I,{key:0,params:c,onReplyMsg:e.replyMsg},null,8,["params","onReplyMsg"])):b("",!0)]),_:2},1024)])]))),128)),t("div",Ne,[t(x,{onCurrentChange:e.currentChange,layout:"prev, pager, next",total:o.total},null,8,["onCurrentChange","total"])])],64)):(r(),i("div",Te,[o.isEmpty?(r(),i("div",qe,[Ue,Ee])):(r(),i("div",He,"\u8BC4\u8BBA\u52A0\u8F7D\u4E2D..."))]))])])});z.render=ze;z.__scopeId="data-v-cfb56c98";export{z as _};
