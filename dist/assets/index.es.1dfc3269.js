import{d as xt,ac as Z,ad as Ct,ae as wt,B as j,p as Pt,a as Ft,j as Tt,af as jt,ag as V,ah as ie,n as Dt,q as ht,v as ft,i as st,k as ut,r as qt,y as ue,x as de,ai as ce,g as et,aj as Jt,aa as te,F as Xt,h as zt,ak as Ee,al as Te,f as Se,am as Ht,o as $,z as he,s as be,m as Le}from"./vendor.a7e3494f.js";var Ae=Object.defineProperty,De=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,ae=(N,w,h)=>w in N?Ae(N,w,{enumerable:!0,configurable:!0,writable:!0,value:h}):N[w]=h,ee=(N,w)=>{for(var h in w||(w={}))Re.call(w,h)&&ae(N,h,w[h]);if(ne)for(var h of ne(w))_e.call(w,h)&&ae(N,h,w[h]);return N},re=(N,w)=>De(N,ke(w));function se(N,w,h,_){var S,D=!1,R=0;function C(){S&&clearTimeout(S)}function m(){for(var p=arguments.length,A=new Array(p),y=0;y<p;y++)A[y]=arguments[y];var c=this,T=Date.now()-R;function E(){R=Date.now(),h.apply(c,A)}function u(){S=void 0}D||(_&&!S&&E(),C(),_===void 0&&T>N?E():w!==!0&&(S=setTimeout(_?u:E,_===void 0?N-T:N)))}return typeof w!="boolean"&&(_=h,h=w,w=void 0),m.cancel=function(){C(),D=!0},m}function oe(N,w,h){return h===void 0?se(N,w,!1):se(N,h,w!==!1)}function Ie(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var fe={exports:{}};typeof window!="undefined"&&(fe.exports=function(N){var w={};function h(_){if(w[_])return w[_].exports;var S=w[_]={i:_,l:!1,exports:{}};return N[_].call(S.exports,S,S.exports,h),S.l=!0,S.exports}return h.m=N,h.c=w,h.d=function(_,S,D){h.o(_,S)||Object.defineProperty(_,S,{enumerable:!0,get:D})},h.r=function(_){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},h.t=function(_,S){if(1&S&&(_=h(_)),8&S||4&S&&typeof _=="object"&&_&&_.__esModule)return _;var D=Object.create(null);if(h.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:_}),2&S&&typeof _!="string")for(var R in _)h.d(D,R,function(C){return _[C]}.bind(null,R));return D},h.n=function(_){var S=_&&_.__esModule?function(){return _.default}:function(){return _};return h.d(S,"a",S),S},h.o=function(_,S){return Object.prototype.hasOwnProperty.call(_,S)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(N,w,h){var _=Object.prototype.hasOwnProperty,S="~";function D(){}function R(A,y,c){this.fn=A,this.context=y,this.once=c||!1}function C(A,y,c,T,E){if(typeof c!="function")throw new TypeError("The listener must be a function");var u=new R(c,T||A,E),t=S?S+y:y;return A._events[t]?A._events[t].fn?A._events[t]=[A._events[t],u]:A._events[t].push(u):(A._events[t]=u,A._eventsCount++),A}function m(A,y){--A._eventsCount==0?A._events=new D:delete A._events[y]}function p(){this._events=new D,this._eventsCount=0}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(S=!1)),p.prototype.eventNames=function(){var A,y,c=[];if(this._eventsCount===0)return c;for(y in A=this._events)_.call(A,y)&&c.push(S?y.slice(1):y);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(A)):c},p.prototype.listeners=function(A){var y=S?S+A:A,c=this._events[y];if(!c)return[];if(c.fn)return[c.fn];for(var T=0,E=c.length,u=new Array(E);T<E;T++)u[T]=c[T].fn;return u},p.prototype.listenerCount=function(A){var y=S?S+A:A,c=this._events[y];return c?c.fn?1:c.length:0},p.prototype.emit=function(A,y,c,T,E,u){var t=S?S+A:A;if(!this._events[t])return!1;var a,e,s=this._events[t],l=arguments.length;if(s.fn){switch(s.once&&this.removeListener(A,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,y),!0;case 3:return s.fn.call(s.context,y,c),!0;case 4:return s.fn.call(s.context,y,c,T),!0;case 5:return s.fn.call(s.context,y,c,T,E),!0;case 6:return s.fn.call(s.context,y,c,T,E,u),!0}for(e=1,a=new Array(l-1);e<l;e++)a[e-1]=arguments[e];s.fn.apply(s.context,a)}else{var n,o=s.length;for(e=0;e<o;e++)switch(s[e].once&&this.removeListener(A,s[e].fn,void 0,!0),l){case 1:s[e].fn.call(s[e].context);break;case 2:s[e].fn.call(s[e].context,y);break;case 3:s[e].fn.call(s[e].context,y,c);break;case 4:s[e].fn.call(s[e].context,y,c,T);break;default:if(!a)for(n=1,a=new Array(l-1);n<l;n++)a[n-1]=arguments[n];s[e].fn.apply(s[e].context,a)}}return!0},p.prototype.on=function(A,y,c){return C(this,A,y,c,!1)},p.prototype.once=function(A,y,c){return C(this,A,y,c,!0)},p.prototype.removeListener=function(A,y,c,T){var E=S?S+A:A;if(!this._events[E])return this;if(!y)return m(this,E),this;var u=this._events[E];if(u.fn)u.fn!==y||T&&!u.once||c&&u.context!==c||m(this,E);else{for(var t=0,a=[],e=u.length;t<e;t++)(u[t].fn!==y||T&&!u[t].once||c&&u[t].context!==c)&&a.push(u[t]);a.length?this._events[E]=a.length===1?a[0]:a:m(this,E)}return this},p.prototype.removeAllListeners=function(A){var y;return A?(y=S?S+A:A,this._events[y]&&m(this,y)):(this._events=new D,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=S,p.EventEmitter=p,N.exports=p},"./node_modules/url-toolkit/src/url-toolkit.js":function(N,w,h){var _,S,D,R,C;_=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,S=/^([^\/?#]*)([^]*)$/,D=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,C={buildAbsoluteURL:function(m,p,A){if(A=A||{},m=m.trim(),!(p=p.trim())){if(!A.alwaysNormalize)return m;var y=C.parseURL(m);if(!y)throw new Error("Error trying to parse base URL.");return y.path=C.normalizePath(y.path),C.buildURLFromParts(y)}var c=C.parseURL(p);if(!c)throw new Error("Error trying to parse relative URL.");if(c.scheme)return A.alwaysNormalize?(c.path=C.normalizePath(c.path),C.buildURLFromParts(c)):p;var T=C.parseURL(m);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var E=S.exec(T.path);T.netLoc=E[1],T.path=E[2]}T.netLoc&&!T.path&&(T.path="/");var u={scheme:T.scheme,netLoc:c.netLoc,path:null,params:c.params,query:c.query,fragment:c.fragment};if(!c.netLoc&&(u.netLoc=T.netLoc,c.path[0]!=="/"))if(c.path){var t=T.path,a=t.substring(0,t.lastIndexOf("/")+1)+c.path;u.path=C.normalizePath(a)}else u.path=T.path,c.params||(u.params=T.params,c.query||(u.query=T.query));return u.path===null&&(u.path=A.alwaysNormalize?C.normalizePath(c.path):c.path),C.buildURLFromParts(u)},parseURL:function(m){var p=_.exec(m);return p?{scheme:p[1]||"",netLoc:p[2]||"",path:p[3]||"",params:p[4]||"",query:p[5]||"",fragment:p[6]||""}:null},normalizePath:function(m){for(m=m.split("").reverse().join("").replace(D,"");m.length!==(m=m.replace(R,"")).length;);return m.split("").reverse().join("")},buildURLFromParts:function(m){return m.scheme+m.netLoc+m.path+m.params+m.query+m.fragment}},N.exports=C},"./node_modules/webworkify-webpack/index.js":function(N,w,h){function _(p){var A={};function y(T){if(A[T])return A[T].exports;var E=A[T]={i:T,l:!1,exports:{}};return p[T].call(E.exports,E,E.exports,y),E.l=!0,E.exports}y.m=p,y.c=A,y.i=function(T){return T},y.d=function(T,E,u){y.o(T,E)||Object.defineProperty(T,E,{configurable:!1,enumerable:!0,get:u})},y.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},y.n=function(T){var E=T&&T.__esModule?function(){return T.default}:function(){return T};return y.d(E,"a",E),E},y.o=function(T,E){return Object.prototype.hasOwnProperty.call(T,E)},y.p="/",y.oe=function(T){throw console.error(T),T};var c=y(y.s=ENTRY_MODULE);return c.default||c}var S="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function R(p){return(p+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(p,A,y){var c={};c[y]=[];var T=A.toString(),E=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return c;for(var u,t=E[1],a=new RegExp("(\\\\n|\\W)"+R(t)+D,"g");u=a.exec(T);)u[3]!=="dll-reference"&&c[y].push(u[3]);for(a=new RegExp("\\("+R(t)+'\\("(dll-reference\\s('+S+'))"\\)\\)'+D,"g");u=a.exec(T);)p[u[2]]||(c[y].push(u[1]),p[u[2]]=h(u[1]).m),c[u[2]]=c[u[2]]||[],c[u[2]].push(u[4]);for(var e,s=Object.keys(c),l=0;l<s.length;l++)for(var n=0;n<c[s[l]].length;n++)e=c[s[l]][n],isNaN(1*e)||(c[s[l]][n]=1*c[s[l]][n]);return c}function m(p){return Object.keys(p).reduce(function(A,y){return A||p[y].length>0},!1)}N.exports=function(p,A){A=A||{};var y={main:h.m},c=A.all?{main:Object.keys(y.main)}:function(a,e){for(var s={main:[e]},l={main:[]},n={main:{}};m(s);)for(var o=Object.keys(s),v=0;v<o.length;v++){var f=o[v],g=s[f].pop();if(n[f]=n[f]||{},!n[f][g]&&a[f][g]){n[f][g]=!0,l[f]=l[f]||[],l[f].push(g);for(var r=C(a,a[f][g],f),i=Object.keys(r),d=0;d<i.length;d++)s[i[d]]=s[i[d]]||[],s[i[d]]=s[i[d]].concat(r[i[d]])}}return l}(y,p),T="";Object.keys(c).filter(function(a){return a!=="main"}).forEach(function(a){for(var e=0;c[a][e];)e++;c[a].push(e),y[a][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+a+" = ("+_.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+c[a].map(function(s){return JSON.stringify(s)+": "+y[a][s].toString()}).join(",")+`});
`}),T=T+"new (("+_.toString().replace("ENTRY_MODULE",JSON.stringify(p))+")({"+c.main.map(function(a){return JSON.stringify(a)+": "+y.main[a].toString()}).join(",")+"}))(self);";var E=new window.Blob([T],{type:"text/javascript"});if(A.bare)return E;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(E),t=new window.Worker(u);return t.objectURL=u,t}},"./src/config.ts":function(N,w,h){h.r(w),h.d(w,"hlsDefaultConfig",function(){return o}),h.d(w,"mergeConfig",function(){return v}),h.d(w,"enableStreamingMode",function(){return f});var _=h("./src/controller/abr-controller.ts"),S=h("./src/controller/audio-stream-controller.ts"),D=h("./src/controller/audio-track-controller.ts"),R=h("./src/controller/subtitle-stream-controller.ts"),C=h("./src/controller/subtitle-track-controller.ts"),m=h("./src/controller/buffer-controller.ts"),p=h("./src/controller/timeline-controller.ts"),A=h("./src/controller/cap-level-controller.ts"),y=h("./src/controller/fps-controller.ts"),c=h("./src/controller/eme-controller.ts"),T=h("./src/utils/xhr-loader.ts"),E=h("./src/utils/fetch-loader.ts"),u=h("./src/utils/cues.ts"),t=h("./src/utils/mediakeys-helper.ts"),a=h("./src/utils/logger.ts");function e(){return(e=Object.assign||function(g){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(g[d]=i[d])}return g}).apply(this,arguments)}function s(g,r){var i=Object.keys(g);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(g);r&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(g,b).enumerable})),i.push.apply(i,d)}return i}function l(g){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?s(Object(i),!0).forEach(function(d){n(g,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(d){Object.defineProperty(g,d,Object.getOwnPropertyDescriptor(i,d))})}return g}function n(g,r,i){return r in g?Object.defineProperty(g,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):g[r]=i,g}var o=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:_.default,bufferController:m.default,capLevelController:A.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:C.default,timelineController:p.TimelineController,audioStreamController:S.default,audioTrackController:D.default,emeController:c.default});function v(g,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return e({},g,r)}function f(g){var r=g.loader;r!==E.default&&r!==T.default?(a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),g.progressive=!1):Object(E.fetchSupported)()&&(g.loader=E.default,g.progressive=!0,g.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),S=h("./src/utils/ewma-bandwidth-estimator.ts"),D=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),C=h("./src/errors.ts"),m=h("./src/types/loader.ts"),p=h("./src/utils/logger.ts");function A(c,T){for(var E=0;E<T.length;E++){var u=T[E];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(c,u.key,u)}}var y=function(){function c(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var a=t.config;this.bwEstimator=new S.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var T,E,u=c.prototype;return u.registerListeners=function(){var t=this.hls;t.on(D.Events.FRAG_LOADING,this.onFragLoading,this),t.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var t=this.hls;t.off(D.Events.FRAG_LOADING,this.onFragLoading,this),t.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(t,a){var e,s=a.frag;s.type===m.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=s,this.partCurrent=(e=a.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(t,a){var e=this.hls.config;a.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,s=e.autoLevelEnabled,l=e.config,n=e.media;if(t&&n){var o=a?a.stats:t.stats,v=a?a.duration:t.duration;if(o.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!n.paused&&n.playbackRate&&n.readyState){var f=performance.now()-o.loading.start,g=Math.abs(n.playbackRate);if(!(f<=500*v/g)){var r=e.levels,i=e.minAutoLevel,d=r[t.level],b=o.total||Math.max(o.loaded,Math.round(v*d.maxBitrate/8)),L=Math.max(1,o.bwEstimate?o.bwEstimate/8:1e3*o.loaded/f),k=(b-o.loaded)/L,I=n.currentTime,O=(R.BufferHelper.bufferInfo(n,I,l.maxBufferHole).end-I)/g;if(!(O>=2*v/g||k<=O)){var x,P=Number.POSITIVE_INFINITY;for(x=t.level-1;x>i&&!((P=v*r[x].maxBitrate/(6.4*L))<O);x--);if(!(P>=k)){var F=this.bwEstimator.getEstimate();p.logger.warn("Fragment "+t.sn+(a?" part "+a.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+`
      Current BW estimate: `+(Object(_.isFiniteNumber)(F)?(F/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+k.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+O.toFixed(3)+" s"),e.nextLoadLevel=x,this.bwEstimator.sample(f,o.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),e.trigger(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:a,stats:o})}}}}}},u.onFragLoaded=function(t,a){var e=a.frag,s=a.part;if(e.type===m.PlaylistLevelType.MAIN&&Object(_.isFiniteNumber)(e.sn)){var l=s?s.stats:e.stats,n=s?s.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[e.level],v=(o.loaded?o.loaded.bytes:0)+l.loaded,f=(o.loaded?o.loaded.duration:0)+n;o.loaded={bytes:v,duration:f},o.realBitrate=Math.round(8*v/f)}if(e.bitrateTest){var g={stats:l,frag:e,part:s,id:e.type};this.onFragBuffered(D.Events.FRAG_BUFFERED,g),e.bitrateTest=!1}}},u.onFragBuffered=function(t,a){var e=a.frag,s=a.part,l=s?s.stats:e.stats;if(!l.aborted&&e.type===m.PlaylistLevelType.MAIN&&e.sn!=="initSegment"){var n=l.parsing.end-l.loading.start;this.bwEstimator.sample(n,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},u.onError=function(t,a){switch(a.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,s=e.maxAutoLevel,l=e.config,n=e.minAutoLevel,o=e.media,v=a?a.duration:t?t.duration:0,f=o?o.currentTime:0,g=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,i=(R.BufferHelper.bufferInfo(o,f,l.maxBufferHole).end-f)/g,d=this.findBestLevel(r,n,s,i,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(d>=0)return d;p.logger.trace((i?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var b=v?Math.min(v,l.maxStarvationDelay):l.maxStarvationDelay,L=l.abrBandWidthFactor,k=l.abrBandWidthUpFactor;if(!i){var I=this.bitrateTestDelay;I&&(b=(v?Math.min(v,l.maxLoadingDelay):l.maxLoadingDelay)-I,p.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),L=k=1)}return d=this.findBestLevel(r,n,s,i+b,L,k),Math.max(d,0)},u.findBestLevel=function(t,a,e,s,l,n){for(var o,v=this.fragCurrent,f=this.partCurrent,g=this.lastLoadedFragLevel,r=this.hls.levels,i=r[g],d=!(i==null||(o=i.details)===null||o===void 0||!o.live),b=i==null?void 0:i.codecSet,L=f?f.duration:v?v.duration:0,k=e;k>=a;k--){var I=r[k];if(I&&(!b||I.codecSet===b)){var O=I.details,x=(f?O==null?void 0:O.partTarget:O==null?void 0:O.averagetargetduration)||L,P=void 0;P=k<=g?l*t:n*t;var F=r[k].maxBitrate,M=F*x/P;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(P)+"/"+F+"/"+x+"/"+s+"/"+M),P>F&&(!M||d&&!this.bitrateTestDelay||M<s))return k}}return-1},T=c,(E=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,a=this.bwEstimator;if(!(t===-1||a&&a.canEstimate()))return t;var e=this.getNextABRAutoLevel();return t!==-1&&(e=Math.min(t,e)),e},set:function(t){this._nextAutoLevel=t}}])&&A(T.prototype,E),c}();w.default=y},"./src/controller/audio-stream-controller.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),S=h("./src/controller/base-stream-controller.ts"),D=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),C=h("./src/controller/fragment-tracker.ts"),m=h("./src/types/level.ts"),p=h("./src/types/loader.ts"),A=h("./src/loader/fragment.ts"),y=h("./src/demux/chunk-cache.ts"),c=h("./src/demux/transmuxer-interface.ts"),T=h("./src/types/transmuxer.ts"),E=h("./src/controller/fragment-finders.ts"),u=h("./src/utils/discontinuities.ts"),t=h("./src/errors.ts"),a=h("./src/utils/logger.ts");function e(){return(e=Object.assign||function(n){for(var o=1;o<arguments.length;o++){var v=arguments[o];for(var f in v)Object.prototype.hasOwnProperty.call(v,f)&&(n[f]=v[f])}return n}).apply(this,arguments)}function s(n,o){return(s=Object.setPrototypeOf||function(v,f){return v.__proto__=f,v})(n,o)}var l=function(n){var o,v;function f(r,i){var d;return(d=n.call(this,r,i,"[audio-stream-controller]")||this).videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d._registerListeners(),d}v=n,(o=f).prototype=Object.create(v.prototype),o.prototype.constructor=o,s(o,v);var g=f.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var r=this.hls;r.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(D.Events.ERROR,this.onError,this),r.on(D.Events.BUFFER_RESET,this.onBufferReset,this),r.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(D.Events.ERROR,this.onError,this),r.off(D.Events.BUFFER_RESET,this.onBufferReset,this),r.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onInitPtsFound=function(r,i){var d=i.frag,b=i.id,L=i.initPTS;if(b==="main"){var k=d.cc;this.initPTS[d.cc]=L,this.log("InitPTS for cc: "+k+" found from main: "+L),this.videoTrackCC=k,this.state===S.State.WAITING_INIT_PTS&&this.tick()}},g.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=S.State.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=S.State.IDLE):(this.loadedmetadata=!1,this.state=S.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},g.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_TRACK:var r,i=this.levels,d=this.trackId,b=i==null||(r=i[d])===null||r===void 0?void 0:r.details;if(b){if(this.waitForCdnTuneIn(b))break;this.state=S.State.WAITING_INIT_PTS}break;case S.State.FRAG_LOADING_WAITING_RETRY:var L,k=performance.now(),I=this.retryDate;(!I||k>=I||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=S.State.IDLE);break;case S.State.WAITING_INIT_PTS:var O=this.waitingData;if(O){var x=O.frag,P=O.part,F=O.cache,M=O.complete;if(this.initPTS[x.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.FRAG_LOADING;var B={frag:x,part:P,payload:F.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),M&&n.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)a.logger.log("Waiting fragment cc ("+x.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),G=R.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(E.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,x)<0&&(a.logger.log("Waiting fragment cc ("+x.cc+") @ "+x.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=S.State.IDLE}this.onTickEnd()},g.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.IDLE)},g.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var i=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&i.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},g.doTickIdle=function(){var r,i,d=this.hls,b=this.levels,L=this.media,k=this.trackId,I=d.config;if(b&&b[k]&&(L||!this.startFragRequested&&I.startFragPrefetch)){var O=b[k].details;if(!O||O.live&&this.levelLastLoaded!==k||this.waitForCdnTuneIn(O))this.state=S.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,A.ElementaryStreamTypes.AUDIO,p.PlaylistLevelType.AUDIO));var x=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,p.PlaylistLevelType.AUDIO);if(x!==null){var P=x.len,F=this.getMaxBufferLength(),M=this.audioSwitch;if(!(P>=F)||M){if(!M&&this._streamEnded(x,O))return d.trigger(D.Events.BUFFER_EOS,{type:"audio"}),void(this.state=S.State.ENDED);var B=O.fragments[0].start,U=x.end;if(M){var G=this.getLoadPosition();U=G,O.PTSKnown&&G<B&&(x.end>B||x.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),L.currentTime=B+.05)}var K=this.getNextFragment(U,O);K?((r=K.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=K.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(K,O,U):this.loadKey(K,O):this.bufferFlushed=!0}}}}},g.getMaxBufferLength=function(){var r=n.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,p.PlaylistLevelType.MAIN);return i===null?r:Math.max(r,i.len)},g.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},g.onAudioTracksUpdated=function(r,i){var d=i.audioTracks;this.resetTransmuxer(),this.levels=d.map(function(b){return new m.Level(b)})},g.onAudioTrackSwitching=function(r,i){var d=!!i.url;this.trackId=i.id;var b=this.fragCurrent;b!=null&&b.loader&&b.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(100):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=S.State.IDLE):this.state=S.State.STOPPED,this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},g.onLevelLoaded=function(r,i){this.mainDetails=i.details},g.onAudioTrackLoaded=function(r,i){var d,b=this.levels,L=i.details,k=i.id;if(b){this.log("Track "+k+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var I=b[k],O=0;if(L.live||(d=I.details)!==null&&d!==void 0&&d.live){var x=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!x)return;!I.details&&L.hasProgramDateTime&&x.hasProgramDateTime?(Object(u.alignPDT)(L,x),O=L.fragments[0].start):O=this.alignPlaylists(L,I.details)}I.details=L,this.levelLastLoaded=k,this.startFragRequested||!this.mainDetails&&L.live||this.setStartPosition(I.details,O),this.state!==S.State.WAITING_TRACK||this.waitForCdnTuneIn(L)||(this.state=S.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+k)},g._handleFragmentLoadProgress=function(r){var i,d=r.frag,b=r.part,L=r.payload,k=this.config,I=this.trackId,O=this.levels;if(O){var x=O[I];console.assert(x,"Audio track is defined on fragment load progress");var P=x.details;console.assert(P,"Audio track details are defined on fragment load progress");var F=k.defaultAudioCodec||x.audioCodec||"mp4a.40.2",M=this.transmuxer;M||(M=this.transmuxer=new c.default(this.hls,p.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[d.cc],U=(i=d.initSegment)===null||i===void 0?void 0:i.data;if(B!==void 0){var G=b?b.index:-1,K=G!==-1,H=new T.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,L.byteLength,G,K);M.push(L,U,F,"",d,b,P.totalduration,!1,H,B)}else a.logger.log("Unknown video PTS for cc "+d.cc+", waiting for video PTS before demuxing audio frag "+d.sn+" of ["+P.startSN+" ,"+P.endSN+"],track "+I),(this.waitingData=this.waitingData||{frag:d,part:b,cache:new y.default,complete:!1}).cache.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=S.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered")},g._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:n.prototype._handleFragmentLoadComplete.call(this,r)},g.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},g.onBufferCreated=function(r,i){var d=i.tracks.audio;d&&(this.mediaBuffer=d.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},g.onFragBuffered=function(r,i){var d=i.frag,b=i.part;d.type===p.PlaylistLevelType.AUDIO&&(this.fragContextChanged(d)?this.warn("Fragment "+d.sn+(b?" p: "+b.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(d.sn!=="initSegment"&&(this.fragPrevious=d,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(d,b)))},g.onError=function(r,i){switch(i.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(p.PlaylistLevelType.AUDIO,i);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==S.State.ERROR&&this.state!==S.State.STOPPED&&(this.state=i.fatal?S.State.ERROR:S.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var d=!0,b=this.getFwdBufferInfo(this.mediaBuffer,p.PlaylistLevelType.AUDIO);b&&b.len>.5&&(d=!this.reduceMaxBufferLength(b.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},g.onBufferFlushed=function(r,i){i.type===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},g._handleTransmuxComplete=function(r){var i,d="audio",b=this.hls,L=r.remuxResult,k=r.chunkMeta,I=this.getCurrentContext(k);if(!I)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var O=I.frag,x=I.part,P=L.audio,F=L.text,M=L.id3,B=L.initSegment;if(!this.fragContextChanged(O)){if(this.state=S.State.PARSING,this.audioSwitch&&P&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,O,k),b.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:d,tracks:B.tracks})),P){var U=P.startPTS,G=P.endPTS,K=P.startDTS,H=P.endDTS;x&&(x.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:G,startDTS:K,endDTS:H}),O.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,U,G,K,H),this.bufferFragmentData(P,O,x,k)}if(M!=null&&(i=M.samples)!==null&&i!==void 0&&i.length){var Y=e({frag:O,id:d},M);b.trigger(D.Events.FRAG_PARSING_METADATA,Y)}if(F){var W=e({frag:O,id:d},F);b.trigger(D.Events.FRAG_PARSING_USERDATA,W)}}},g._bufferInitSegment=function(r,i,d){if(this.state===S.State.PARSING){r.video&&delete r.video;var b=r.audio;if(b){b.levelCodec=b.codec,b.id="audio",this.log("Init audio buffer, container:"+b.container+", codecs[parsed]=["+b.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,r);var L=b.initSegment;if(L!=null&&L.byteLength){var k={type:"audio",frag:i,part:null,chunkMeta:d,parent:i.type,data:L};this.hls.trigger(D.Events.BUFFER_APPENDING,k)}this.tick()}}},g.loadFragment=function(r,i,d){var b=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||b===C.FragmentState.NOT_LOADED||b===C.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):i.live&&!Object(_.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=S.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,i,d)))},g.completeAudioSwitch=function(){var r=this.hls,i=this.media,d=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:d})},f}(S.default);w.default=l},"./src/controller/audio-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),S=h("./src/errors.ts"),D=h("./src/controller/base-playlist-controller.ts"),R=h("./src/types/loader.ts");function C(A,y){for(var c=0;c<y.length;c++){var T=y[c];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(A,T.key,T)}}function m(A,y){return(m=Object.setPrototypeOf||function(c,T){return c.__proto__=T,c})(A,y)}var p=function(A){var y,c;function T(a){var e;return(e=A.call(this,a,"[audio-track-controller]")||this).tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.trackName="",e.selectDefaultTrack=!0,e.registerListeners(),e}c=A,(y=T).prototype=Object.create(c.prototype),y.prototype.constructor=y,m(y,c);var E,u,t=T.prototype;return t.registerListeners=function(){var a=this.hls;a.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(_.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var a=this.hls;a.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(_.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,A.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},t.onManifestParsed=function(a,e){this.tracks=e.audioTracks||[]},t.onAudioTrackLoaded=function(a,e){var s=e.id,l=e.details,n=this.tracksInGroup[s];if(n){var o=n.details;n.details=e.details,this.log("audioTrack "+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,o))}else this.warn("Invalid audio track id "+s)},t.onLevelLoading=function(a,e){this.switchLevel(e.level)},t.onLevelSwitching=function(a,e){this.switchLevel(e.level)},t.switchLevel=function(a){var e=this.hls.levels[a];if(e!=null&&e.audioGroupIds){var s=e.audioGroupIds[e.urlId];if(this.groupId!==s){this.groupId=s;var l=this.tracks.filter(function(o){return!s||o.groupId===s});this.selectDefaultTrack&&!l.some(function(o){return o.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var n={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},t.onError=function(a,e){A.prototype.onError.call(this,a,e),!e.fatal&&e.context&&e.context.type===R.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},t.setAudioTrack=function(a){var e=this.tracksInGroup;if(a<0||a>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var s=e[this.trackId];this.log("Now switching to audio-track index "+a);var l=e[a],n=l.id,o=l.groupId,v=o===void 0?"":o,f=l.name,g=l.type,r=l.url;if(this.trackId=a,this.trackName=f,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:v,name:f,type:g,url:r}),!l.details||l.details.live){var i=this.switchParams(l.url,s==null?void 0:s.details);this.loadPlaylist(i)}}},t.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,s=this.findTrackId(e)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},t.findTrackId=function(a){for(var e=this.tracksInGroup,s=0;s<e.length;s++){var l=e[s];if((!this.selectDefaultTrack||l.default)&&(!a||a===l.name))return l.id}return-1},t.loadPlaylist=function(a){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var s=e.id,l=e.groupId,n=e.url;if(a)try{n=a.addDirectives(n)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:l,deliveryDirectives:a||null})}},E=T,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}])&&C(E.prototype,u),T}(D.default);w.default=p},"./src/controller/base-playlist-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return m});var _=h("./src/polyfills/number.ts"),S=h("./src/types/level.ts"),D=h("./src/controller/level-helper.ts"),R=h("./src/utils/logger.ts"),C=h("./src/errors.ts"),m=function(){function p(y,c){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.logger.log.bind(R.logger,c+":"),this.warn=R.logger.warn.bind(R.logger,c+":"),this.hls=y}var A=p.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(y,c){c.fatal&&c.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(y,c){var T=c==null?void 0:c.renditionReports;if(T)for(var E=0;E<T.length;E++){var u=T[E],t=""+u.URI;if(t===y.substr(-t.length)){var a=parseInt(u["LAST-MSN"]),e=parseInt(u["LAST-PART"]);if(c&&this.hls.config.lowLatencyMode){var s=Math.min(c.age-c.partTarget,c.targetduration);e!==void 0&&s>c.partTarget&&(e+=1)}if(Object(_.isFiniteNumber)(a))return new S.HlsUrlParameters(a,Object(_.isFiniteNumber)(e)?e:void 0,S.HlsSkip.No)}}},A.loadPlaylist=function(y){},A.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},A.playlistLoaded=function(y,c,T){var E=this,u=c.details,t=c.stats,a=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(u.advancedDateTime=Date.now()-a,u.live||T!=null&&T.live){if(u.reloaded(T),T&&this.log("live playlist "+y+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),T&&u.fragments.length>0&&Object(D.mergeDetails)(T,u),!this.canLoad||!u.live)return;var e,s=void 0,l=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var n=this.hls.config.lowLatencyMode,o=u.lastPartSn,v=u.endSN,f=u.lastPartIndex,g=o===v;f!==-1?(s=g?v+1:o,l=g?n?0:f:f+1):s=v+1;var r=u.age,i=r+u.ageHeader,d=Math.min(i-u.partTarget,1.5*u.targetduration);if(d>0){if(T&&d>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+d+" with playlist age: "+u.age),d=0;else{var b=Math.floor(d/u.targetduration);s+=b,l!==void 0&&(l+=Math.round(d%u.targetduration/u.partTarget)),this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+d+" skip sn "+b+" to part "+l)}u.tuneInGoal=d}if(e=this.getDeliveryDirectives(u,c.deliveryDirectives,s,l),n||!g)return void this.loadPlaylist(e)}else e=this.getDeliveryDirectives(u,c.deliveryDirectives,s,l);var L=Object(D.computeReloadInterval)(u,t);s!==void 0&&u.canBlockReload&&(L-=u.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(L)+" ms"),this.timer=self.setTimeout(function(){return E.loadPlaylist(e)},L)}else this.clearTimer()},A.getDeliveryDirectives=function(y,c,T,E){var u=Object(S.getSkipValue)(y,T);return c!=null&&c.skip&&y.deltaUpdateFailed&&(T=c.msn,E=c.part,u=S.HlsSkip.No),new S.HlsUrlParameters(T,E,u)},A.retryLoadingOrFail=function(y){var c,T=this,E=this.hls.config,u=this.retryCount<E.levelLoadingMaxRetry;if(u)if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(c=y.context)!==null&&c!==void 0&&c.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+y.details+'"')}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return u},p}()},"./src/controller/base-stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"State",function(){return n}),h.d(w,"default",function(){return o});var _=h("./src/polyfills/number.ts"),S=h("./src/task-loop.ts"),D=h("./src/controller/fragment-tracker.ts"),R=h("./src/utils/buffer-helper.ts"),C=h("./src/utils/logger.ts"),m=h("./src/events.ts"),p=h("./src/errors.ts"),A=h("./src/types/transmuxer.ts"),y=h("./src/utils/mp4-tools.ts"),c=h("./src/utils/discontinuities.ts"),T=h("./src/controller/fragment-finders.ts"),E=h("./src/controller/level-helper.ts"),u=h("./src/loader/fragment-loader.ts"),t=h("./src/crypt/decrypter.ts"),a=h("./src/utils/time-ranges.ts"),e=h("./src/types/loader.ts");function s(v,f){for(var g=0;g<f.length;g++){var r=f[g];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(v,r.key,r)}}function l(v,f){return(l=Object.setPrototypeOf||function(g,r){return g.__proto__=r,g})(v,f)}var n={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},o=function(v){var f,g;function r(L,k,I){var O;return(O=v.call(this)||this).hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=n.STOPPED,O.media=void 0,O.mediaBuffer=void 0,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=I,O.log=C.logger.log.bind(C.logger,I+":"),O.warn=C.logger.warn.bind(C.logger,I+":"),O.hls=L,O.fragmentLoader=new u.default(L.config),O.fragmentTracker=k,O.config=L.config,O.decrypter=new t.default(L,L.config),L.on(m.Events.KEY_LOADED,O.onKeyLoaded,function(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(O)),O}g=v,(f=r).prototype=Object.create(g.prototype),f.prototype.constructor=f,l(f,g);var i,d,b=r.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(L){},b.stopLoad=function(){this.fragmentLoader.abort();var L=this.fragCurrent;L&&this.fragmentTracker.removeFragment(L),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=n.STOPPED},b._streamEnded=function(L,k){var I=this.fragCurrent,O=this.fragmentTracker;if(!k.live&&I&&I.sn===k.endSN&&!L.nextStart){var x=O.getState(I);return x===D.FragmentState.PARTIAL||x===D.FragmentState.OK}return!1},b.onMediaAttached=function(L,k){var I=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var O=this.config;this.levels&&O.autoStartLoad&&this.state===n.STOPPED&&this.startLoad(O.startPosition)},b.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var L=this.config,k=this.fragCurrent,I=this.media,O=this.mediaBuffer,x=this.state,P=I?I.currentTime:0,F=R.BufferHelper.bufferInfo(O||I,P,L.maxBufferHole);if(this.log("media seeking to "+(Object(_.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+x),x===n.ENDED)this.resetLoadingState();else if(k&&!F.len){var M=L.maxFragLookUpTolerance,B=k.start-M,U=P>k.start+k.duration+M;(P<B||U)&&(U&&k.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=P),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(L,k){if(this.state===n.KEY_LOADING&&k.frag===this.fragCurrent&&this.levels){this.state=n.IDLE;var I=this.levels[k.frag.level].details;I&&this.loadFragment(k.frag,I,k.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=n.STOPPED,this.hls.off(m.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(L,k){this.log("Loading key for "+L.sn+" of ["+k.startSN+"-"+k.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=n.KEY_LOADING,this.fragCurrent=L,this.hls.trigger(m.Events.KEY_LOADING,{frag:L})},b.loadFragment=function(L,k,I){this._loadFragForPlayback(L,k,I)},b._loadFragForPlayback=function(L,k,I){var O=this;this._doFragLoad(L,k,I,function(x){if(O.fragContextChanged(L))return O.warn("Fragment "+L.sn+(x.part?" p: "+x.part.index:"")+" of level "+L.level+" was dropped during download."),void O.fragmentTracker.removeFragment(L);L.stats.chunkCount++,O._handleFragmentLoadProgress(x)}).then(function(x){if(x){O.fragLoadError=0;var P=O.state;if(!O.fragContextChanged(L))return"payload"in x&&(O.log("Loaded fragment "+L.sn+" of level "+L.level),O.hls.trigger(m.Events.FRAG_LOADED,x),O.state===n.BACKTRACKING)?(O.fragmentTracker.backtrack(L,x),void O.resetFragmentLoading(L)):void O._handleFragmentLoadComplete(x);(P===n.FRAG_LOADING||P===n.BACKTRACKING||!O.fragCurrent&&P===n.PARSING)&&(O.fragmentTracker.removeFragment(L),O.state=n.IDLE)}}).catch(function(x){O.warn(x),O.resetFragmentLoading(L)})},b.flushMainBuffer=function(L,k,I){if(I===void 0&&(I=null),L-k){var O={startOffset:L,endOffset:k,type:I};this.fragLoadError=0,this.hls.trigger(m.Events.BUFFER_FLUSHING,O)}},b._loadInitSegment=function(L){var k=this;this._doFragLoad(L).then(function(I){if(!I||k.fragContextChanged(L)||!k.levels)throw new Error("init load aborted");return I}).then(function(I){var O=k.hls,x=I.payload,P=L.decryptdata;if(x&&x.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var F=self.performance.now();return k.decrypter.webCryptoDecrypt(new Uint8Array(x),P.key.buffer,P.iv.buffer).then(function(M){var B=self.performance.now();return O.trigger(m.Events.FRAG_DECRYPTED,{frag:L,payload:M,stats:{tstart:F,tdecrypt:B}}),I.payload=M,I})}return I}).then(function(I){var O=k.fragCurrent,x=k.hls,P=k.levels;if(!P)throw new Error("init load aborted, missing levels");var F=P[L.level].details;console.assert(F,"Level details are defined when init segment is loaded");var M=L.stats;k.state=n.IDLE,k.fragLoadError=0,L.data=new Uint8Array(I.payload),M.parsing.start=M.buffering.start=self.performance.now(),M.parsing.end=M.buffering.end=self.performance.now(),I.frag===O&&x.trigger(m.Events.FRAG_BUFFERED,{stats:M,frag:O,part:null,id:L.type}),k.tick()}).catch(function(I){k.warn(I),k.resetFragmentLoading(L)})},b.fragContextChanged=function(L){var k=this.fragCurrent;return!L||!k||L.level!==k.level||L.sn!==k.sn||L.urlId!==k.urlId},b.fragBufferedComplete=function(L,k){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(k?" part: "+k.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+a.default.toString(R.BufferHelper.getBuffered(I))),this.state=n.IDLE,this.tick()},b._handleFragmentLoadComplete=function(L){var k=this.transmuxer;if(k){var I=L.frag,O=L.part,x=L.partsLoaded,P=!x||x.length===0||x.some(function(M){return!M}),F=new A.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,O?O.index:-1,!P);k.flush(F)}},b._handleFragmentLoadProgress=function(L){},b._doFragLoad=function(L,k,I,O){var x=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(L.start,I||0),this.config.lowLatencyMode&&k){var P=k.partList;if(P&&O){I>L.end&&k.fragmentHint&&(L=k.fragmentHint);var F=this.getNextPart(P,L,I);if(F>-1){var M=P[F];return this.log("Loading part sn: "+L.sn+" p: "+M.index+" cc: "+L.cc+" of playlist ["+k.startSN+"-"+k.endSN+"] parts [0-"+F+"-"+(P.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=n.FRAG_LOADING,this.hls.trigger(m.Events.FRAG_LOADING,{frag:L,part:P[F],targetBufferTime:I}),this.doFragPartsLoad(L,P,F,O).catch(function(B){return x.handleFragLoadError(B)})}if(!L.url||this.loadedEndOfParts(P,I))return Promise.resolve(null)}}return this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(k?"of ["+k.startSN+"-"+k.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(I.toFixed(3))),Object(_.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=n.FRAG_LOADING,this.hls.trigger(m.Events.FRAG_LOADING,{frag:L,targetBufferTime:I}),this.fragmentLoader.load(L,O).catch(function(B){return x.handleFragLoadError(B)})},b.doFragPartsLoad=function(L,k,I,O){var x=this;return new Promise(function(P,F){var M=[];(function B(U){var G=k[U];x.fragmentLoader.loadPart(L,G,O).then(function(K){M[G.index]=K;var H=K.part;x.hls.trigger(m.Events.FRAG_LOADED,K);var Y=k[U+1];if(!Y||Y.fragment!==L)return P({frag:L,part:H,partsLoaded:M});B(U+1)}).catch(F)})(I)})},b.handleFragLoadError=function(L){var k=L.data;return k&&k.details===p.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(m.Events.ERROR,k),null},b._handleTransmuxerFlush=function(L){var k=this.getCurrentContext(L);if(k&&this.state===n.PARSING){var I=k.frag,O=k.part,x=k.level,P=self.performance.now();I.stats.parsing.end=P,O&&(O.stats.parsing.end=P),this.updateLevelTiming(I,O,x,L.partial)}else this.fragCurrent||(this.state=n.IDLE)},b.getCurrentContext=function(L){var k=this.levels,I=L.level,O=L.sn,x=L.part;if(!k||!k[I])return this.warn("Levels object was unset while buffering fragment "+O+" of level "+I+". The current chunk will not be buffered."),null;var P=k[I],F=x>-1?Object(E.getPartWith)(P,O,x):null,M=F?F.fragment:Object(E.getFragmentWithSN)(P,O,this.fragCurrent);return M?{frag:M,part:F,level:P}:null},b.bufferFragmentData=function(L,k,I,O){if(L&&this.state===n.PARSING){var x=L.data1,P=L.data2,F=x;if(x&&P&&(F=Object(y.appendUint8Array)(x,P)),F&&F.length){var M={type:L.type,frag:k,part:I,chunkMeta:O,parent:k.type,data:F};this.hls.trigger(m.Events.BUFFER_APPENDING,M),L.dropped&&L.independent&&!I&&this.flushBufferGap(k)}}},b.flushBufferGap=function(L){var k=this.media;if(k)if(R.BufferHelper.isBuffered(k,k.currentTime)){var I=k.currentTime,O=R.BufferHelper.bufferInfo(k,I,0),x=L.duration,P=Math.min(2*this.config.maxFragLookUpTolerance,.25*x),F=Math.max(Math.min(L.start-P,O.end-P),I+P);L.start-F>P&&this.flushMainBuffer(F,L.start)}else this.flushMainBuffer(0,L.start)},b.getFwdBufferInfo=function(L,k){var I=this.config,O=this.getLoadPosition();if(!Object(_.isFiniteNumber)(O))return null;var x=R.BufferHelper.bufferInfo(L,O,I.maxBufferHole);if(x.len===0&&x.nextStart!==void 0){var P=this.fragmentTracker.getBufferedFrag(O,k);if(P&&x.nextStart<P.end)return R.BufferHelper.bufferInfo(L,O,Math.max(x.nextStart,I.maxBufferHole))}return x},b.getMaxBufferLength=function(L){var k,I=this.config;return k=L?Math.max(8*I.maxBufferSize/L,I.maxBufferLength):I.maxBufferLength,Math.min(k,I.maxMaxBufferLength)},b.reduceMaxBufferLength=function(L){var k=this.config,I=L||k.maxBufferLength;return k.maxMaxBufferLength>=I&&(k.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+k.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(L,k){var I,O,x=k.fragments,P=x.length;if(!P)return null;var F,M=this.config,B=x[0].start;if(k.live){var U=M.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;k.PTSKnown||this.startFragRequested||this.startPosition!==-1||(F=this.getInitialLiveFragment(k,x),this.startPosition=F?this.hls.liveSyncPosition||F.start:L)}else L<=B&&(F=x[0]);if(!F){var G=M.lowLatencyMode?k.partEnd:k.fragmentEnd;F=this.getFragmentAtPosition(L,G,k)}return(I=F)===null||I===void 0||!I.initSegment||(O=F)!==null&&O!==void 0&&O.initSegment.data||this.bitrateTest||(F=F.initSegment),F},b.getNextPart=function(L,k,I){for(var O=-1,x=!1,P=!0,F=0,M=L.length;F<M;F++){var B=L[F];if(P=P&&!B.independent,O>-1&&I<B.start)break;var U=B.loaded;!U&&(x||B.independent||P)&&B.fragment===k&&(O=F),x=U}return O},b.loadedEndOfParts=function(L,k){var I=L[L.length-1];return I&&k>I.start&&I.loaded},b.getInitialLiveFragment=function(L,k){var I=this.fragPrevious,O=null;if(I){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),O=Object(T.findFragmentByPDT)(k,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!O){var x=I.sn+1;if(x>=L.startSN&&x<=L.endSN){var P=k[x-L.startSN];I.cc===P.cc&&(O=P,this.log("Live playlist, switching playlist, load frag with next SN: "+O.sn))}O||(O=Object(T.findFragWithCC)(k,I.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+O.sn)}}else{var F=this.hls.liveSyncPosition;F!==null&&(O=this.getFragmentAtPosition(F,this.bitrateTest?L.fragmentEnd:L.edge,L))}return O},b.getFragmentAtPosition=function(L,k,I){var O,x=this.config,P=this.fragPrevious,F=I.fragments,M=I.endSN,B=I.fragmentHint,U=x.maxFragLookUpTolerance,G=!!(x.lowLatencyMode&&I.partList&&B);if(G&&B&&!this.bitrateTest&&(F=F.concat(B),M=B.sn),L<k){var K=L>k-U?0:U;O=Object(T.findFragmentByPTS)(P,F,L,K)}else O=F[F.length-1];if(O){var H=O.sn-I.startSN,Y=P&&O.level===P.level,W=F[H+1];if(this.fragmentTracker.getState(O)===D.FragmentState.BACKTRACKED){O=null;for(var q=H;F[q]&&this.fragmentTracker.getState(F[q])===D.FragmentState.BACKTRACKED;)O=P?F[q--]:F[--q];O||(O=W)}else P&&O.sn===P.sn&&!G&&Y&&(O.sn<M&&this.fragmentTracker.getState(W)!==D.FragmentState.OK?(this.log("SN "+O.sn+" just loaded, load next one: "+W.sn),O=W):O=null)}return O},b.synchronizeToLiveEdge=function(L){var k=this.config,I=this.media;if(I){var O=this.hls.liveSyncPosition,x=I.currentTime,P=L.fragments[0].start,F=L.edge,M=x>=P-k.maxFragLookUpTolerance&&x<=F;if(O!==null&&I.duration>O&&(x<O||!M)){var B=k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:k.liveMaxLatencyDurationCount*L.targetduration;(!M&&I.readyState<4||x<F-B)&&(this.loadedmetadata||(this.nextLoadPosition=O),I.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+O.toFixed(3)),I.currentTime=O))}}},b.alignPlaylists=function(L,k){var I=this.levels,O=this.levelLastLoaded,x=this.fragPrevious,P=O!==null?I[O]:null,F=L.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var M=L.fragments[0].start,B=!k,U=L.alignedSliding&&Object(_.isFiniteNumber)(M);if(B||!U&&!M){Object(c.alignStream)(x,P,L);var G=L.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(k?k.startSN:"na")+"->"+L.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+F),G}return M},b.waitForCdnTuneIn=function(L){return L.live&&L.canBlockReload&&L.tuneInGoal>Math.max(L.partHoldBack,3*L.partTarget)},b.setStartPosition=function(L,k){var I=this.startPosition;if(I<k&&(I=-1),I===-1||this.lastCurrentTime===-1){var O=L.startTimeOffset;Object(_.isFiniteNumber)(O)?(I=k+O,O<0&&(I+=L.totalduration),I=Math.min(Math.max(k,I),k+L.totalduration),this.log("Start time offset "+O+" found in playlist, adjust startPosition to "+I),this.startPosition=I):L.live?I=this.hls.liveSyncPosition||k:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},b.getLoadPosition=function(){var L=this.media,k=0;return this.loadedmetadata&&L?k=L.currentTime:this.nextLoadPosition&&(k=this.nextLoadPosition),k},b.handleFragLoadAborted=function(L,k){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(k?" part"+k.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},b.resetFragmentLoading=function(L){this.fragCurrent&&this.fragContextChanged(L)||(this.state=n.IDLE)},b.onFragmentOrKeyLoadError=function(L,k){if(!k.fatal){var I=k.frag;if(I&&I.type===L){var O=this.fragCurrent;console.assert(O&&I.sn===O.sn&&I.level===O.level&&I.urlId===O.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var P=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+L+" "+I.level+" failed to load, retrying in "+P+"ms"),this.retryDate=self.performance.now()+P,this.fragLoadError++,this.state=n.FRAG_LOADING_WAITING_RETRY}else k.levelRetry?(L===e.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=n.IDLE):(C.logger.error(k.details+" reaches max retry, redispatch as fatal ..."),k.fatal=!0,this.hls.stopLoad(),this.state=n.ERROR)}}},b.afterBufferFlushed=function(L,k,I){if(L){var O=R.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(k,O,I),this.state===n.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=n.IDLE},b.resetLiveStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var k=this.levels?this.levels[L].details:null;if(k!=null&&k.live)return this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(L,k,I,O){var x=this,P=I.details;console.assert(!!P,"level.details must be defined"),Object.keys(L.elementaryStreams).reduce(function(F,M){var B=L.elementaryStreams[M];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return x.warn("Could not parse fragment "+L.sn+" "+M+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),x.resetTransmuxer(),F||!1;var G=O?0:Object(E.updateFragPTSDTS)(P,L,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return x.hls.trigger(m.Events.LEVEL_PTS_UPDATED,{details:P,level:I,drift:G,type:M,frag:L,start:B.startPTS,end:B.endPTS}),!0}return F},!1)?(this.state=n.PARSED,this.hls.trigger(m.Events.FRAG_PARSED,{frag:L,part:k})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=r,(d=[{key:"state",get:function(){return this._state},set:function(L){var k=this._state;k!==L&&(this._state=L,this.log(k+"->"+L))}}])&&s(i.prototype,d),r}(S.default)},"./src/controller/buffer-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return T});var _=h("./src/polyfills/number.ts"),S=h("./src/events.ts"),D=h("./src/utils/logger.ts"),R=h("./src/errors.ts"),C=h("./src/utils/buffer-helper.ts"),m=h("./src/utils/mediasource-helper.ts"),p=h("./src/loader/fragment.ts"),A=h("./src/controller/buffer-operation-queue.ts"),y=Object(m.getMediaSource)(),c=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function E(t){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=a.hls,s=a.media,l=a.mediaSource;D.logger.log("[buffer-controller]: Media source opened"),s&&(a.updateMediaElementDuration(),e.trigger(S.Events.MEDIA_ATTACHED,{media:s})),l&&l.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){D.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){D.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var u=E.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null},u.registerListeners=function(){var t=this.hls;t.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(S.Events.BUFFER_RESET,this.onBufferReset,this),t.on(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(S.Events.BUFFER_EOS,this.onBufferEos,this),t.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(S.Events.FRAG_PARSED,this.onFragParsed,this),t.on(S.Events.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var t=this.hls;t.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(S.Events.BUFFER_RESET,this.onBufferReset,this),t.off(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(S.Events.BUFFER_EOS,this.onBufferEos,this),t.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(S.Events.FRAG_PARSED,this.onFragParsed,this),t.off(S.Events.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},u.onManifestParsed=function(t,a){var e=2;(a.audio&&!a.video||!a.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,D.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(t,a){var e=this.media=a.media;if(e&&y){var s=this.mediaSource=new y;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(s),this._objectUrl=e.src}},u.onMediaDetaching=function(){var t=this.media,a=this.mediaSource,e=this._objectUrl;if(a){if(D.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(s){D.logger.warn("[buffer-controller]: onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):D.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(S.Events.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(a){var e=t.sourceBuffer[a];try{e&&(t.removeBufferListeners(a),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[a]=void 0)}catch(s){D.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",s)}}),this._initSourceBuffer()},u.onBufferCodecs=function(t,a){var e=this,s=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(l){if(s){var n=e.tracks[l];if(n&&typeof n.buffer.changeType=="function"){var o=a[l],v=o.codec,f=o.levelCodec,g=o.container;if((n.levelCodec||n.codec).replace(c,"$1")!==(f||v).replace(c,"$1")){var r=g+";codecs="+(f||v);e.appendChangeType(l,r)}}}else e.pendingTracks[l]=a[l]}),s||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},u.appendChangeType=function(t,a){var e=this,s=this.operationQueue,l={execute:function(){var n=e.sourceBuffer[t];n&&(D.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+a),n.changeType(a)),s.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(n){D.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",n)}};s.append(l,t)},u.onBufferAppending=function(t,a){var e=this,s=this.hls,l=this.operationQueue,n=this.tracks,o=a.data,v=a.type,f=a.frag,g=a.part,r=a.chunkMeta,i=r.buffering[v],d=self.performance.now();i.start=d;var b=f.stats.buffering,L=g?g.stats.buffering:null;b.start===0&&(b.start=d),L&&L.start===0&&(L.start=d);var k=n.audio,I=v==="audio"&&r.id===1&&(k==null?void 0:k.container)==="audio/mpeg",O={execute:function(){if(i.executeStart=self.performance.now(),I){var x=e.sourceBuffer[v];if(x){var P=f.start-x.timestampOffset;Math.abs(P)>=.1&&(D.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+P+") sn: "+f.sn+")"),x.timestampOffset=f.start)}}e.appendExecutor(o,v)},onStart:function(){},onComplete:function(){var x=self.performance.now();i.executeEnd=i.end=x,b.first===0&&(b.first=x),L&&L.first===0&&(L.first=x);var P=e.sourceBuffer,F={};for(var M in P)F[M]=C.BufferHelper.getBuffered(P[M]);e.appendError=0,e.hls.trigger(S.Events.BUFFER_APPENDED,{type:v,frag:f,part:g,chunkMeta:r,parent:f.type,timeRanges:F})},onError:function(x){D.logger.error("[buffer-controller]: Error encountered while trying to append to the "+v+" SourceBuffer",x);var P={type:R.ErrorTypes.MEDIA_ERROR,parent:f.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:x,fatal:!1};x.code===DOMException.QUOTA_EXCEEDED_ERR?P.details=R.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,P.details=R.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>s.config.appendErrorMaxRetry&&(D.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),P.fatal=!0)),s.trigger(S.Events.ERROR,P)}};l.append(O,v)},u.onBufferFlushing=function(t,a){var e=this,s=this.operationQueue,l=function(n){return{execute:e.removeExecutor.bind(e,n,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(S.Events.BUFFER_FLUSHED,{type:n})},onError:function(o){D.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",o)}}};a.type?s.append(l(a.type),a.type):this.getSourceBufferTypes().forEach(function(n){s.append(l(n),n)})},u.onFragParsed=function(t,a){var e=this,s=a.frag,l=a.part,n=[],o=l?l.elementaryStreams:s.elementaryStreams;o[p.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(o[p.ElementaryStreamTypes.AUDIO]&&n.push("audio"),o[p.ElementaryStreamTypes.VIDEO]&&n.push("video")),n.length===0&&D.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var v=self.performance.now();s.stats.buffering.end=v,l&&(l.stats.buffering.end=v);var f=l?l.stats:s.stats;e.hls.trigger(S.Events.FRAG_BUFFERED,{frag:s,part:l,stats:f,id:s.type})},n)},u.onFragChanged=function(t,a){this.flushBackBuffer()},u.onBufferEos=function(t,a){var e=this;this.getSourceBufferTypes().reduce(function(s,l){var n=e.sourceBuffer[l];return a.type&&a.type!==l||n&&!n.ended&&(n.ended=!0,D.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS")),s&&!(n&&!n.ended)},!0)&&this.blockBuffers(function(){var s=e.mediaSource;s&&s.readyState==="open"&&s.endOfStream()})},u.onLevelUpdated=function(t,a){var e=a.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.flushBackBuffer=function(){var t=this.hls,a=this.details,e=this.media,s=this.sourceBuffer;if(e&&a!==null){var l=this.getSourceBufferTypes();if(l.length){var n=a.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(_.isFiniteNumber)(n)&&!(n<0)){var o=e.currentTime,v=a.levelTargetDuration,f=Math.max(n,v),g=Math.floor(o/v)*v-f;l.forEach(function(r){var i=s[r];if(i){var d=C.BufferHelper.getBuffered(i);d.length>0&&g>d.start(0)&&(t.trigger(S.Events.BACK_BUFFER_REACHED,{bufferEnd:g}),a.live&&t.trigger(S.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g}),t.trigger(S.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:r}))}})}}}},u.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,a=this.hls,e=this.media,s=this.mediaSource,l=t.fragments[0].start+t.totalduration,n=e.duration,o=Object(_.isFiniteNumber)(s.duration)?s.duration:0;t.live&&a.config.liveDurationInfinity?(D.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(t)):(l>o&&l>n||!Object(_.isFiniteNumber)(n))&&(D.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),s.duration=l)}},u.updateSeekableRange=function(t){var a=this.mediaSource,e=t.fragments;if(e.length&&t.live&&a!=null&&a.setLiveSeekableRange){var s=Math.max(0,e[0].start),l=Math.max(s,s+t.totalduration);a.setLiveSeekableRange(s,l)}},u.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,a=this.operationQueue,e=this.pendingTracks,s=Object.keys(e).length;if(s&&!t||s===2){this.createSourceBuffers(e),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0)return void this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});l.forEach(function(n){a.executeNext(n)})}},u.createSourceBuffers=function(t){var a=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var s=0;for(var l in t)if(!a[l]){var n=t[l];if(!n)throw Error("source buffer exists for track "+l+", however track does not");var o=n.levelCodec||n.codec,v=n.container+";codecs="+o;D.logger.log("[buffer-controller]: creating sourceBuffer("+v+")");try{var f=a[l]=e.addSourceBuffer(v),g=l;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.tracks[l]={buffer:f,codec:o,container:n.container,levelCodec:n.levelCodec,id:n.id},s++}catch(r){D.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:v})}}s&&this.hls.trigger(S.Events.BUFFER_CREATED,{tracks:this.tracks})},u._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},u._onSBUpdateEnd=function(t){var a=this.operationQueue;a.current(t).onComplete(),a.shiftAndExecuteNext(t)},u._onSBUpdateError=function(t,a){D.logger.error("[buffer-controller]: "+t+" SourceBuffer error",a),this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(a)},u.removeExecutor=function(t,a,e){var s=this.media,l=this.mediaSource,n=this.operationQueue,o=this.sourceBuffer[t];if(!s||!l||!o)return D.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(t);var v=Object(_.isFiniteNumber)(s.duration)?s.duration:1/0,f=Object(_.isFiniteNumber)(l.duration)?l.duration:1/0,g=Math.max(0,a),r=Math.min(e,v,f);r>g?(D.logger.log("[buffer-controller]: Removing ["+g+","+r+"] from the "+t+" SourceBuffer"),console.assert(!o.updating,t+" sourceBuffer must not be updating"),o.remove(g,r)):n.shiftAndExecuteNext(t)},u.appendExecutor=function(t,a){var e=this.operationQueue,s=this.sourceBuffer[a];if(!s)return D.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(a);s.ended=!1,console.assert(!s.updating,a+" sourceBuffer must not be updating"),s.appendBuffer(t)},u.blockBuffers=function(t,a){var e=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length)return D.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var s=this.operationQueue,l=a.map(function(n){return s.appendBlocker(n)});Promise.all(l).then(function(){t(),a.forEach(function(n){var o=e.sourceBuffer[n];o&&o.updating||s.shiftAndExecuteNext(n)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(t,a,e){var s=this.sourceBuffer[t];if(s){var l=e.bind(this,t);this.listeners[t].push({event:a,listener:l}),s.addEventListener(a,l)}},u.removeBufferListeners=function(t){var a=this.sourceBuffer[t];a&&this.listeners[t].forEach(function(e){a.removeEventListener(e.event,e.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return S});var _=h("./src/utils/logger.ts"),S=function(){function D(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var R=D.prototype;return R.append=function(C,m){var p=this.queues[m];p.push(C),p.length===1&&this.buffers[m]&&this.executeNext(m)},R.insertAbort=function(C,m){this.queues[m].unshift(C),this.executeNext(m)},R.appendBlocker=function(C){var m,p=new Promise(function(y){m=y}),A={execute:m,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(A,C),p},R.executeNext=function(C){var m=this.buffers,p=this.queues,A=m[C],y=p[C];if(y.length){var c=y[0];try{c.execute()}catch(T){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),c.onError(T),A&&A.updating||(y.shift(),this.executeNext(C))}}},R.shiftAndExecuteNext=function(C){this.queues[C].shift(),this.executeNext(C)},R.current=function(C){return this.queues[C][0]},D}()},"./src/controller/cap-level-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts");function S(R,C){for(var m=0;m<C.length;m++){var p=C[m];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(R,p.key,p)}}var D=function(){function R(y){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=y,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var C,m,p,A=R.prototype;return A.setStreamController=function(y){this.streamController=y},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var y=this.hls;y.on(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var y=this.hls;y.off(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(y,c){R.isLevelAllowed(c.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(c.droppedLevel)},A.onMediaAttaching=function(y,c){this.media=c.media instanceof HTMLVideoElement?c.media:null},A.onManifestParsed=function(y,c){var T=this.hls;this.restrictedLevels=[],this.firstLevel=c.firstLevel,T.config.capLevelToPlayerSize&&c.video&&this.startCapping()},A.onBufferCodecs=function(y,c){this.hls.config.capLevelToPlayerSize&&c.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var y=this.hls.levels;if(y.length){var c=this.hls;c.autoLevelCapping=this.getMaxLevel(y.length-1),c.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=c.autoLevelCapping}}},A.getMaxLevel=function(y){var c=this,T=this.hls.levels;if(!T.length)return-1;var E=T.filter(function(u,t){return R.isLevelAllowed(t,c.restrictedLevels)&&t<=y});return this.clientRect=null,R.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var y=this.media,c={width:0,height:0};if(y){var T=y.getBoundingClientRect();c.width=T.width,c.height=T.height,c.width||c.height||(c.width=T.right-T.left||y.width||0,c.height=T.bottom-T.top||y.height||0)}return this.clientRect=c,c},R.isLevelAllowed=function(y,c){return c===void 0&&(c=[]),c.indexOf(y)===-1},R.getMaxLevelByMediaSize=function(y,c,T){if(!y||!y.length)return-1;for(var E,u,t=y.length-1,a=0;a<y.length;a+=1){var e=y[a];if((e.width>=c||e.height>=T)&&(E=e,!(u=y[a+1])||E.width!==u.width||E.height!==u.height)){t=a;break}}return t},C=R,p=[{key:"contentScaleFactor",get:function(){var y=1;try{y=self.devicePixelRatio}catch{}return y}}],(m=[{key:"mediaWidth",get:function(){return this.getDimensions().width*R.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*R.contentScaleFactor}}])&&S(C.prototype,m),p&&S(C,p),R}();w.default=D},"./src/controller/eme-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),S=h("./src/errors.ts"),D=h("./src/utils/logger.ts"),R=h("./src/utils/mediakeys-helper.ts");function C(p,A){for(var y=0;y<A.length;y++){var c=A[y];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(p,c.key,c)}}var m=function(){function p(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var A,y,c=p.prototype;return c.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},c._registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c._unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c.getLicenseServerUrl=function(T){switch(T){case R.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+T+'"')},c._attemptKeySystemAccess=function(T,E,u){var t=this,a=function(s,l,n,o){switch(s){case R.KeySystems.WIDEVINE:return function(v,f,g){var r={audioCapabilities:[],videoCapabilities:[]};return v.forEach(function(i){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+i+'"',robustness:g.audioRobustness||""})}),f.forEach(function(i){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+i+'"',robustness:g.videoRobustness||""})}),[r]}(l,n,o);default:throw new Error("Unknown key-system: "+s)}}(T,E,u,this._drmSystemOptions);D.logger.log("Requesting encrypted media key-system access");var e=this.requestMediaKeySystemAccess(T,a);this.mediaKeysPromise=e.then(function(s){return t._onMediaKeySystemAccessObtained(T,s)}),e.catch(function(s){D.logger.error('Failed to obtain key-system "'+T+'" access:',s)})},c._onMediaKeySystemAccessObtained=function(T,E){var u=this;D.logger.log('Access for key-system "'+T+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:E,mediaKeySystemDomain:T};this._mediaKeysList.push(t);var a=Promise.resolve().then(function(){return E.createMediaKeys()}).then(function(e){return t.mediaKeys=e,D.logger.log('Media-keys created for key-system "'+T+'"'),u._onMediaKeysCreated(),e});return a.catch(function(e){D.logger.error("Failed to create media-keys:",e)}),a},c._onMediaKeysCreated=function(){var T=this;this._mediaKeysList.forEach(function(E){E.mediaKeysSession||(E.mediaKeysSession=E.mediaKeys.createSession(),T._onNewMediaKeySession(E.mediaKeysSession))})},c._onNewMediaKeySession=function(T){var E=this;D.logger.log("New key-system session "+T.sessionId),T.addEventListener("message",function(u){E._onKeySessionMessage(T,u.message)},!1)},c._onKeySessionMessage=function(T,E){D.logger.log("Got EME message event, creating license request"),this._requestLicense(E,function(u){D.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),T.update(u)})},c.onMediaEncrypted=function(T){var E=this;if(D.logger.log('Media is encrypted using "'+T.initDataType+'" init data type'),!this.mediaKeysPromise)return D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var u=function(t){E._media&&(E._attemptSetMediaKeys(t),E._generateRequestWithPreferredKeySession(T.initDataType,T.initData))};this.mediaKeysPromise.then(u).catch(u)},c._attemptSetMediaKeys=function(T){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var E=this._mediaKeysList[0];if(!E||!E.mediaKeys)return D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});D.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(E.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(T,E){var u=this,t=this._mediaKeysList[0];if(!t)return D.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)D.logger.warn("Key-Session already initialized but requested again");else{var a=t.mediaKeysSession;if(!a)return D.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!E)return D.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});D.logger.log('Generating key-session request for "'+T+'" init data type'),t.mediaKeysSessionInitialized=!0,a.generateRequest(T,E).then(function(){D.logger.debug("Key-session generation succeeded")}).catch(function(e){D.logger.error("Error generating key-session request:",e),u.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},c._createLicenseXhr=function(T,E,u){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,T,E,u);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,t,T),a=void 0}catch(e){D.logger.error(e)}try{t.readyState||t.open("POST",T,!0),a&&a.call(this.hls,t,T)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return t},c._onLicenseRequestReadyStageChange=function(T,E,u,t){switch(T.readyState){case 4:if(T.status===200){this._requestLicenseFailureCount=0,D.logger.log("License request succeeded");var a=T.response,e=this._licenseResponseCallback;if(e)try{a=e.call(this.hls,T,E)}catch(l){D.logger.error(l)}t(a)}else{if(D.logger.error("License Request XHR failed ("+E+"). Status: "+T.status+" ("+T.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var s=3-this._requestLicenseFailureCount+1;D.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(u,t)}}},c._generateLicenseRequestChallenge=function(T,E){switch(T.mediaKeySystemDomain){case R.KeySystems.WIDEVINE:return E}throw new Error("unsupported key-system: "+T.mediaKeySystemDomain)},c._requestLicense=function(T,E){D.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u)return D.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var t=this.getLicenseServerUrl(u.mediaKeySystemDomain),a=this._createLicenseXhr(t,T,E);D.logger.log("Sending license request to URL: "+t);var e=this._generateLicenseRequestChallenge(u,T);a.send(e)}catch(s){D.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(T,E){if(this._emeEnabled){var u=E.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var T=this._media,E=this._mediaKeysList;T&&(T.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(E.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return T.setMediaKeys(null)}).catch(function(){}))},c.onManifestParsed=function(T,E){if(this._emeEnabled){var u=E.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),t=E.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(R.KeySystems.WIDEVINE,u,t)}},A=p,(y=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&C(A.prototype,y),p}();w.default=m},"./src/controller/fps-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),S=h("./src/utils/logger.ts"),D=function(){function R(m){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=m,this.registerListeners()}var C=R.prototype;return C.setStreamController=function(m){this.streamController=m},C.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(m,p){var A=this.hls.config;if(A.capLevelOnFPSDrop){var y=p.media instanceof self.HTMLVideoElement?p.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),A.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(m,p,A){var y=performance.now();if(p){if(this.lastTime){var c=y-this.lastTime,T=A-this.lastDroppedFrames,E=p-this.lastDecodedFrames,u=1e3*T/c,t=this.hls;if(t.trigger(_.Events.FPS_DROP,{currentDropped:T,currentDecoded:E,totalDroppedFrames:A}),u>0&&T>t.config.fpsDroppedMonitoringThreshold*E){var a=t.currentLevel;S.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=a)&&(a-=1,t.trigger(_.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:t.currentLevel}),t.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=A,this.lastDecodedFrames=p}},C.checkFPSInterval=function(){var m=this.media;if(m)if(this.isVideoPlaybackQualityAvailable){var p=m.getVideoPlaybackQuality();this.checkFPS(m,p.totalVideoFrames,p.droppedVideoFrames)}else this.checkFPS(m,m.webkitDecodedFrameCount,m.webkitDroppedFrameCount)},R}();w.default=D},"./src/controller/fragment-finders.ts":function(N,w,h){h.r(w),h.d(w,"findFragmentByPDT",function(){return D}),h.d(w,"findFragmentByPTS",function(){return R}),h.d(w,"fragmentWithinToleranceTest",function(){return C}),h.d(w,"pdtWithinToleranceTest",function(){return m}),h.d(w,"findFragWithCC",function(){return p});var _=h("./src/polyfills/number.ts"),S=h("./src/utils/binary-search.ts");function D(A,y,c){if(y===null||!Array.isArray(A)||!A.length||!Object(_.isFiniteNumber)(y)||y<(A[0].programDateTime||0)||y>=(A[A.length-1].endProgramDateTime||0))return null;c=c||0;for(var T=0;T<A.length;++T){var E=A[T];if(m(y,c,E))return E}return null}function R(A,y,c,T){c===void 0&&(c=0),T===void 0&&(T=0);var E=null;if(A?E=y[A.sn-y[0].sn+1]||null:c===0&&y[0].start===0&&(E=y[0]),E&&C(c,T,E)===0)return E;var u=S.default.search(y,C.bind(null,c,T));return u||E}function C(A,y,c){A===void 0&&(A=0),y===void 0&&(y=0);var T=Math.min(y,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-T<=A?1:c.start-T>A&&c.start?-1:0}function m(A,y,c){var T=1e3*Math.min(y,c.duration+(c.deltaPTS?c.deltaPTS:0));return(c.endProgramDateTime||0)-T>A}function p(A,y){return S.default.search(A,function(c){return c.cc<y?1:c.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(N,w,h){h.r(w),h.d(w,"FragmentState",function(){return _}),h.d(w,"FragmentTracker",function(){return C});var _,S,D=h("./src/events.ts"),R=h("./src/types/loader.ts");(S=_||(_={})).NOT_LOADED="NOT_LOADED",S.BACKTRACKED="BACKTRACKED",S.APPENDING="APPENDING",S.PARTIAL="PARTIAL",S.OK="OK";var C=function(){function A(c){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=c,this._registerListeners()}var y=A.prototype;return y._registerListeners=function(){var c=this.hls;c.on(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.on(D.Events.FRAG_LOADED,this.onFragLoaded,this)},y._unregisterListeners=function(){var c=this.hls;c.off(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.off(D.Events.FRAG_LOADED,this.onFragLoaded,this)},y.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},y.getAppendedFrag=function(c,T){if(T===R.PlaylistLevelType.MAIN){var E=this.activeFragment,u=this.activeParts;if(!E)return null;if(u)for(var t=u.length;t--;){var a=u[t],e=a?a.end:E.appendedPTS;if(a.start<=c&&e!==void 0&&c<=e)return t>9&&(this.activeParts=u.slice(t-9)),a}else if(E.start<=c&&E.appendedPTS!==void 0&&c<=E.appendedPTS)return E}return this.getBufferedFrag(c,T)},y.getBufferedFrag=function(c,T){for(var E=this.fragments,u=Object.keys(E),t=u.length;t--;){var a=E[u[t]];if((a==null?void 0:a.body.type)===T&&a.buffered){var e=a.body;if(e.start<=c&&c<=e.end)return e}}return null},y.detectEvictedFragments=function(c,T,E){var u=this;Object.keys(this.fragments).forEach(function(t){var a=u.fragments[t];if(a)if(a.buffered){var e=a.range[c];e&&e.time.some(function(s){var l=!u.isTimeBuffered(s.startPTS,s.endPTS,T);return l&&u.removeFragment(a.body),l})}else a.body.type===E&&u.removeFragment(a.body)})},y.detectPartialFragments=function(c){var T=this,E=this.timeRanges,u=c.frag,t=c.part;if(E&&u.sn!=="initSegment"){var a=p(u),e=this.fragments[a];e&&(Object.keys(E).forEach(function(s){var l=u.elementaryStreams[s];if(l){var n=E[s],o=t!==null||l.partial===!0;e.range[s]=T.getBufferedTimes(u,t,o,n)}}),e.backtrack=e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},y.fragBuffered=function(c){var T=p(c),E=this.fragments[T];E&&(E.backtrack=E.loaded=null,E.buffered=!0)},y.getBufferedTimes=function(c,T,E,u){for(var t={time:[],partial:E},a=T?T.start:c.start,e=T?T.end:c.end,s=c.minEndPTS||e,l=c.maxStartPTS||a,n=0;n<u.length;n++){var o=u.start(n)-this.bufferPadding,v=u.end(n)+this.bufferPadding;if(l>=o&&s<=v){t.time.push({startPTS:Math.max(a,u.start(n)),endPTS:Math.min(e,u.end(n))});break}if(a<v&&e>o)t.partial=!0,t.time.push({startPTS:Math.max(a,u.start(n)),endPTS:Math.min(e,u.end(n))});else if(e<=o)break}return t},y.getPartialFragment=function(c){var T,E,u,t=null,a=0,e=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(l){var n=s[l];n&&m(n)&&(E=n.body.start-e,u=n.body.end+e,c>=E&&c<=u&&(T=Math.min(c-E,u-c),a<=T&&(t=n.body,a=T)))}),t},y.getState=function(c){var T=p(c),E=this.fragments[T];return E?E.buffered?m(E)?_.PARTIAL:_.OK:E.backtrack?_.BACKTRACKED:_.APPENDING:_.NOT_LOADED},y.backtrack=function(c,T){var E=p(c),u=this.fragments[E];if(!u||u.backtrack)return null;var t=u.backtrack=T||u.loaded;return u.loaded=null,t},y.getBacktrackData=function(c){var T=p(c),E=this.fragments[T];if(E){var u,t=E.backtrack;if(t!=null&&(u=t.payload)!==null&&u!==void 0&&u.byteLength)return t;this.removeFragment(c)}return null},y.isTimeBuffered=function(c,T,E){for(var u,t,a=0;a<E.length;a++){if(u=E.start(a)-this.bufferPadding,t=E.end(a)+this.bufferPadding,c>=u&&T<=t)return!0;if(T<=u)return!1}return!1},y.onFragLoaded=function(c,T){var E=T.frag,u=T.part;if(E.sn!=="initSegment"&&!E.bitrateTest&&!u){var t=p(E);this.fragments[t]={body:E,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},y.onBufferAppended=function(c,T){var E=this,u=T.frag,t=T.part,a=T.timeRanges;if(u.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=u,t){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(t)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(s){var l=a[s];if(E.detectEvictedFragments(s,l),!t)for(var n=0;n<l.length;n++)u.appendedPTS=Math.max(l.end(n),u.appendedPTS||0)})},y.onFragBuffered=function(c,T){this.detectPartialFragments(T)},y.hasFragment=function(c){var T=p(c);return!!this.fragments[T]},y.removeFragmentsInRange=function(c,T,E){var u=this;Object.keys(this.fragments).forEach(function(t){var a=u.fragments[t];if(a&&a.buffered){var e=a.body;e.type===E&&e.start<T&&e.end>c&&u.removeFragment(e)}})},y.removeFragment=function(c){var T=p(c);c.stats.loaded=0,c.clearElementaryStreamInfo(),delete this.fragments[T]},y.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function m(A){var y,c;return A.buffered&&(((y=A.range.video)===null||y===void 0?void 0:y.partial)||((c=A.range.audio)===null||c===void 0?void 0:c.partial))}function p(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(N,w,h){h.r(w),h.d(w,"STALL_MINIMUM_DURATION_MS",function(){return C}),h.d(w,"MAX_START_GAP_JUMP",function(){return m}),h.d(w,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return p}),h.d(w,"SKIP_BUFFER_RANGE_START",function(){return A}),h.d(w,"default",function(){return y});var _=h("./src/utils/buffer-helper.ts"),S=h("./src/errors.ts"),D=h("./src/events.ts"),R=h("./src/utils/logger.ts"),C=250,m=2,p=.1,A=.05,y=function(){function c(E,u,t,a){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=u,this.fragmentTracker=t,this.hls=a}var T=c.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(E){var u=this.config,t=this.media,a=this.stalled,e=t.currentTime,s=t.seeking,l=this.seeking&&!s,n=!this.seeking&&s;if(this.seeking=s,e===E){if((n||l)&&(this.stalled=null),!t.paused&&!t.ended&&t.playbackRate!==0&&_.BufferHelper.getBuffered(t).length){var o=_.BufferHelper.bufferInfo(t,e,0),v=o.len>0,f=o.nextStart||0;if(v||f){if(s){var g=o.len>m,r=!f||f-e>m&&!this.fragmentTracker.getPartialFragment(e);if(g||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var i,d=Math.max(f,o.start||0)-e,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=!(b==null||(i=b.details)===null||i===void 0)&&i.live?2*b.details.targetduration:m;if(d>0&&d<=L)return void this._trySkipBufferHole(null)}var k=self.performance.now();if(a!==null){var I=k-a;!s&&I>=C&&this._reportStall(o.len);var O=_.BufferHelper.bufferInfo(t,e,u.maxBufferHole);this._tryFixBufferStall(O,I)}else this.stalled=k}}}else if(this.moved=!0,a!==null){if(this.stallReported){var x=self.performance.now()-a;R.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(x)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},T._tryFixBufferStall=function(E,u){var t=this.config,a=this.fragmentTracker,e=this.media.currentTime,s=a.getPartialFragment(e);s&&this._trySkipBufferHole(s)||E.len>t.maxBufferHole&&u>1e3*t.highBufferWatchdogPeriod&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(E){var u=this.hls,t=this.media;this.stallReported||(this.stallReported=!0,R.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+E+")"),u.trigger(D.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:E}))},T._trySkipBufferHole=function(E){for(var u=this.config,t=this.hls,a=this.media,e=a.currentTime,s=0,l=_.BufferHelper.getBuffered(a),n=0;n<l.length;n++){var o=l.start(n);if(e+u.maxBufferHole>=s&&e<o){var v=Math.max(o+A,a.currentTime+p);return R.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,E&&t.trigger(D.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+v,frag:E}),v}s=l.end(n)}return 0},T._tryNudgeBuffer=function(){var E=this.config,u=this.hls,t=this.media,a=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<E.nudgeMaxRetry){var s=a+e*E.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+a+" to "+s),t.currentTime=s,u.trigger(D.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+E.nudgeMaxRetry+" nudges"),u.trigger(D.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},c}()},"./src/controller/id3-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),S=h("./src/utils/texttrack-utils.ts"),D=h("./src/demux/id3.ts"),R=function(){function C(p){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=p,this._registerListeners()}var m=C.prototype;return m.destroy=function(){this._unregisterListeners()},m._registerListeners=function(){var p=this.hls;p.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),p.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var p=this.hls;p.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),p.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.onMediaAttached=function(p,A){this.media=A.media},m.onMediaDetaching=function(){this.id3Track&&(Object(S.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},m.getID3Track=function(p){if(this.media){for(var A=0;A<p.length;A++){var y=p[A];if(y.kind==="metadata"&&y.label==="id3")return Object(S.sendAddTrackEvent)(y,this.media),y}return this.media.addTextTrack("metadata","id3")}},m.onFragParsingMetadata=function(p,A){if(this.media){var y=A.frag,c=A.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var T=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,E=0;E<c.length;E++){var u=D.getID3Frames(c[E].data);if(u){var t=c[E].pts,a=E<c.length-1?c[E+1].pts:y.end;a-t<=0&&(a=t+.25);for(var e=0;e<u.length;e++){var s=u[e];if(!D.isTimeStampFrame(s)){var l=new T(t,a,"");l.value=s,this.id3Track.addCue(l)}}}}}},m.onBufferFlushing=function(p,A){var y=A.startOffset,c=A.endOffset,T=A.type;if(!T||T==="audio"){var E=this.id3Track;E&&Object(S.removeCuesInRange)(E,y,c)}},C}();w.default=R},"./src/controller/latency-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return C});var _=h("./src/errors.ts"),S=h("./src/events.ts"),D=h("./src/utils/logger.ts");function R(m,p){for(var A=0;A<p.length;A++){var y=p[A];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}var C=function(){function m(c){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=c,this.config=c.config,this.registerListeners()}var p,A,y=m.prototype;return y.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},y.registerListeners=function(){this.hls.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(S.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){this.hls.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(S.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(S.Events.ERROR,this.onError)},y.onMediaAttached=function(c,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},y.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},y.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},y.onLevelUpdated=function(c,T){var E=T.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},y.onError=function(c,T){T.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,D.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},y.timeupdate=function(){var c=this.media,T=this.levelDetails;if(c&&T){this.currentTime=c.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var u=this.config,t=u.lowLatencyMode,a=u.maxLiveSyncPlaybackRate;if(t&&a!==1){var e=this.targetLatency;if(e!==null){var s=E-e,l=s<Math.min(this.maxLatency,e+T.targetduration);if(T.live&&l&&s>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,a)),o=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;c.playbackRate=Math.min(n,Math.max(1,o))}else c.playbackRate!==1&&c.playbackRate!==0&&(c.playbackRate=1)}}}}},y.estimateLiveEdge=function(){var c=this.levelDetails;return c===null?null:c.edge+c.age},y.computeLatency=function(){var c=this.estimateLiveEdge();return c===null?null:c-this.currentTime},p=m,(A=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var c=this.config,T=this.levelDetails;return c.liveMaxLatencyDuration!==void 0?c.liveMaxLatencyDuration:T?c.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var c=this.levelDetails;if(c===null)return null;var T=c.holdBack,E=c.partHoldBack,u=c.targetduration,t=this.config,a=t.liveSyncDuration,e=t.liveSyncDurationCount,s=t.lowLatencyMode,l=this.hls.userConfig,n=s&&E||T;(l.liveSyncDuration||l.liveSyncDurationCount||n===0)&&(n=a!==void 0?a:e*u);var o=u;return n+Math.min(1*this.stallCount,o)}},{key:"liveSyncPosition",get:function(){var c=this.estimateLiveEdge(),T=this.targetLatency,E=this.levelDetails;if(c===null||T===null||E===null)return null;var u=E.edge,t=c-T-this.edgeStalled,a=u-E.totalduration,e=u-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(a,t),e)}},{key:"drift",get:function(){var c=this.levelDetails;return c===null?1:c.drift}},{key:"edgeStalled",get:function(){var c=this.levelDetails;if(c===null)return 0;var T=3*(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.max(c.age-T,0)}},{key:"forwardBufferLength",get:function(){var c=this.media,T=this.levelDetails;if(!c||!T)return 0;var E=c.buffered.length;return E?c.buffered.end(E-1):T.edge-this.currentTime}}])&&R(p.prototype,A),m}()},"./src/controller/level-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return E});var _=h("./src/types/level.ts"),S=h("./src/events.ts"),D=h("./src/errors.ts"),R=h("./src/utils/codecs.ts"),C=h("./src/controller/level-helper.ts"),m=h("./src/controller/base-playlist-controller.ts"),p=h("./src/types/loader.ts");function A(){return(A=Object.assign||function(u){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(u[e]=a[e])}return u}).apply(this,arguments)}function y(u,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(u,e.key,e)}}function c(u,t){return(c=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(u,t)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),E=function(u){var t,a;function e(o){var v;return(v=u.call(this,o,"[level-controller]")||this)._levels=[],v._firstLevel=-1,v._startLevel=void 0,v.currentLevelIndex=-1,v.manualLevelIndex=-1,v.onParsedComplete=void 0,v._registerListeners(),v}a=u,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,c(t,a);var s,l,n=e.prototype;return n._registerListeners=function(){var o=this.hls;o.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(S.Events.ERROR,this.onError,this)},n._unregisterListeners=function(){var o=this.hls;o.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(S.Events.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},n.startLoad=function(){this._levels.forEach(function(o){o.loadError=0}),u.prototype.startLoad.call(this)},n.onManifestLoaded=function(o,v){var f,g,r=[],i=[],d=[],b={},L=!1,k=!1,I=!1;if(v.levels.forEach(function(F){var M=F.attrs;L=L||!(!F.width||!F.height),k=k||!!F.videoCodec,I=I||!!F.audioCodec,T&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var B=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;(g=b[B])?g.url.push(F.url):(g=new _.Level(F),b[B]=g,r.push(g)),M&&(M.AUDIO&&Object(C.addGroupId)(g,"audio",M.AUDIO),M.SUBTITLES&&Object(C.addGroupId)(g,"text",M.SUBTITLES))}),(L||k)&&I&&(r=r.filter(function(F){var M=F.videoCodec,B=F.width,U=F.height;return!!M||!(!B||!U)})),r=r.filter(function(F){var M=F.audioCodec,B=F.videoCodec;return(!M||Object(R.isCodecSupportedInMp4)(M,"audio"))&&(!B||Object(R.isCodecSupportedInMp4)(B,"video"))}),v.audioTracks&&(i=v.audioTracks.filter(function(F){return!F.audioCodec||Object(R.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(i)),v.subtitles&&(d=v.subtitles,Object(C.assignTrackIdsByGroup)(d)),r.length>0){f=r[0].bitrate,r.sort(function(F,M){return F.bitrate-M.bitrate}),this._levels=r;for(var O=0;O<r.length;O++)if(r[O].bitrate===f){this._firstLevel=O,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+f);break}var x=I&&!k,P={levels:r,audioTracks:i,subtitleTracks:d,firstLevel:this._firstLevel,stats:v.stats,audio:I,video:k,altAudio:!x&&i.some(function(F){return!!F.url})};this.hls.trigger(S.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(S.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:v.url,reason:"no level with compatible codecs found in manifest"})},n.onError=function(o,v){if(u.prototype.onError.call(this,o,v),!v.fatal){var f=v.context,g=this._levels[this.currentLevelIndex];if(f&&(f.type===p.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&f.groupId===g.audioGroupIds[g.urlId]||f.type===p.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&f.groupId===g.textGroupIds[g.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,i=!1,d=!0;switch(v.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(v.frag){var b=this._levels[v.frag.level];b?(b.fragmentError++,b.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=v.frag.level)):r=v.frag.level}break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:f&&(f.deliveryDirectives&&(d=!1),r=f.level),i=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:r=v.level,i=!0}r!==void 0&&this.recoverLevel(v,r,i,d)}}},n.recoverLevel=function(o,v,f,g){var r=o.details,i=this._levels[v];if(i.loadError++,f){if(!this.retryLoadingOrFail(o))return void(this.currentLevelIndex=-1);o.levelRetry=!0}if(g){var d=i.url.length;if(d>1&&i.loadError<d)o.levelRetry=!0,this.redundantFailover(v);else if(this.manualLevelIndex===-1){var b=v===0?this._levels.length-1:v-1;this.currentLevelIndex!==b&&this._levels[b].loadError===0&&(this.warn(r+": switch to "+b),o.levelRetry=!0,this.hls.nextAutoLevel=b)}}},n.redundantFailover=function(o){var v=this._levels[o],f=v.url.length;if(f>1){var g=(v.urlId+1)%f;this.warn("Switching to redundant URL-id "+g),this._levels.forEach(function(r){r.urlId=g}),this.level=o}},n.onFragLoaded=function(o,v){var f=v.frag;if(f!==void 0&&f.type===p.PlaylistLevelType.MAIN){var g=this._levels[f.level];g!==void 0&&(g.fragmentError=0,g.loadError=0)}},n.onLevelLoaded=function(o,v){var f,g,r=v.level,i=v.details,d=this._levels[r];if(!d)return this.warn("Invalid level index "+r),void((g=v.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(i.deltaUpdateFailed=!0));r===this.currentLevelIndex?(d.fragmentError===0&&(d.loadError=0,this.retryCount=0),this.playlistLoaded(r,v,d.details)):(f=v.deliveryDirectives)!==null&&f!==void 0&&f.skip&&(i.deltaUpdateFailed=!0)},n.onAudioTrackSwitched=function(o,v){var f=this.hls.levels[this.currentLevelIndex];if(f&&f.audioGroupIds){for(var g=-1,r=this.hls.audioTracks[v.id].groupId,i=0;i<f.audioGroupIds.length;i++)if(f.audioGroupIds[i]===r){g=i;break}g!==f.urlId&&(f.urlId=g,this.startLoad())}},n.loadPlaylist=function(o){var v=this.currentLevelIndex,f=this._levels[v];if(this.canLoad&&f&&f.url.length>0){var g=f.urlId,r=f.url[g];if(o)try{r=o.addDirectives(r)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Attempt loading level index "+v+(o?" at sn "+o.msn+" part "+o.part:"")+" with URL-id "+g+" "+r),this.clearTimer(),this.hls.trigger(S.Events.LEVEL_LOADING,{url:r,level:v,id:g,deliveryDirectives:o||null})}},n.removeLevel=function(o,v){var f=function(r,i){return i!==v},g=this._levels.filter(function(r,i){return i!==o||r.url.length>1&&v!==void 0&&(r.url=r.url.filter(f),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(f)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(f)),r.urlId=0,!0)}).map(function(r,i){var d=r.details;return d!=null&&d.fragments&&d.fragments.forEach(function(b){b.level=i}),r});this._levels=g,this.hls.trigger(S.Events.LEVELS_UPDATED,{levels:g})},s=e,(l=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(o){var v,f=this._levels;if(f.length!==0&&(this.currentLevelIndex!==o||(v=f[o])===null||v===void 0||!v.details)){if(o<0||o>=f.length){var g=o<0;if(this.hls.trigger(S.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:o,fatal:g,reason:"invalid level idx"}),g)return;o=Math.min(o,f.length-1)}this.clearTimer();var r=this.currentLevelIndex,i=f[r],d=f[o];this.log("switching to level "+o+" from "+r),this.currentLevelIndex=o;var b=A({},d,{level:o,maxBitrate:d.maxBitrate,uri:d.uri,urlId:d.urlId});delete b._urlId,this.hls.trigger(S.Events.LEVEL_SWITCHING,b);var L=d.details;if(!L||L.live){var k=this.switchParams(d.uri,i==null?void 0:i.details);this.loadPlaylist(k)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(o){this.manualLevelIndex=o,this._startLevel===void 0&&(this._startLevel=o),o!==-1&&(this.level=o)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(o){this._firstLevel=o}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var o=this.hls.config.startLevel;return o!==void 0?o:this._firstLevel}return this._startLevel},set:function(o){this._startLevel=o}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(o){this.level=o,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=o)}}])&&y(s.prototype,l),e}(m.default)},"./src/controller/level-helper.ts":function(N,w,h){h.r(w),h.d(w,"addGroupId",function(){return D}),h.d(w,"assignTrackIdsByGroup",function(){return R}),h.d(w,"updatePTS",function(){return C}),h.d(w,"updateFragPTSDTS",function(){return p}),h.d(w,"mergeDetails",function(){return A}),h.d(w,"mapPartIntersection",function(){return y}),h.d(w,"mapFragmentIntersection",function(){return c}),h.d(w,"adjustSliding",function(){return T}),h.d(w,"addSliding",function(){return E}),h.d(w,"computeReloadInterval",function(){return u}),h.d(w,"getFragmentWithSN",function(){return t}),h.d(w,"getPartWith",function(){return a});var _=h("./src/polyfills/number.ts"),S=h("./src/utils/logger.ts");function D(e,s,l){switch(s){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(l);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(l)}}function R(e){var s={};e.forEach(function(l){var n=l.groupId||"";l.id=s[n]=s[n]||0,s[n]++})}function C(e,s,l){m(e[s],e[l])}function m(e,s){var l=s.startPTS;if(Object(_.isFiniteNumber)(l)){var n,o=0;s.sn>e.sn?(o=l-e.start,n=e):(o=e.start-l,n=s),n.duration!==o&&(n.duration=o)}else s.sn>e.sn?e.cc===s.cc&&e.minEndPTS?s.start=e.start+(e.minEndPTS-e.start):s.start=e.start+e.duration:s.start=Math.max(e.start-s.duration,0)}function p(e,s,l,n,o,v){n-l<=0&&(S.logger.warn("Fragment should have a positive duration",s),n=l+s.duration,v=o+s.duration);var f=l,g=n,r=s.startPTS,i=s.endPTS;if(Object(_.isFiniteNumber)(r)){var d=Math.abs(r-l);Object(_.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(d,s.deltaPTS):s.deltaPTS=d,f=Math.max(l,r),l=Math.min(l,r),o=Math.min(o,s.startDTS),g=Math.min(n,i),n=Math.max(n,i),v=Math.max(v,s.endDTS)}s.duration=n-l;var b=l-s.start;s.appendedPTS=n,s.start=s.startPTS=l,s.maxStartPTS=f,s.startDTS=o,s.endPTS=n,s.minEndPTS=g,s.endDTS=v;var L,k=s.sn;if(!e||k<e.startSN||k>e.endSN)return 0;var I=k-e.startSN,O=e.fragments;for(O[I]=s,L=I;L>0;L--)m(O[L],O[L-1]);for(L=I;L<O.length-1;L++)m(O[L],O[L+1]);return e.fragmentHint&&m(O[O.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,b}function A(e,s){for(var l=null,n=e.fragments,o=n.length-1;o>=0;o--){var v=n[o].initSegment;if(v){l=v;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var f,g=0;if(c(e,s,function(k,I){var O;k.relurl&&(g=k.cc-I.cc),Object(_.isFiniteNumber)(k.startPTS)&&Object(_.isFiniteNumber)(k.endPTS)&&(I.start=I.startPTS=k.startPTS,I.startDTS=k.startDTS,I.appendedPTS=k.appendedPTS,I.maxStartPTS=k.maxStartPTS,I.endPTS=k.endPTS,I.endDTS=k.endDTS,I.minEndPTS=k.minEndPTS,I.duration=k.endPTS-k.startPTS,I.duration&&(f=I),s.PTSKnown=s.alignedSliding=!0),I.elementaryStreams=k.elementaryStreams,I.loader=k.loader,I.stats=k.stats,I.urlId=k.urlId,k.initSegment?(I.initSegment=k.initSegment,l=k.initSegment):I.initSegment&&I.initSegment.relurl!=((O=l)===null||O===void 0?void 0:O.relurl)||(I.initSegment=l)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(k){return!k}),s.deltaUpdateFailed)){S.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=s.skippedSegments;r--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var i=s.fragments;if(g){S.logger.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<i.length;d++)i[d].cc+=g}s.skippedSegments&&(s.startCC=s.fragments[0].cc),y(e.partList,s.partList,function(k,I){I.elementaryStreams=k.elementaryStreams,I.stats=k.stats}),f?p(s,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):T(e,s),i.length&&(s.totalduration=s.edge-i[0].start),s.driftStartTime=e.driftStartTime,s.driftStart=e.driftStart;var b=s.advancedDateTime;if(s.advanced&&b){var L=s.edge;s.driftStart||(s.driftStartTime=b,s.driftStart=L),s.driftEndTime=b,s.driftEnd=L}else s.driftEndTime=e.driftEndTime,s.driftEnd=e.driftEnd,s.advancedDateTime=e.advancedDateTime}function y(e,s,l){if(e&&s)for(var n=0,o=0,v=e.length;o<=v;o++){var f=e[o],g=s[o+n];f&&g&&f.index===g.index&&f.fragment.sn===g.fragment.sn?l(f,g):n--}}function c(e,s,l){for(var n=s.skippedSegments,o=Math.max(e.startSN,s.startSN)-s.startSN,v=(e.fragmentHint?1:0)+(n?s.endSN:Math.min(e.endSN,s.endSN))-s.startSN,f=s.startSN-e.startSN,g=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,i=o;i<=v;i++){var d=r[f+i],b=g[i];n&&!b&&i<n&&(b=s.fragments[i]=d),d&&b&&l(d,b)}}function T(e,s){var l=s.startSN+s.skippedSegments-e.startSN,n=e.fragments;l<0||l>=n.length||E(s,n[l].start)}function E(e,s){if(s){for(var l=e.fragments,n=e.skippedSegments;n<l.length;n++)l[n].start+=s;e.fragmentHint&&(e.fragmentHint.start+=s)}}function u(e,s){var l,n=1e3*e.levelTargetDuration,o=n/2,v=e.age,f=v>0&&v<3*n,g=s.loading.end-s.loading.start,r=e.availabilityDelay;if(e.updated===!1)if(f){var i=333*e.misses;l=Math.max(Math.min(o,2*g),i),e.availabilityDelay=(e.availabilityDelay||0)+l}else l=o;else f?(r=Math.min(r||n/2,v),e.availabilityDelay=r,l=r+n-v):l=n-g;return Math.round(l)}function t(e,s,l){if(!e||!e.details)return null;var n=e.details,o=n.fragments[s-n.startSN];return o||((o=n.fragmentHint)&&o.sn===s?o:s<n.startSN&&l&&l.sn===s?l:null)}function a(e,s,l){if(!e||!e.details)return null;var n=e.details.partList;if(n)for(var o=n.length;o--;){var v=n[o];if(v.index===l&&v.fragment.sn===s)return v}return null}},"./src/controller/stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return e});var _=h("./src/polyfills/number.ts"),S=h("./src/controller/base-stream-controller.ts"),D=h("./src/is-supported.ts"),R=h("./src/events.ts"),C=h("./src/utils/buffer-helper.ts"),m=h("./src/controller/fragment-tracker.ts"),p=h("./src/types/loader.ts"),A=h("./src/loader/fragment.ts"),y=h("./src/demux/transmuxer-interface.ts"),c=h("./src/types/transmuxer.ts"),T=h("./src/controller/gap-controller.ts"),E=h("./src/errors.ts"),u=h("./src/utils/logger.ts");function t(s,l){for(var n=0;n<l.length;n++){var o=l[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,o.key,o)}}function a(s,l){return(a=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(s,l)}var e=function(s){var l,n;function o(r,i){var d;return(d=s.call(this,r,i,"[stream-controller]")||this).audioCodecSwap=!1,d.gapController=null,d.level=-1,d._forceStartLoad=!1,d.altAudio=!1,d.audioOnly=!1,d.fragPlaying=null,d.onvplaying=null,d.onvseeked=null,d.fragLastKbps=0,d.stalled=!1,d.couldBacktrack=!1,d.audioCodecSwitch=!1,d.videoBuffer=null,d._registerListeners(),d}n=s,(l=o).prototype=Object.create(n.prototype),l.prototype.constructor=l,a(l,n);var v,f,g=o.prototype;return g._registerListeners=function(){var r=this.hls;r.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(R.Events.ERROR,this.onError,this),r.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(R.Events.ERROR,this.onError,this),r.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},g.startLoad=function(r){if(this.levels){var i=this.lastCurrentTime,d=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=d.startLevel;b===-1&&(d.config.testBandwidth?(b=0,this.bitrateTest=!0):b=d.nextAutoLevel),this.level=d.nextLoadLevel=b,this.loadedmetadata=!1}i>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),r=i),this.state=S.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=S.State.STOPPED},g.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},g.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_LEVEL:var r,i=this.levels,d=this.level,b=i==null||(r=i[d])===null||r===void 0?void 0:r.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=S.State.IDLE;break}break;case S.State.FRAG_LOADING_WAITING_RETRY:var L,k=self.performance.now(),I=this.retryDate;(!I||k>=I||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=S.State.IDLE)}this.onTickEnd()},g.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},g.doTickIdle=function(){var r,i,d=this.hls,b=this.levelLastLoaded,L=this.levels,k=this.media,I=d.config,O=d.nextLoadLevel;if(b!==null&&(k||!this.startFragRequested&&I.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&L&&L[O]){var x=L[O];this.level=d.nextLoadLevel=O;var P=x.details;if(!P||this.state===S.State.WAITING_LEVEL||P.live&&this.levelLastLoaded!==O)this.state=S.State.WAITING_LEVEL;else{var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:k,p.PlaylistLevelType.MAIN);if(F!==null&&!(F.len>=this.getMaxBufferLength(x.maxBitrate))){if(this._streamEnded(F,P)){var M={};return this.altAudio&&(M.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,M),void(this.state=S.State.ENDED)}var B=F.end,U=this.getNextFragment(B,P);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var G=U.sn-P.startSN;G>1&&(U=P.fragments[G-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===m.FragmentState.OK&&this.nextLoadPosition>B){var K=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(k,K,p.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,P)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=U.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(U,P,B):this.loadKey(U,P))}}}},g.loadFragment=function(r,i,d){var b,L=this.fragmentTracker.getState(r);if(this.fragCurrent=r,L===m.FragmentState.BACKTRACKED){var k=this.fragmentTracker.getBacktrackData(r);if(k)return this._handleFragmentLoadProgress(k),void this._handleFragmentLoadComplete(k);L=m.FragmentState.NOT_LOADED}L===m.FragmentState.NOT_LOADED||L===m.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,r,i,d)):L===m.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},g.getAppendedFrag=function(r){var i=this.fragmentTracker.getAppendedFrag(r,p.PlaylistLevelType.MAIN);return i&&"fragment"in i?i.fragment:i},g.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,p.PlaylistLevelType.MAIN)},g.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},g.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},g.nextLevelSwitch=function(){var r=this.levels,i=this.media;if(i!=null&&i.readyState){var d,b=this.getAppendedFrag(i.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!i.paused&&r){var L=r[this.hls.nextLoadLevel],k=this.fragLastKbps;d=k&&this.fragCurrent?this.fragCurrent.duration*L.maxBitrate/(1e3*k)+1:0}else d=0;var I=this.getBufferedFrag(i.currentTime+d);if(I){var O=this.followingBufferedFrag(I);if(O){this.abortCurrentFrag();var x=O.maxStartPTS?O.maxStartPTS:O.start,P=O.duration,F=Math.max(I.end,x+Math.min(Math.max(P-this.config.maxFragLookUpTolerance,.5*P),.75*P));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},g.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===S.State.KEY_LOADING&&(this.state=S.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},g.flushMainBuffer=function(r,i){s.prototype.flushMainBuffer.call(this,r,i,this.altAudio?"video":null)},g.onMediaAttached=function(r,i){s.prototype.onMediaAttached.call(this,r,i);var d=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,d,this.fragmentTracker,this.hls)},g.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},g.onMediaPlaying=function(){this.tick()},g.onMediaSeeked=function(){var r=this.media,i=r?r.currentTime:null;Object(_.isFiniteNumber)(i)&&this.log("Media seeked to "+i.toFixed(3)),this.tick()},g.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},g.onManifestParsed=function(r,i){var d,b=!1,L=!1;i.levels.forEach(function(k){(d=k.audioCodec)&&(d.indexOf("mp4a.40.2")!==-1&&(b=!0),d.indexOf("mp4a.40.5")!==-1&&(L=!0))}),this.audioCodecSwitch=b&&L&&!Object(D.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},g.onLevelLoading=function(r,i){var d=this.levels;if(d&&this.state===S.State.IDLE){var b=d[i.level];(!b.details||b.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(b.details))&&(this.state=S.State.WAITING_LEVEL)}},g.onLevelLoaded=function(r,i){var d,b=this.levels,L=i.level,k=i.details,I=k.totalduration;if(b){this.log("Level "+L+" loaded ["+k.startSN+","+k.endSN+"], cc ["+k.startCC+", "+k.endCC+"] duration:"+I);var O=this.fragCurrent;!O||this.state!==S.State.FRAG_LOADING&&this.state!==S.State.FRAG_LOADING_WAITING_RETRY||O.level!==i.level&&O.loader&&(this.state=S.State.IDLE,O.loader.abort());var x=b[L],P=0;if(k.live||(d=x.details)!==null&&d!==void 0&&d.live){if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed)return;P=this.alignPlaylists(k,x.details)}if(x.details=k,this.levelLastLoaded=L,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:k,level:L}),this.state===S.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(k))return;this.state=S.State.IDLE}this.startFragRequested?k.live&&this.synchronizeToLiveEdge(k):this.setStartPosition(k,P),this.tick()}else this.warn("Levels were reset while loading level "+L)},g._handleFragmentLoadProgress=function(r){var i,d=r.frag,b=r.part,L=r.payload,k=this.levels;if(k){var I=k[d.level],O=I.details;if(O){var x=I.videoCodec,P=O.PTSKnown||!O.live,F=(i=d.initSegment)===null||i===void 0?void 0:i.data,M=this._getAudioCodec(I),B=this.transmuxer=this.transmuxer||new y.default(this.hls,p.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=b?b.index:-1,G=U!==-1,K=new c.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,L.byteLength,U,G),H=this.initPTS[d.cc];B.push(L,F,M,x,d,b,O.totalduration,P,K,H)}else this.warn("Dropping fragment "+d.sn+" of level "+d.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered")},g.onAudioTrackSwitching=function(r,i){var d=this.altAudio,b=!!i.url,L=i.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var k=this.fragCurrent;k!=null&&k.loader&&(this.log("Switching to main audio track, cancel main fragment load"),k.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;d&&I.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:L})}},g.onAudioTrackSwitched=function(r,i){var d=i.id,b=!!this.hls.audioTracks[d].url;if(b){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=b,this.tick()},g.onBufferCreated=function(r,i){var d,b,L=i.tracks,k=!1;for(var I in L){var O=L[I];if(O.id==="main"){if(b=I,d=O,I==="video"){var x=L[I];x&&(this.videoBuffer=x.buffer)}}else k=!0}k&&d?(this.log("Alternate track found, use "+b+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},g.onFragBuffered=function(r,i){var d=i.frag,b=i.part;if(!d||d.type===p.PlaylistLevelType.MAIN){if(this.fragContextChanged(d))return this.warn("Fragment "+d.sn+(b?" p: "+b.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===S.State.PARSED&&(this.state=S.State.IDLE));var L=b?b.stats:d.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),d.sn!=="initSegment"&&(this.fragPrevious=d),this.fragBufferedComplete(d,b)}},g.onError=function(r,i){switch(i.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(p.PlaylistLevelType.MAIN,i);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==S.State.ERROR&&(i.fatal?(this.warn(""+i.details),this.state=S.State.ERROR):i.levelRetry||this.state!==S.State.WAITING_LEVEL||(this.state=S.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="main"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var d=!0,b=this.getFwdBufferInfo(this.media,p.PlaylistLevelType.MAIN);b&&b.len>.5&&(d=!this.reduceMaxBufferLength(b.len)),d&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},g.checkBuffer=function(){var r=this.media,i=this.gapController;if(r&&i&&r.readyState){var d=C.BufferHelper.getBuffered(r);!this.loadedmetadata&&d.length?(this.loadedmetadata=!0,this.seekToStartPos()):i.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},g.onFragLoadEmergencyAborted=function(){this.state=S.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},g.onBufferFlushed=function(r,i){var d=i.type;if(d!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(d===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,d,p.PlaylistLevelType.MAIN)}},g.onLevelsUpdated=function(r,i){this.levels=i.levels},g.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},g.seekToStartPos=function(){var r=this.media,i=r.currentTime,d=this.startPosition;if(d>=0&&i<d){if(r.seeking)return void u.logger.log("could not seek to "+d+", already seeking at "+i);var b=C.BufferHelper.getBuffered(r),L=(b.length?b.start(0):0)-d;L>0&&L<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+L+" to match buffer start"),d+=L,this.startPosition=d),this.log("seek to target start position "+d+" from current time "+i),r.currentTime=d}},g._getAudioCodec=function(r){var i=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i=i.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),i},g._loadBitrateTestFrag=function(r){var i=this;this._doFragLoad(r).then(function(d){var b=i.hls;if(d&&!b.nextLoadLevel&&!i.fragContextChanged(r)){i.fragLoadError=0,i.state=S.State.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var L=r.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),b.trigger(R.Events.FRAG_LOADED,d)}})},g._handleTransmuxComplete=function(r){var i,d="main",b=this.hls,L=r.remuxResult,k=r.chunkMeta,I=this.getCurrentContext(k);if(!I)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var O=I.frag,x=I.part,P=I.level,F=L.video,M=L.text,B=L.id3,U=L.initSegment,G=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(O)){if(this.state=S.State.PARSING,U){U.tracks&&(this._bufferInitSegment(P,U.tracks,O,k),b.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:d,tracks:U.tracks}));var K=U.initPTS,H=U.timescale;Object(_.isFiniteNumber)(K)&&(this.initPTS[O.cc]=K,b.trigger(R.Events.INIT_PTS_FOUND,{frag:O,id:d,initPTS:K,timescale:H}))}if(F&&L.independent!==!1){if(P.details){var Y=F.startPTS,W=F.endPTS,q=F.startDTS,Q=F.endDTS;if(x)x.elementaryStreams[F.type]={startPTS:Y,endPTS:W,startDTS:q,endDTS:Q};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){if(this.getLoadPosition()+this.config.maxBufferHole<Y)return void this.backtrack(O);O.setElementaryStreamInfo(F.type,O.start,W,O.start,Q,!0)}O.setElementaryStreamInfo(F.type,Y,W,q,Q),this.bufferFragmentData(F,O,x,k)}}else if(L.independent===!1)return void this.backtrack(O);if(G){var tt=G.startPTS,rt=G.endPTS,z=G.startDTS,at=G.endDTS;x&&(x.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:tt,endPTS:rt,startDTS:z,endDTS:at}),O.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,tt,rt,z,at),this.bufferFragmentData(G,O,x,k)}if(B!=null&&(i=B.samples)!==null&&i!==void 0&&i.length){var X={frag:O,id:d,samples:B.samples};b.trigger(R.Events.FRAG_PARSING_METADATA,X)}if(M){var J={frag:O,id:d,samples:M.samples};b.trigger(R.Events.FRAG_PARSING_USERDATA,J)}}},g._bufferInitSegment=function(r,i,d,b){var L=this;if(this.state===S.State.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var k=i.audio,I=i.video,O=i.audiovideo;if(k){var x=r.audioCodec,P=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(x&&(x=x.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),k.metadata.channelCount!==1&&P.indexOf("firefox")===-1&&(x="mp4a.40.5")),P.indexOf("android")!==-1&&k.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),r.audioCodec&&r.audioCodec!==x&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+x+'"'),k.levelCodec=x,k.id="main",this.log("Init audio buffer, container:"+k.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(r.audioCodec||"")+"/"+k.codec+"]")}I&&(I.levelCodec=r.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+I.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,i),Object.keys(i).forEach(function(F){var M=i[F].initSegment;M!=null&&M.byteLength&&L.hls.trigger(R.Events.BUFFER_APPENDING,{type:F,data:M,frag:d,part:null,chunkMeta:b,parent:d.type})}),this.tick()}},g.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var i=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,i?this.resetFragmentLoading(r):this.state=S.State.BACKTRACKING},g.checkFragmentChanged=function(){var r=this.media,i=null;if(r&&r.readyState>1&&r.seeking===!1){var d=r.currentTime;if(C.BufferHelper.isBuffered(r,d)?i=this.getAppendedFrag(d):C.BufferHelper.isBuffered(r,d+.1)&&(i=this.getAppendedFrag(d+.1)),i){var b=this.fragPlaying,L=i.level;b&&i.sn===b.sn&&b.level===L&&i.urlId===b.urlId||(this.hls.trigger(R.Events.FRAG_CHANGED,{frag:i}),b&&b.level===L||this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:L}),this.fragPlaying=i)}}},v=o,(f=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);if(i)return i.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(i)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&t(v.prototype,f),o}(S.default)},"./src/controller/subtitle-stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"SubtitleStreamController",function(){return u});var _=h("./src/events.ts"),S=h("./src/utils/logger.ts"),D=h("./src/utils/buffer-helper.ts"),R=h("./src/controller/fragment-finders.ts"),C=h("./src/utils/discontinuities.ts"),m=h("./src/controller/level-helper.ts"),p=h("./src/controller/fragment-tracker.ts"),A=h("./src/controller/base-stream-controller.ts"),y=h("./src/types/loader.ts"),c=h("./src/types/level.ts");function T(t,a){for(var e=0;e<a.length;e++){var s=a[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function E(t,a){return(E=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e})(t,a)}var u=function(t){var a,e;function s(v,f){var g;return(g=t.call(this,v,f,"[subtitle-stream-controller]")||this).levels=[],g.currentTrackId=-1,g.tracksBuffered=[],g.mainDetails=null,g._registerListeners(),g}e=t,(a=s).prototype=Object.create(e.prototype),a.prototype.constructor=a,E(a,e);var l,n,o=s.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var v=this.hls;v.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(_.Events.ERROR,this.onError,this),v.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},o._unregisterListeners=function(){var v=this.hls;v.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(_.Events.ERROR,this.onError,this),v.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},o.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(500),this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(v,f){this.mainDetails=f.details},o.onSubtitleFragProcessed=function(v,f){var g=f.frag,r=f.success;if(this.fragPrevious=g,this.state=A.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var d,b=g.start,L=0;L<i.length;L++)if(b>=i[L].start&&b<=i[L].end){d=i[L];break}var k=g.start+g.duration;d?d.end=k:(d={start:b,end:k},i.push(d)),this.fragmentTracker.fragBuffered(g)}}},o.onBufferFlushing=function(v,f){var g=f.startOffset,r=f.endOffset;if(g===0&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,d=this.levels;if(!d.length||!d[i]||!d[i].details)return;var b=r-d[i].details.targetduration;if(b<=0)return;f.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(L){for(var k=0;k<L.length;)if(L[k].end<=b)L.shift();else{if(!(L[k].start<b))break;L[k].start=b,k++}}),this.fragmentTracker.removeFragmentsInRange(g,b,y.PlaylistLevelType.SUBTITLE)}},o.onError=function(v,f){var g,r=f.frag;r&&r.type===y.PlaylistLevelType.SUBTITLE&&((g=this.fragCurrent)!==null&&g!==void 0&&g.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},o.onSubtitleTracksUpdated=function(v,f){var g=this,r=f.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(i){return new c.Level(i)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(i){g.tracksBuffered[i.id]=[]}),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(v,f){if(this.currentTrackId=f.id,this.levels.length&&this.currentTrackId!==-1){var g=this.levels[this.currentTrackId];g!=null&&g.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},o.onSubtitleTrackLoaded=function(v,f){var g,r=f.details,i=f.id,d=this.currentTrackId,b=this.levels;if(b.length){var L=b[d];if(!(i>=b.length||i!==d)&&L){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(g=L.details)!==null&&g!==void 0&&g.live){var k=this.mainDetails;if(r.deltaUpdateFailed||!k)return;var I=k.fragments[0];L.details?this.alignPlaylists(r,L.details)===0&&I&&Object(m.addSliding)(r,I.start):r.hasProgramDateTime&&k.hasProgramDateTime?Object(C.alignPDT)(r,k):I&&Object(m.addSliding)(r,I.start)}L.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE&&(Object(R.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0))}}},o._handleFragmentLoadComplete=function(v){var f=v.frag,g=v.payload,r=f.decryptdata,i=this.hls;if(!this.fragContextChanged(f)&&g&&g.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var d=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(g),r.key.buffer,r.iv.buffer).then(function(b){var L=performance.now();i.trigger(_.Events.FRAG_DECRYPTED,{frag:f,payload:b,stats:{tstart:d,tdecrypt:L}})})}},o.doTick=function(){if(this.media){if(this.state===A.State.IDLE){var v,f=this.currentTrackId,g=this.levels;if(!g.length||!g[f]||!g[f].details)return;var r=g[f].details,i=r.targetduration,d=this.config,b=this.media,L=D.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,b.currentTime-i,d.maxBufferHole),k=L.end;if(L.len>this.getMaxBufferLength()+i)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var I,O=r.fragments,x=O.length,P=r.edge,F=this.fragPrevious;if(k<P){var M=d.maxFragLookUpTolerance;F&&r.hasProgramDateTime&&(I=Object(R.findFragmentByPDT)(O,F.endProgramDateTime,M)),I||!(I=Object(R.findFragmentByPTS)(F,O,k,M))&&F&&F.start<O[0].start&&(I=O[0])}else I=O[x-1];(v=I)!==null&&v!==void 0&&v.encrypted?(S.logger.log("Loading key for "+I.sn),this.state=A.State.KEY_LOADING,this.hls.trigger(_.Events.KEY_LOADING,{frag:I})):I&&this.fragmentTracker.getState(I)===p.FragmentState.NOT_LOADED&&this.loadFragment(I,r,k)}}else this.state=A.State.IDLE},o.loadFragment=function(v,f,g){this.fragCurrent=v,t.prototype.loadFragment.call(this,v,f,g)},l=s,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&T(l.prototype,n),s}(A.default)},"./src/controller/subtitle-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),S=h("./src/utils/texttrack-utils.ts"),D=h("./src/controller/base-playlist-controller.ts"),R=h("./src/types/loader.ts");function C(y,c){for(var T=0;T<c.length;T++){var E=c[T];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(y,E.key,E)}}function m(y,c){return(m=Object.setPrototypeOf||function(T,E){return T.__proto__=E,T})(y,c)}var p=function(y){var c,T;function E(e){var s;return(s=y.call(this,e,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s.subtitleDisplay=!0,s.registerListeners(),s}T=y,(c=E).prototype=Object.create(T.prototype),c.prototype.constructor=c,m(c,T);var u,t,a=E.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},a.registerListeners=function(){var e=this.hls;e.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.Events.ERROR,this.onError,this)},a.onMediaAttached=function(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),A(this.media.textTracks).forEach(function(e){Object(S.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(e,s){this.tracks=s.subtitleTracks},a.onSubtitleTrackLoaded=function(e,s){var l=s.id,n=s.details,o=this.trackId,v=this.tracksInGroup[o];if(v){var f=v.details;v.details=s.details,this.log("subtitle track "+l+" loaded ["+n.startSN+"-"+n.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,f))}else this.warn("Invalid subtitle track id "+l)},a.onLevelLoading=function(e,s){this.switchLevel(s.level)},a.onLevelSwitching=function(e,s){this.switchLevel(s.level)},a.switchLevel=function(e){var s=this.hls.levels[e];if(s!=null&&s.textGroupIds){var l=s.textGroupIds[s.urlId];if(this.groupId!==l){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,o=this.tracks.filter(function(g){return!l||g.groupId===l});this.tracksInGroup=o;var v=this.findTrackId(n==null?void 0:n.name)||this.findTrackId();this.groupId=l;var f={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,f),v!==-1&&this.setSubtitleTrack(v,n)}}},a.findTrackId=function(e){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var n=s[l];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},a.onError=function(e,s){y.prototype.onError.call(this,e,s),!s.fatal&&s.context&&s.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.loadPlaylist=function(e){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,n=s.groupId,o=s.url;if(e)try{o=e.addDirectives(o)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{url:o,id:l,groupId:n,deliveryDirectives:e||null})}},a.toggleTrackModes=function(e){var s=this,l=this.media,n=this.subtitleDisplay,o=this.trackId;if(l){var v=A(l.textTracks),f=v.filter(function(i){return i.groupId===s.groupId});if(e===-1)[].slice.call(v).forEach(function(i){i.mode="disabled"});else{var g=f[o];g&&(g.mode="disabled")}var r=f[e];r&&(r.mode=n?"showing":"hidden")}},a.setSubtitleTrack=function(e,s){var l,n=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(l=n[e])!==null&&l!==void 0&&l.details)||e<-1||e>=n.length)){this.clearTimer();var o=n[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,o){var v=o.id,f=o.groupId,g=f===void 0?"":f,r=o.name,i=o.type,d=o.url;this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:g,name:r,type:i,url:d});var b=this.switchParams(o.url,s==null?void 0:s.details);this.loadPlaylist(b)}else this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,s=A(this.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")e=l;else if(s[l].mode==="showing"){e=l;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},u=E,(t=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,s)}}])&&C(u.prototype,t),E}(D.default);function A(y){for(var c=[],T=0;T<y.length;T++){var E=y[T];E.kind==="subtitles"&&E.label&&c.push(y[T])}return c}w.default=p},"./src/controller/timeline-controller.ts":function(N,w,h){h.r(w),h.d(w,"TimelineController",function(){return c});var _=h("./src/polyfills/number.ts"),S=h("./src/events.ts"),D=h("./src/utils/cea-608-parser.ts"),R=h("./src/utils/output-filter.ts"),C=h("./src/utils/webvtt-parser.ts"),m=h("./src/utils/texttrack-utils.ts"),p=h("./src/utils/imsc1-ttml-parser.ts"),A=h("./src/types/loader.ts"),y=h("./src/utils/logger.ts"),c=function(){function E(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var a=new R.default(this,"textTrack1"),e=new R.default(this,"textTrack2"),s=new R.default(this,"textTrack3"),l=new R.default(this,"textTrack4");this.cea608Parser1=new D.default(1,a,e),this.cea608Parser2=new D.default(3,s,l)}t.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(S.Events.FRAG_LOADING,this.onFragLoading,this),t.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=E.prototype;return u.destroy=function(){var t=this.hls;t.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(S.Events.FRAG_LOADING,this.onFragLoading,this),t.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(t,a,e,s,l){for(var n,o,v,f,g=!1,r=l.length;r--;){var i=l[r],d=(n=i[0],o=i[1],v=a,f=e,Math.min(o,f)-Math.max(n,v));if(d>=0&&(i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],e),g=!0,d/(e-a)>.5))return}if(g||l.push([a,e]),this.config.renderTextTracksNatively){var b=this.captionsTracks[t];this.Cues.newCue(b,a,e,s)}else{var L=this.Cues.newCue(null,a,e,s);this.hls.trigger(S.Events.CUES_PARSED,{type:"captions",cues:L,track:t})}},u.onInitPtsFound=function(t,a){var e=this,s=a.frag,l=a.id,n=a.initPTS,o=a.timescale,v=this.unparsedVttFrags;l==="main"&&(this.initPTS[s.cc]=n,this.timescale[s.cc]=o),v.length&&(this.unparsedVttFrags=[],v.forEach(function(f){e.onFragLoaded(S.Events.FRAG_LOADED,f)}))},u.getExistingTrack=function(t){var a=this.media;if(a)for(var e=0;e<a.textTracks.length;e++){var s=a.textTracks[e];if(s[t])return s}return null},u.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},u.createNativeTrack=function(t){if(!this.captionsTracks[t]){var a=this.captionsProperties,e=this.captionsTracks,s=this.media,l=a[t],n=l.label,o=l.languageCode,v=this.getExistingTrack(t);if(v)e[t]=v,Object(m.clearCurrentCues)(e[t]),Object(m.sendAddTrackEvent)(e[t],s);else{var f=this.createTextTrack("captions",n,o);f&&(f[t]=!0,e[t]=f)}}},u.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var a=this.captionsProperties[t];if(a){var e={_id:t,label:a.label,kind:"captions",default:!!a.media&&!!a.media.default,closedCaptions:a.media};this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]})}}},u.createTextTrack=function(t,a,e){var s=this.media;if(s)return s.addTextTrack(t,a,e)},u.onMediaAttaching=function(t,a){this.media=a.media,this._cleanTracks()},u.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(a){Object(m.clearCurrentCues)(t[a]),delete t[a]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var t=this.media;if(t){var a=t.textTracks;if(a)for(var e=0;e<a.length;e++)Object(m.clearCurrentCues)(a[e])}},u.onSubtitleTracksUpdated=function(t,a){var e=this;this.textTracks=[];var s=a.subtitleTracks||[],l=s.some(function(f){return f.textCodec===p.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var n=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=s||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,g){var r;if(g<o.length){for(var i=null,d=0;d<o.length;d++)if(T(o[d],f)){i=o[d];break}i&&(r=i)}r?Object(m.clearCurrentCues)(r):(r=e.createTextTrack("subtitles",f.name,f.lang))&&(r.mode="disabled"),r&&(r.groupId=f.groupId,e.textTracks.push(r))})}else if(!n&&this.tracks&&this.tracks.length){var v=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:v})}}},u.onManifestLoaded=function(t,a){var e=this;this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(s){var l=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(l){var n="textTrack"+l[1],o=e.captionsProperties[n];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)}})},u.onFragLoading=function(t,a){var e=this.cea608Parser1,s=this.cea608Parser2,l=this.lastSn;if(this.enabled&&e&&s&&a.frag.type===A.PlaylistLevelType.MAIN){var n=a.frag.sn;n!==l+1&&(e.reset(),s.reset()),this.lastSn=n}},u.onFragLoaded=function(t,a){var e=a.frag,s=a.payload,l=this.initPTS,n=this.unparsedVttFrags;if(e.type===A.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(_.isFiniteNumber)(l[e.cc]))return n.push(a),void(l.length&&this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")}));var o=e.decryptdata;if(o==null||o.key==null||o.method!=="AES-128"){var v=this.tracks[e.level],f=this.vttCCs;f[e.cc]||(f[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),v&&v.textCodec===p.IMSC1_CODEC?this._parseIMSC1(e,s):this._parseVTTs(e,s,f)}}else this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(t,a){var e=this,s=this.hls;Object(p.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(l){e._appendCues(l,t.level),s.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(l){y.logger.log("Failed to parse IMSC1: "+l),s.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:l})})},u._parseVTTs=function(t,a,e){var s=this,l=this.hls;Object(C.parseWebVTT)(a,this.initPTS[t.cc],this.timescale[t.cc],e,t.cc,t.start,function(n){s._appendCues(n,t.level),l.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(n){s._fallbackToIMSC1(t,a),y.logger.log("Failed to parse VTT cue: "+n),l.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})})},u._fallbackToIMSC1=function(t,a){var e=this,s=this.tracks[t.level];s.textCodec||Object(p.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(){s.textCodec=p.IMSC1_CODEC,e._parseIMSC1(t,a)},function(){s.textCodec="wvtt"})},u._appendCues=function(t,a){var e=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[a];if(s.mode==="disabled")return;t.forEach(function(n){return Object(m.addCueToTrack)(s,n)})}else{var l=this.tracks[a].default?"default":"subtitles"+a;e.trigger(S.Events.CUES_PARSED,{type:"subtitles",cues:t,track:l})}},u.onFragDecrypted=function(t,a){var e=a.frag;if(e.type===A.PlaylistLevelType.SUBTITLE){if(!Object(_.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(a);this.onFragLoaded(S.Events.FRAG_LOADED,a)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(t,a){var e=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&e&&s)for(var l=0;l<a.samples.length;l++){var n=a.samples[l].bytes;if(n){var o=this.extractCea608Data(n);e.addData(a.samples[l].pts,o[0]),s.addData(a.samples[l].pts,o[1])}}},u.onBufferFlushing=function(t,a){var e=a.startOffset,s=a.endOffset,l=a.endOffsetSubtitles,n=a.type,o=this.media;if(o&&!(o.currentTime<s)){if(!n||n==="video"){var v=this.captionsTracks;Object.keys(v).forEach(function(g){return Object(m.removeCuesInRange)(v[g],e,s)})}if(this.config.renderTextTracksNatively&&e===0&&l!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(g){return Object(m.removeCuesInRange)(f[g],e,l)})}}},u.extractCea608Data=function(t){for(var a=31&t[0],e=2,s=[[],[]],l=0;l<a;l++){var n=t[e++],o=127&t[e++],v=127&t[e++],f=3&n;o===0&&v===0||(4&n)!=0&&(f!==0&&f!==1||(s[f].push(o),s[f].push(v)))}return s},E}();function T(E,u){return E&&E.label===u.name&&!(E.textTrack1||E.textTrack2)}},"./src/crypt/aes-crypto.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function S(D,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=D,this.aesIV=R}return S.prototype.decrypt=function(D,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,D)},S}()},"./src/crypt/aes-decryptor.ts":function(N,w,h){h.r(w),h.d(w,"removePadding",function(){return S}),h.d(w,"default",function(){return D});var _=h("./src/utils/typed-array.ts");function S(R){var C=R.byteLength,m=C&&new DataView(R.buffer).getUint8(C-1);return m?Object(_.sliceUint8)(R,0,C-m):R}var D=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=R.prototype;return C.uint8ArrayToUint32Array_=function(m){for(var p=new DataView(m),A=new Uint32Array(4),y=0;y<4;y++)A[y]=p.getUint32(4*y);return A},C.initTable=function(){var m=this.sBox,p=this.invSBox,A=this.subMix,y=A[0],c=A[1],T=A[2],E=A[3],u=this.invSubMix,t=u[0],a=u[1],e=u[2],s=u[3],l=new Uint32Array(256),n=0,o=0,v=0;for(v=0;v<256;v++)l[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var f=o^o<<1^o<<2^o<<3^o<<4;f=f>>>8^255&f^99,m[n]=f,p[f]=n;var g=l[n],r=l[g],i=l[r],d=257*l[f]^16843008*f;y[n]=d<<24|d>>>8,c[n]=d<<16|d>>>16,T[n]=d<<8|d>>>24,E[n]=d,d=16843009*i^65537*r^257*g^16843008*n,t[f]=d<<24|d>>>8,a[f]=d<<16|d>>>16,e[f]=d<<8|d>>>24,s[f]=d,n?(n=g^l[l[l[i^g]]],o^=l[l[o]]):n=o=1}},C.expandKey=function(m){for(var p=this.uint8ArrayToUint32Array_(m),A=!0,y=0;y<p.length&&A;)A=p[y]===this.key[y],y++;if(!A){this.key=p;var c=this.keySize=p.length;if(c!==4&&c!==6&&c!==8)throw new Error("Invalid aes key size="+c);var T,E,u,t,a=this.ksRows=4*(c+6+1),e=this.keySchedule=new Uint32Array(a),s=this.invKeySchedule=new Uint32Array(a),l=this.sBox,n=this.rcon,o=this.invSubMix,v=o[0],f=o[1],g=o[2],r=o[3];for(T=0;T<a;T++)T<c?u=e[T]=p[T]:(t=u,T%c==0?(t=l[(t=t<<8|t>>>24)>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t],t^=n[T/c|0]<<24):c>6&&T%c==4&&(t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t]),e[T]=u=(e[T-c]^t)>>>0);for(E=0;E<a;E++)T=a-E,t=3&E?e[T]:e[T-4],s[E]=E<4||T<=4?t:v[l[t>>>24]]^f[l[t>>>16&255]]^g[l[t>>>8&255]]^r[l[255&t]],s[E]=s[E]>>>0}},C.networkToHostOrderSwap=function(m){return m<<24|(65280&m)<<8|(16711680&m)>>8|m>>>24},C.decrypt=function(m,p,A){for(var y,c,T,E,u,t,a,e,s,l,n,o,v,f,g=this.keySize+6,r=this.invKeySchedule,i=this.invSBox,d=this.invSubMix,b=d[0],L=d[1],k=d[2],I=d[3],O=this.uint8ArrayToUint32Array_(A),x=O[0],P=O[1],F=O[2],M=O[3],B=new Int32Array(m),U=new Int32Array(B.length),G=this.networkToHostOrderSwap;p<B.length;){for(s=G(B[p]),l=G(B[p+1]),n=G(B[p+2]),o=G(B[p+3]),u=s^r[0],t=o^r[1],a=n^r[2],e=l^r[3],v=4,f=1;f<g;f++)y=b[u>>>24]^L[t>>16&255]^k[a>>8&255]^I[255&e]^r[v],c=b[t>>>24]^L[a>>16&255]^k[e>>8&255]^I[255&u]^r[v+1],T=b[a>>>24]^L[e>>16&255]^k[u>>8&255]^I[255&t]^r[v+2],E=b[e>>>24]^L[u>>16&255]^k[t>>8&255]^I[255&a]^r[v+3],u=y,t=c,a=T,e=E,v+=4;y=i[u>>>24]<<24^i[t>>16&255]<<16^i[a>>8&255]<<8^i[255&e]^r[v],c=i[t>>>24]<<24^i[a>>16&255]<<16^i[e>>8&255]<<8^i[255&u]^r[v+1],T=i[a>>>24]<<24^i[e>>16&255]<<16^i[u>>8&255]<<8^i[255&t]^r[v+2],E=i[e>>>24]<<24^i[u>>16&255]<<16^i[t>>8&255]<<8^i[255&a]^r[v+3],U[p]=G(y^x),U[p+1]=G(E^P),U[p+2]=G(T^F),U[p+3]=G(c^M),x=s,P=l,F=n,M=o,p+=4}return U.buffer},R}()},"./src/crypt/decrypter.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return p});var _=h("./src/crypt/aes-crypto.ts"),S=h("./src/crypt/fast-aes-key.ts"),D=h("./src/crypt/aes-decryptor.ts"),R=h("./src/utils/logger.ts"),C=h("./src/utils/mp4-tools.ts"),m=h("./src/utils/typed-array.ts"),p=function(){function A(c,T,E){var u=(E===void 0?{}:E).removePKCS7Padding,t=u===void 0||u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=c,this.config=T,this.removePKCS7Padding=t,t)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=A.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var c=this.currentResult;if(c){var T=new Uint8Array(c);return this.reset(),this.removePKCS7Padding?Object(D.removePadding)(T):T}this.reset()},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(c,T,E,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(c),T,E);var t=this.flush();t&&u(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(c),T,E).then(u)},y.softwareDecrypt=function(c,T,E){var u=this.currentIV,t=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(c=Object(C.appendUint8Array)(a,c),this.remainderData=null);var e=this.getValidChunk(c);if(!e.length)return null;u&&(E=u);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new D.default),s.expandKey(T);var l=t;return this.currentResult=s.decrypt(e.buffer,0,E),this.currentIV=Object(m.sliceUint8)(e,-16).buffer,l||null},y.webCryptoDecrypt=function(c,T,E){var u=this,t=this.subtle;return this.key===T&&this.fastAesKey||(this.key=T,this.fastAesKey=new S.default(t,T)),this.fastAesKey.expandKey().then(function(a){return t?new _.default(t,E).decrypt(c.buffer,a):Promise.reject(new Error("web crypto not initialized"))}).catch(function(a){return u.onWebCryptoError(a,c,T,E)})},y.onWebCryptoError=function(c,T,E,u){return R.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",c),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,E,u)},y.getValidChunk=function(c){var T=c,E=c.length-c.length%16;return E!==c.length&&(T=Object(m.sliceUint8)(c,0,E),this.remainderData=Object(m.sliceUint8)(c,E)),T},y.logOnce=function(c){this.logEnabled&&(R.logger.log("[decrypter.ts]: "+c),this.logEnabled=!1)},A}()},"./src/crypt/fast-aes-key.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function S(D,R){this.subtle=void 0,this.key=void 0,this.subtle=D,this.key=R}return S.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},S}()},"./src/demux/aacdemuxer.ts":function(N,w,h){h.r(w);var _=h("./src/demux/base-audio-demuxer.ts"),S=h("./src/demux/adts.ts"),D=h("./src/utils/logger.ts"),R=h("./src/demux/id3.ts");function C(p,A){return(C=Object.setPrototypeOf||function(y,c){return y.__proto__=c,y})(p,A)}var m=function(p){var A,y;function c(E,u){var t;return(t=p.call(this)||this).observer=void 0,t.config=void 0,t.observer=E,t.config=u,t}y=p,(A=c).prototype=Object.create(y.prototype),A.prototype.constructor=A,C(A,y);var T=c.prototype;return T.resetInitSegment=function(E,u,t){p.prototype.resetInitSegment.call(this,E,u,t),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:E,duration:t,inputTimeScale:9e4,dropped:0}},c.probe=function(E){if(!E)return!1;for(var u=(R.getID3Data(E,0)||[]).length,t=E.length;u<t;u++)if(S.probe(E,u))return D.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(E,u){return S.canParse(E,u)},T.appendFrame=function(E,u,t){S.initTrackConfig(E,this.observer,u,t,E.manifestCodec);var a=S.appendFrame(E,u,t,this.initPTS,this.frameIndex);if(a&&a.missing===0)return a},c}(_.default);m.minProbeByteLength=9,w.default=m},"./src/demux/adts.ts":function(N,w,h){h.r(w),h.d(w,"getAudioConfig",function(){return R}),h.d(w,"isHeaderPattern",function(){return C}),h.d(w,"getHeaderLength",function(){return m}),h.d(w,"getFullFrameLength",function(){return p}),h.d(w,"canGetFrameLength",function(){return A}),h.d(w,"isHeader",function(){return y}),h.d(w,"canParse",function(){return c}),h.d(w,"probe",function(){return T}),h.d(w,"initTrackConfig",function(){return E}),h.d(w,"getFrameDuration",function(){return u}),h.d(w,"parseFrameHeader",function(){return t}),h.d(w,"appendFrame",function(){return a});var _=h("./src/utils/logger.ts"),S=h("./src/errors.ts"),D=h("./src/events.ts");function R(e,s,l,n){var o,v,f,g,r=navigator.userAgent.toLowerCase(),i=n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&s[l+2])>>>6);var b=(60&s[l+2])>>>2;if(!(b>d.length-1))return f=(1&s[l+2])<<2,f|=(192&s[l+3])>>>6,_.logger.log("manifest codec:"+n+", ADTS type:"+o+", samplingIndex:"+b),/firefox/i.test(r)?b>=6?(o=5,g=new Array(4),v=b-3):(o=2,g=new Array(2),v=b):r.indexOf("android")!==-1?(o=2,g=new Array(2),v=b):(o=5,g=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&b>=6?v=b-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(b>=6&&f===1||/vivaldi/i.test(r))||!n&&f===1)&&(o=2,g=new Array(2)),v=b)),g[0]=o<<3,g[0]|=(14&b)>>1,g[1]|=(1&b)<<7,g[1]|=f<<3,o===5&&(g[1]|=(14&v)>>1,g[2]=(1&v)<<7,g[2]|=8,g[3]=0),{config:g,samplerate:d[b],channelCount:f,codec:"mp4a.40."+o,manifestCodec:i};e.trigger(D.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function C(e,s){return e[s]===255&&(246&e[s+1])==240}function m(e,s){return 1&e[s+1]?7:9}function p(e,s){return(3&e[s+3])<<11|e[s+4]<<3|(224&e[s+5])>>>5}function A(e,s){return s+5<e.length}function y(e,s){return s+1<e.length&&C(e,s)}function c(e,s){return A(e,s)&&C(e,s)&&p(e,s)<=e.length-s}function T(e,s){if(y(e,s)){var l=m(e,s);if(s+l>=e.length)return!1;var n=p(e,s);if(n<=l)return!1;var o=s+n;return o===e.length||y(e,o)}return!1}function E(e,s,l,n,o){if(!e.samplerate){var v=R(s,l,n,o);if(!v)return;e.config=v.config,e.samplerate=v.samplerate,e.channelCount=v.channelCount,e.codec=v.codec,e.manifestCodec=v.manifestCodec,_.logger.log("parsed codec:"+e.codec+", rate:"+v.samplerate+", channels:"+v.channelCount)}}function u(e){return 9216e4/e}function t(e,s,l,n,o){var v=m(e,s),f=p(e,s);if((f-=v)>0)return{headerLength:v,frameLength:f,stamp:l+n*o}}function a(e,s,l,n,o){var v=t(s,l,n,o,u(e.samplerate));if(v){var f,g=v.frameLength,r=v.headerLength,i=v.stamp,d=r+g,b=Math.max(0,l+d-s.length);b?(f=new Uint8Array(d-r)).set(s.subarray(l+r,s.length),0):f=s.subarray(l+r,l+d);var L={unit:f,pts:i};return b||e.samples.push(L),{sample:L,length:d,missing:b}}}},"./src/demux/base-audio-demuxer.ts":function(N,w,h){h.r(w),h.d(w,"initPTSFn",function(){return p});var _=h("./src/polyfills/number.ts"),S=h("./src/demux/id3.ts"),D=h("./src/demux/dummy-demuxed-track.ts"),R=h("./src/utils/mp4-tools.ts"),C=h("./src/utils/typed-array.ts"),m=function(){function A(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=A.prototype;return y.resetInitSegment=function(c,T,E){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(c,T){return!1},y.appendFrame=function(c,T,E){},y.demux=function(c,T){this.cachedData&&(c=Object(R.appendUint8Array)(this.cachedData,c),this.cachedData=null);var E,u,t=S.getID3Data(c,0),a=t?t.length:0,e=this._audioTrack,s=this._id3Track,l=t?S.getTimeStamp(t):void 0,n=c.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=p(l,T)),t&&t.length>0&&s.samples.push({pts:this.initPTS,dts:this.initPTS,data:t}),u=this.initPTS;a<n;){if(this.canParse(c,a)){var o=this.appendFrame(e,c,a);o?(this.frameIndex++,u=o.sample.pts,E=a+=o.length):a=n}else S.canParse(c,a)?(t=S.getID3Data(c,a),s.samples.push({pts:u,dts:u,data:t}),E=a+=t.length):a++;if(a===n&&E!==n){var v=Object(C.sliceUint8)(c,E);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:e,avcTrack:Object(D.dummyTrack)(),id3Track:s,textTrack:Object(D.dummyTrack)()}},y.demuxSampleAes=function(c,T,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(c){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(D.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(D.dummyTrack)()}},y.destroy=function(){},A}(),p=function(A,y){return Object(_.isFiniteNumber)(A)?90*A:9e4*y};w.default=m},"./src/demux/chunk-cache.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function S(){this.chunks=[],this.dataLength=0}var D=S.prototype;return D.push=function(R){this.chunks.push(R),this.dataLength+=R.length},D.flush=function(){var R,C=this.chunks,m=this.dataLength;return C.length?(R=C.length===1?C[0]:function(p,A){for(var y=new Uint8Array(A),c=0,T=0;T<p.length;T++){var E=p[T];y.set(E,c),c+=E.length}return y}(C,m),this.reset(),R):new Uint8Array(0)},D.reset=function(){this.chunks.length=0,this.dataLength=0},S}()},"./src/demux/dummy-demuxed-track.ts":function(N,w,h){function _(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}h.r(w),h.d(w,"dummyTrack",function(){return _})},"./src/demux/exp-golomb.ts":function(N,w,h){h.r(w);var _=h("./src/utils/logger.ts"),S=function(){function D(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var R=D.prototype;return R.loadWord=function(){var C=this.data,m=this.bytesAvailable,p=C.byteLength-m,A=new Uint8Array(4),y=Math.min(4,m);if(y===0)throw new Error("no bytes available");A.set(C.subarray(p,p+y)),this.word=new DataView(A.buffer).getUint32(0),this.bitsAvailable=8*y,this.bytesAvailable-=y},R.skipBits=function(C){var m;this.bitsAvailable>C?(this.word<<=C,this.bitsAvailable-=C):(C-=this.bitsAvailable,C-=(m=C>>3)>>3,this.bytesAvailable-=m,this.loadWord(),this.word<<=C,this.bitsAvailable-=C)},R.readBits=function(C){var m=Math.min(this.bitsAvailable,C),p=this.word>>>32-m;return C>32&&_.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=m,this.bitsAvailable>0?this.word<<=m:this.bytesAvailable>0&&this.loadWord(),(m=C-m)>0&&this.bitsAvailable?p<<m|this.readBits(m):p},R.skipLZ=function(){var C;for(C=0;C<this.bitsAvailable;++C)if((this.word&2147483648>>>C)!=0)return this.word<<=C,this.bitsAvailable-=C,C;return this.loadWord(),C+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var C=this.skipLZ();return this.readBits(C+1)-1},R.readEG=function(){var C=this.readUEG();return 1&C?1+C>>>1:-1*(C>>>1)},R.readBoolean=function(){return this.readBits(1)===1},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(C){for(var m=8,p=8,A=0;A<C;A++)p!==0&&(p=(m+this.readEG()+256)%256),m=p===0?m:p},R.readSPS=function(){var C,m,p,A=0,y=0,c=0,T=0,E=this.readUByte.bind(this),u=this.readBits.bind(this),t=this.readUEG.bind(this),a=this.readBoolean.bind(this),e=this.skipBits.bind(this),s=this.skipEG.bind(this),l=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);E();var o=E();if(u(5),e(3),E(),l(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var v=t();if(v===3&&e(1),l(),l(),e(1),a())for(m=v!==3?8:12,p=0;p<m;p++)a()&&n(p<6?16:64)}l();var f=t();if(f===0)t();else if(f===1)for(e(1),s(),s(),C=t(),p=0;p<C;p++)s();l(),e(1);var g=t(),r=t(),i=u(1);i===0&&e(1),e(1),a()&&(A=t(),y=t(),c=t(),T=t());var d=[1,1];if(a()&&a())switch(E()){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:d=[E()<<8|E(),E()<<8|E()]}return{width:Math.ceil(16*(g+1)-2*A-2*y),height:(2-i)*(r+1)*16-(i?2:4)*(c+T),pixelRatio:d}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();w.default=S},"./src/demux/id3.ts":function(N,w,h){h.r(w),h.d(w,"isHeader",function(){return S}),h.d(w,"isFooter",function(){return D}),h.d(w,"getID3Data",function(){return R}),h.d(w,"canParse",function(){return m}),h.d(w,"getTimeStamp",function(){return p}),h.d(w,"isTimeStampFrame",function(){return A}),h.d(w,"getID3Frames",function(){return c}),h.d(w,"decodeFrame",function(){return T}),h.d(w,"utf8ArrayToStr",function(){return e}),h.d(w,"testables",function(){return s});var _,S=function(l,n){return n+10<=l.length&&l[n]===73&&l[n+1]===68&&l[n+2]===51&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},D=function(l,n){return n+10<=l.length&&l[n]===51&&l[n+1]===68&&l[n+2]===73&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},R=function(l,n){for(var o=n,v=0;S(l,n);)v+=10,v+=C(l,n+6),D(l,n+10)&&(v+=10),n+=v;if(v>0)return l.subarray(o,o+v)},C=function(l,n){var o=0;return o=(127&l[n])<<21,o|=(127&l[n+1])<<14,o|=(127&l[n+2])<<7,o|=127&l[n+3]},m=function(l,n){return S(l,n)&&C(l,n+6)+10<=l.length-n},p=function(l){for(var n=c(l),o=0;o<n.length;o++){var v=n[o];if(A(v))return a(v)}},A=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},y=function(l){var n=String.fromCharCode(l[0],l[1],l[2],l[3]),o=C(l,4);return{type:n,size:o,data:l.subarray(10,10+o)}},c=function(l){for(var n=0,o=[];S(l,n);){for(var v=C(l,n+6),f=(n+=10)+v;n+8<f;){var g=y(l.subarray(n)),r=T(g);r&&o.push(r),n+=g.size+10}D(l,n)&&(n+=10)}return o},T=function(l){return l.type==="PRIV"?E(l):l.type[0]==="W"?t(l):u(l)},E=function(l){if(!(l.size<2)){var n=e(l.data,!0),o=new Uint8Array(l.data.subarray(n.length+1));return{key:l.type,info:n,data:o.buffer}}},u=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var n=1,o=e(l.data.subarray(n),!0);n+=o.length+1;var v=e(l.data.subarray(n));return{key:l.type,info:o,data:v}}var f=e(l.data.subarray(1));return{key:l.type,data:f}}},t=function(l){if(l.type==="WXXX"){if(l.size<2)return;var n=1,o=e(l.data.subarray(n),!0);n+=o.length+1;var v=e(l.data.subarray(n));return{key:l.type,info:o,data:v}}var f=e(l.data);return{key:l.type,data:f}},a=function(l){if(l.data.byteLength===8){var n=new Uint8Array(l.data),o=1&n[3],v=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return v/=45,o&&(v+=4772185884e-2),Math.round(v)}},e=function(l,n){n===void 0&&(n=!1);var o=(_||self.TextDecoder===void 0||(_=new self.TextDecoder("utf-8")),_);if(o){var v=o.decode(l);if(n){var f=v.indexOf("\0");return f!==-1?v.substring(0,f):v}return v.replace(/\0/g,"")}for(var g,r,i,d=l.length,b="",L=0;L<d;){if((g=l[L++])===0&&n)return b;if(g!==0&&g!==3)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(g);break;case 12:case 13:r=l[L++],b+=String.fromCharCode((31&g)<<6|63&r);break;case 14:r=l[L++],i=l[L++],b+=String.fromCharCode((15&g)<<12|(63&r)<<6|(63&i)<<0)}}return b},s={decodeTextFrame:u}},"./src/demux/mp3demuxer.ts":function(N,w,h){h.r(w);var _=h("./src/demux/base-audio-demuxer.ts"),S=h("./src/demux/id3.ts"),D=h("./src/utils/logger.ts"),R=h("./src/demux/mpegaudio.ts");function C(p,A){return(C=Object.setPrototypeOf||function(y,c){return y.__proto__=c,y})(p,A)}var m=function(p){var A,y;function c(){return p.apply(this,arguments)||this}y=p,(A=c).prototype=Object.create(y.prototype),A.prototype.constructor=A,C(A,y);var T=c.prototype;return T.resetInitSegment=function(E,u,t){p.prototype.resetInitSegment.call(this,E,u,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:E,duration:t,inputTimeScale:9e4,dropped:0}},c.probe=function(E){if(!E)return!1;for(var u=(S.getID3Data(E,0)||[]).length,t=E.length;u<t;u++)if(R.probe(E,u))return D.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(E,u){return R.canParse(E,u)},T.appendFrame=function(E,u,t){if(this.initPTS!==null)return R.appendFrame(E,u,t,this.initPTS,this.frameIndex)},c}(_.default);m.minProbeByteLength=4,w.default=m},"./src/demux/mp4demuxer.ts":function(N,w,h){h.r(w);var _=h("./src/utils/mp4-tools.ts"),S=h("./src/demux/dummy-demuxed-track.ts"),D=function(){function R(m,p){this.remainderData=null,this.config=void 0,this.config=p}var C=R.prototype;return C.resetTimeStamp=function(){},C.resetInitSegment=function(){},C.resetContiguity=function(){},R.probe=function(m){return Object(_.findBox)({data:m,start:0,end:Math.min(m.length,16384)},["moof"]).length>0},C.demux=function(m){var p=m,A=Object(S.dummyTrack)();if(this.config.progressive){this.remainderData&&(p=Object(_.appendUint8Array)(this.remainderData,m));var y=Object(_.segmentValidRange)(p);this.remainderData=y.remainder,A.samples=y.valid||new Uint8Array}else A.samples=p;return{audioTrack:Object(S.dummyTrack)(),avcTrack:A,id3Track:Object(S.dummyTrack)(),textTrack:Object(S.dummyTrack)()}},C.flush=function(){var m=Object(S.dummyTrack)();return m.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(S.dummyTrack)(),avcTrack:m,id3Track:Object(S.dummyTrack)(),textTrack:Object(S.dummyTrack)()}},C.demuxSampleAes=function(m,p,A){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},C.destroy=function(){},R}();D.minProbeByteLength=1024,w.default=D},"./src/demux/mpegaudio.ts":function(N,w,h){h.r(w),h.d(w,"appendFrame",function(){return m}),h.d(w,"parseHeader",function(){return p}),h.d(w,"isHeaderPattern",function(){return A}),h.d(w,"isHeader",function(){return y}),h.d(w,"canParse",function(){return c}),h.d(w,"probe",function(){return T});var _=null,S=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],D=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function m(E,u,t,a,e){if(!(t+24>u.length)){var s=p(u,t);if(s&&t+s.frameLength<=u.length){var l=a+e*(9e4*s.samplesPerFrame/s.sampleRate),n={unit:u.subarray(t,t+s.frameLength),pts:l,dts:l};return E.config=[],E.channelCount=s.channelCount,E.samplerate=s.sampleRate,E.samples.push(n),{sample:n,length:s.frameLength,missing:0}}}}function p(E,u){var t=E[u+1]>>3&3,a=E[u+1]>>1&3,e=E[u+2]>>4&15,s=E[u+2]>>2&3;if(t!==1&&e!==0&&e!==15&&s!==3){var l=E[u+2]>>1&1,n=E[u+3]>>6,o=1e3*S[14*(t===3?3-a:a===3?3:4)+e-1],v=D[3*(t===3?0:t===2?1:2)+s],f=n===3?1:2,g=R[t][a],r=C[a],i=8*g*r,d=Math.floor(g*o/v+l)*r;if(_===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_=b?parseInt(b[1]):0}return!!_&&_<=87&&a===2&&o>=224e3&&n===0&&(E[u+3]=128|E[u+3]),{sampleRate:v,channelCount:f,frameLength:d,samplesPerFrame:i}}}function A(E,u){return E[u]===255&&(224&E[u+1])==224&&(6&E[u+1])!=0}function y(E,u){return u+1<E.length&&A(E,u)}function c(E,u){return A(E,u)&&4<=E.length-u}function T(E,u){if(u+1<E.length&&A(E,u)){var t=p(E,u),a=4;t!=null&&t.frameLength&&(a=t.frameLength);var e=u+a;return e===E.length||y(E,e)}return!1}},"./src/demux/sample-aes.ts":function(N,w,h){h.r(w);var _=h("./src/crypt/decrypter.ts"),S=h("./src/demux/tsdemuxer.ts"),D=function(){function R(m,p,A){this.keyData=void 0,this.decrypter=void 0,this.keyData=A,this.decrypter=new _.default(m,p,{removePKCS7Padding:!1})}var C=R.prototype;return C.decryptBuffer=function(m,p){this.decrypter.decrypt(m,this.keyData.key.buffer,this.keyData.iv.buffer,p)},C.decryptAacSample=function(m,p,A,y){var c=m[p].unit,T=c.subarray(16,c.length-c.length%16),E=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),u=this;this.decryptBuffer(E,function(t){var a=new Uint8Array(t);c.set(a,16),y||u.decryptAacSamples(m,p+1,A)})},C.decryptAacSamples=function(m,p,A){for(;;p++){if(p>=m.length)return void A();if(!(m[p].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(m,p,A,y),!y)return}}},C.getAvcEncryptedData=function(m){for(var p=16*Math.floor((m.length-48)/160)+16,A=new Int8Array(p),y=0,c=32;c<=m.length-16;c+=160,y+=16)A.set(m.subarray(c,c+16),y);return A},C.getAvcDecryptedUnit=function(m,p){for(var A=new Uint8Array(p),y=0,c=32;c<=m.length-16;c+=160,y+=16)m.set(A.subarray(y,y+16),c);return m},C.decryptAvcSample=function(m,p,A,y,c,T){var E=Object(S.discardEPB)(c.data),u=this.getAvcEncryptedData(E),t=this;this.decryptBuffer(u.buffer,function(a){c.data=t.getAvcDecryptedUnit(E,a),T||t.decryptAvcSamples(m,p,A+1,y)})},C.decryptAvcSamples=function(m,p,A,y){if(m instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;p++,A=0){if(p>=m.length)return void y();for(var c=m[p].units;!(A>=c.length);A++){var T=c[A];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var E=this.decrypter.isSync();if(this.decryptAvcSample(m,p,A,y,T,E),!E)return}}}},R}();w.default=D},"./src/demux/transmuxer-interface.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return y});var _=h("./node_modules/webworkify-webpack/index.js"),S=h("./src/events.ts"),D=h("./src/demux/transmuxer.ts"),R=h("./src/utils/logger.ts"),C=h("./src/errors.ts"),m=h("./src/utils/mediasource-helper.ts"),p=h("./node_modules/eventemitter3/index.js"),A=Object(m.getMediaSource)()||{isTypeSupported:function(){return!1}},y=function(){function c(E,u,t,a){var e=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=E,this.id=u,this.onTransmuxComplete=t,this.onFlush=a;var s=E.config,l=function(f,g){(g=g||{}).frag=e.frag,g.id=e.id,E.trigger(f,g)};this.observer=new p.EventEmitter,this.observer.on(S.Events.FRAG_DECRYPTED,l),this.observer.on(S.Events.ERROR,l);var n={mp4:A.isTypeSupported("video/mp4"),mpeg:A.isTypeSupported("audio/mpeg"),mp3:A.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){var v;R.logger.log("demuxing in webworker");try{v=this.worker=_("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(f){E.trigger(S.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},v.postMessage({cmd:"init",typeSupported:n,vendor:o,id:u,config:JSON.stringify(s)})}catch(f){R.logger.warn("Error in worker:",f),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),v&&self.URL.revokeObjectURL(v.objectURL),this.transmuxer=new D.default(this.observer,n,s,o,u),this.worker=null}}else this.transmuxer=new D.default(this.observer,n,s,o,u)}var T=c.prototype;return T.destroy=function(){var E=this.worker;if(E)E.removeEventListener("message",this.onwmsg),E.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.observer=null},T.push=function(E,u,t,a,e,s,l,n,o,v){var f=this;o.transmuxing.start=self.performance.now();var g=this.transmuxer,r=this.worker,i=s?s.start:e.start,d=e.decryptdata,b=this.frag,L=!(b&&e.cc===b.cc),k=!(b&&o.level===b.level),I=b?o.sn-b.sn:-1,O=this.part?o.part-this.part.index:1,x=!k&&(I===1||I===0&&O===1),P=self.performance.now();(k||I||e.stats.parsing.start===0)&&(e.stats.parsing.start=P),!s||!O&&x||(s.stats.parsing.start=P);var F=new D.TransmuxState(L,x,n,k,i);if(!x||L){R.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+L+`
        trackSwitch: `+k+`
        contiguous: `+x+`
        accurateTimeOffset: `+n+`
        timeOffset: `+i);var M=new D.TransmuxConfig(t,a,u,l,v);this.configureTransmuxer(M)}if(this.frag=e,this.part=s,r)r.postMessage({cmd:"demux",data:E,decryptdata:d,chunkMeta:o,state:F},E instanceof ArrayBuffer?[E]:[]);else if(g){var B=g.push(E,d,o,F);Object(D.isPromise)(B)?B.then(function(U){f.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},T.flush=function(E){var u=this;E.transmuxing.start=self.performance.now();var t=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:E});else if(t){var e=t.flush(E);Object(D.isPromise)(e)?e.then(function(s){u.handleFlushResult(s,E)}):this.handleFlushResult(e,E)}},T.handleFlushResult=function(E,u){var t=this;E.forEach(function(a){t.handleTransmuxComplete(a)}),this.onFlush(u)},T.onWorkerMessage=function(E){var u=E.data,t=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,t.trigger(u.event,u.data)}},T.configureTransmuxer=function(E){var u=this.worker,t=this.transmuxer;u?u.postMessage({cmd:"configure",config:E}):t&&t.configure(E)},T.handleTransmuxComplete=function(E){E.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(E)},c}()},"./src/demux/transmuxer-worker.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return C});var _=h("./src/demux/transmuxer.ts"),S=h("./src/events.ts"),D=h("./src/utils/logger.ts"),R=h("./node_modules/eventemitter3/index.js");function C(y){var c=new R.EventEmitter,T=function(E,u){y.postMessage({event:E,data:u})};c.on(S.Events.FRAG_DECRYPTED,T),c.on(S.Events.ERROR,T),y.addEventListener("message",function(E){var u=E.data;switch(u.cmd){case"init":var t=JSON.parse(u.config);y.transmuxer=new _.default(c,u.typeSupported,t,u.vendor,u.id),Object(D.enableLogs)(t.debug),T("init",null);break;case"configure":y.transmuxer.configure(u.config);break;case"demux":var a=y.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(_.isPromise)(a)?a.then(function(l){m(y,l)}):m(y,a);break;case"flush":var e=u.chunkMeta,s=y.transmuxer.flush(e);Object(_.isPromise)(s)?s.then(function(l){A(y,l,e)}):A(y,s,e)}})}function m(y,c){if((T=c.remuxResult).audio||T.video||T.text||T.id3||T.initSegment){var T,E=[],u=c.remuxResult,t=u.audio,a=u.video;t&&p(E,t),a&&p(E,a),y.postMessage({event:"transmuxComplete",data:c},E)}}function p(y,c){c.data1&&y.push(c.data1.buffer),c.data2&&y.push(c.data2.buffer)}function A(y,c,T){c.forEach(function(E){m(y,E)}),y.postMessage({event:"flush",data:T})}},"./src/demux/transmuxer.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return e}),h.d(w,"isPromise",function(){return l}),h.d(w,"TransmuxConfig",function(){return n}),h.d(w,"TransmuxState",function(){return o});var _,S=h("./src/events.ts"),D=h("./src/errors.ts"),R=h("./src/crypt/decrypter.ts"),C=h("./src/demux/aacdemuxer.ts"),m=h("./src/demux/mp4demuxer.ts"),p=h("./src/demux/tsdemuxer.ts"),A=h("./src/demux/mp3demuxer.ts"),y=h("./src/remux/mp4-remuxer.ts"),c=h("./src/remux/passthrough-remuxer.ts"),T=h("./src/demux/chunk-cache.ts"),E=h("./src/utils/mp4-tools.ts"),u=h("./src/utils/logger.ts");try{_=self.performance.now.bind(self.performance)}catch{u.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var t=[{demux:p.default,remux:y.default},{demux:m.default,remux:c.default},{demux:C.default,remux:y.default},{demux:A.default,remux:y.default}],a=1024;t.forEach(function(v){var f=v.demux;a=Math.max(a,f.minProbeByteLength)});var e=function(){function v(g,r,i,d,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=g,this.typeSupported=r,this.config=i,this.vendor=d,this.id=b}var f=v.prototype;return f.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},f.push=function(g,r,i,d){var b=this,L=i.transmuxing;L.executeStart=_();var k=new Uint8Array(g),I=this.cache,O=this.config,x=this.currentTransmuxState,P=this.transmuxConfig;d&&(this.currentTransmuxState=d);var F=function(nt,it){var dt=null;return nt.byteLength>0&&it!=null&&it.key!=null&&it.iv!==null&&it.method!=null&&(dt=it),dt}(k,r);if(F&&F.method==="AES-128"){var M=this.getDecrypter();if(!O.enableSoftwareAES)return this.decryptionPromise=M.webCryptoDecrypt(k,F.key.buffer,F.iv.buffer).then(function(nt){var it=b.push(nt,null,i);return b.decryptionPromise=null,it}),this.decryptionPromise;var B=M.softwareDecrypt(k,F.key.buffer,F.iv.buffer);if(!B)return L.executeEnd=_(),s(i);k=new Uint8Array(B)}var U=d||x,G=U.contiguous,K=U.discontinuity,H=U.trackSwitch,Y=U.accurateTimeOffset,W=U.timeOffset,q=P.audioCodec,Q=P.videoCodec,tt=P.defaultInitPts,rt=P.duration,z=P.initSegmentData;if((K||H)&&this.resetInitSegment(z,q,Q,rt),K&&this.resetInitialTimestamp(tt),G||this.resetContiguity(),this.needsProbing(k,K,H)){if(I.dataLength){var at=I.flush();k=Object(E.appendUint8Array)(at,k)}this.configureTransmuxer(k,P)}var X=this.transmux(k,F,W,Y,i),J=this.currentTransmuxState;return J.contiguous=!0,J.discontinuity=!1,J.trackSwitch=!1,L.executeEnd=_(),X},f.flush=function(g){var r=this,i=g.transmuxing;i.executeStart=_();var d=this.decrypter,b=this.cache,L=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return r.flush(g)});var I=[],O=L.timeOffset;if(d){var x=d.flush();x&&I.push(this.push(x,null,g))}var P=b.dataLength;b.reset();var F=this.demuxer,M=this.remuxer;if(!F||!M)return P>=a&&this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),i.executeEnd=_(),[s(g)];var B=F.flush(O);return l(B)?B.then(function(U){return r.flushRemux(I,U,g),I}):(this.flushRemux(I,B,g),I)},f.flushRemux=function(g,r,i){var d=r.audioTrack,b=r.avcTrack,L=r.id3Track,k=r.textTrack,I=this.currentTransmuxState,O=I.accurateTimeOffset,x=I.timeOffset;u.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var P=this.remuxer.remux(d,b,L,k,x,O,!0,this.id);g.push({remuxResult:P,chunkMeta:i}),i.transmuxing.executeEnd=_()},f.resetInitialTimestamp=function(g){var r=this.demuxer,i=this.remuxer;r&&i&&(r.resetTimeStamp(g),i.resetTimeStamp(g))},f.resetContiguity=function(){var g=this.demuxer,r=this.remuxer;g&&r&&(g.resetContiguity(),r.resetNextTimestamp())},f.resetInitSegment=function(g,r,i,d){var b=this.demuxer,L=this.remuxer;b&&L&&(b.resetInitSegment(r,i,d),L.resetInitSegment(g,r,i))},f.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},f.transmux=function(g,r,i,d,b){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(g,r,i,d,b):this.transmuxUnencrypted(g,i,d,b)},f.transmuxUnencrypted=function(g,r,i,d){var b=this.demuxer.demux(g,r,!1,!this.config.progressive),L=b.audioTrack,k=b.avcTrack,I=b.id3Track,O=b.textTrack;return{remuxResult:this.remuxer.remux(L,k,I,O,r,i,!1,this.id),chunkMeta:d}},f.transmuxSampleAes=function(g,r,i,d,b){var L=this;return this.demuxer.demuxSampleAes(g,r,i).then(function(k){return{remuxResult:L.remuxer.remux(k.audioTrack,k.avcTrack,k.id3Track,k.textTrack,i,d,!1,L.id),chunkMeta:b}})},f.configureTransmuxer=function(g,r){for(var i,d=this.config,b=this.observer,L=this.typeSupported,k=this.vendor,I=r.audioCodec,O=r.defaultInitPts,x=r.duration,P=r.initSegmentData,F=r.videoCodec,M=0,B=t.length;M<B;M++)if(t[M].demux.probe(g)){i=t[M];break}i||(u.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),i={demux:m.default,remux:c.default});var U=this.demuxer,G=this.remuxer,K=i.remux,H=i.demux;G&&G instanceof K||(this.remuxer=new K(b,d,L,k)),U&&U instanceof H||(this.demuxer=new H(b,d,L),this.probe=H.probe),this.resetInitSegment(P,I,F,x),this.resetInitialTimestamp(O)},f.needsProbing=function(g,r,i){return!this.demuxer||!this.remuxer||r||i},f.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new R.default(this.observer,this.config)),g},v}(),s=function(v){return{remuxResult:{},chunkMeta:v}};function l(v){return"then"in v&&v.then instanceof Function}var n=function(v,f,g,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=v,this.videoCodec=f,this.initSegmentData=g,this.duration=r,this.defaultInitPts=i},o=function(v,f,g,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=v,this.contiguous=f,this.accurateTimeOffset=g,this.trackSwitch=r,this.timeOffset=i}},"./src/demux/tsdemuxer.ts":function(N,w,h){h.r(w),h.d(w,"discardEPB",function(){return l});var _=h("./src/demux/adts.ts"),S=h("./src/demux/mpegaudio.ts"),D=h("./src/demux/exp-golomb.ts"),R=h("./src/demux/id3.ts"),C=h("./src/demux/sample-aes.ts"),m=h("./src/events.ts"),p=h("./src/utils/mp4-tools.ts"),A=h("./src/utils/logger.ts"),y=h("./src/errors.ts"),c={video:1,audio:2,id3:3,text:4},T=function(){function n(v,f,g){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=v,this.config=f,this.typeSupported=g}n.probe=function(v){var f=n.syncOffset(v);return!(f<0||(f&&A.logger.warn("MPEG2-TS detected but first sync word found @ offset "+f+", junk ahead ?"),0))},n.syncOffset=function(v){for(var f=Math.min(1e3,v.length-564),g=0;g<f;){if(v[g]===71&&v[g+188]===71&&v[g+376]===71)return g;g++}return-1},n.createTrack=function(v,f){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:c[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?f:void 0}};var o=n.prototype;return o.resetInitSegment=function(v,f,g){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=n.createTrack("video",g),this._audioTrack=n.createTrack("audio",g),this._id3Track=n.createTrack("id3",g),this._txtTrack=n.createTrack("text",g),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=v,this.videoCodec=f,this._duration=g},o.resetTimeStamp=function(){},o.resetContiguity=function(){var v=this._audioTrack,f=this._avcTrack,g=this._id3Track;v&&(v.pesData=null),f&&(f.pesData=null),g&&(g.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},o.demux=function(v,f,g,r){var i;g===void 0&&(g=!1),r===void 0&&(r=!1),g||(this.sampleAes=null);var d=this._avcTrack,b=this._audioTrack,L=this._id3Track,k=d.pid,I=d.pesData,O=b.pid,x=L.pid,P=b.pesData,F=L.pesData,M=!1,B=this.pmtParsed,U=this._pmtId,G=v.length;if(this.remainderData&&(G=(v=Object(p.appendUint8Array)(this.remainderData,v)).length,this.remainderData=null),G<188&&!r)return this.remainderData=v,{audioTrack:b,avcTrack:d,id3Track:L,textTrack:this._txtTrack};var K=Math.max(0,n.syncOffset(v));(G-=(G+K)%188)<v.byteLength&&!r&&(this.remainderData=new Uint8Array(v.buffer,G,v.buffer.byteLength-G));for(var H=K;H<G;H+=188)if(v[H]===71){var Y=!!(64&v[H+1]),W=((31&v[H+1])<<8)+v[H+2],q=void 0;if((48&v[H+3])>>4>1){if((q=H+5+v[H+4])===H+188)continue}else q=H+4;switch(W){case k:Y&&(I&&(i=a(I))&&this.parseAVCPES(i,!1),I={data:[],size:0}),I&&(I.data.push(v.subarray(q,H+188)),I.size+=H+188-q);break;case O:Y&&(P&&(i=a(P))&&(b.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),P={data:[],size:0}),P&&(P.data.push(v.subarray(q,H+188)),P.size+=H+188-q);break;case x:Y&&(F&&(i=a(F))&&this.parseID3PES(i),F={data:[],size:0}),F&&(F.data.push(v.subarray(q,H+188)),F.size+=H+188-q);break;case 0:Y&&(q+=v[q]+1),U=this._pmtId=u(v,q);break;case U:Y&&(q+=v[q]+1);var Q=t(v,q,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,g);(k=Q.avc)>0&&(d.pid=k),(O=Q.audio)>0&&(b.pid=O,b.isAAC=Q.isAAC),(x=Q.id3)>0&&(L.pid=x),M&&!B&&(A.logger.log("reparse from beginning"),M=!1,H=K-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:M=!0}}else this.observer.emit(m.Events.ERROR,m.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});d.pesData=I,b.pesData=P,L.pesData=F;var tt={audioTrack:b,avcTrack:d,id3Track:L,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(tt),tt},o.flush=function(){var v,f=this.remainderData;return this.remainderData=null,v=f?this.demux(f,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},o.extractRemainingSamples=function(v){var f,g=v.audioTrack,r=v.avcTrack,i=v.id3Track,d=r.pesData,b=g.pesData,L=i.pesData;d&&(f=a(d))?(this.parseAVCPES(f,!0),r.pesData=null):r.pesData=d,b&&(f=a(b))?(g.isAAC?this.parseAACPES(f):this.parseMPEGPES(f),g.pesData=null):(b!=null&&b.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=b),L&&(f=a(L))?(this.parseID3PES(f),i.pesData=null):i.pesData=L},o.demuxSampleAes=function(v,f,g){var r=this.demux(v,g,!0,!this.config.progressive),i=this.sampleAes=new C.default(this.observer,this.config,f);return this.decrypt(r,i)},o.decrypt=function(v,f){return new Promise(function(g){var r=v.audioTrack,i=v.avcTrack;r.samples&&r.isAAC?f.decryptAacSamples(r.samples,0,function(){i.samples?f.decryptAvcSamples(i.samples,0,0,function(){g(v)}):g(v)}):i.samples&&f.decryptAvcSamples(i.samples,0,0,function(){g(v)})})},o.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},o.parseAVCPES=function(v,f){var g,r=this,i=this._avcTrack,d=this.parseAVCNALu(v.data),b=this.avcSample,L=!1;v.data=null,b&&d.length&&!i.audFound&&(e(b,i),b=this.avcSample=E(!1,v.pts,v.dts,"")),d.forEach(function(k){switch(k.type){case 1:g=!0,b||(b=r.avcSample=E(!0,v.pts,v.dts,"")),b.frame=!0;var I=k.data;if(L&&I.length>4){var O=new D.default(I).readSliceType();O!==2&&O!==4&&O!==7&&O!==9||(b.key=!0)}break;case 5:g=!0,b||(b=r.avcSample=E(!0,v.pts,v.dts,"")),b.key=!0,b.frame=!0;break;case 6:g=!0;var x=new D.default(l(k.data));x.readUByte();for(var P=0,F=0,M=!1,B=0;!M&&x.bytesAvailable>1;){P=0;do P+=B=x.readUByte();while(B===255);F=0;do F+=B=x.readUByte();while(B===255);if(P===4&&x.bytesAvailable!==0){if(M=!0,x.readUByte()===181&&x.readUShort()===49&&x.readUInt()===1195456820&&x.readUByte()===3){for(var U=x.readUByte(),G=31&U,K=[U,x.readUByte()],H=0;H<G;H++)K.push(x.readUByte()),K.push(x.readUByte()),K.push(x.readUByte());s(r._txtTrack.samples,{type:3,pts:v.pts,bytes:K})}}else if(P===5&&x.bytesAvailable!==0){if(M=!0,F>16){for(var Y=[],W=0;W<16;W++)Y.push(x.readUByte().toString(16)),W!==3&&W!==5&&W!==7&&W!==9||Y.push("-");for(var q=F-16,Q=new Uint8Array(q),tt=0;tt<q;tt++)Q[tt]=x.readUByte();s(r._txtTrack.samples,{pts:v.pts,payloadType:P,uuid:Y.join(""),userData:Object(R.utf8ArrayToStr)(Q),userDataBytes:Q})}}else if(F<x.bytesAvailable)for(var rt=0;rt<F;rt++)x.readUByte()}break;case 7:if(g=!0,L=!0,!i.sps){var z=new D.default(k.data).readSPS();i.width=z.width,i.height=z.height,i.pixelRatio=z.pixelRatio,i.sps=[k.data],i.duration=r._duration;for(var at=k.data.subarray(1,4),X="avc1.",J=0;J<3;J++){var nt=at[J].toString(16);nt.length<2&&(nt="0"+nt),X+=nt}i.codec=X}break;case 8:g=!0,i.pps||(i.pps=[k.data]);break;case 9:g=!1,i.audFound=!0,b&&e(b,i),b=r.avcSample=E(!1,v.pts,v.dts,"");break;case 12:g=!1;break;default:g=!1,b&&(b.debug+="unknown NAL "+k.type+" ")}b&&g&&b.units.push(k)}),f&&b&&(e(b,i),this.avcSample=null)},o.getLastNalUnit=function(){var v,f,g=this.avcSample;if(!g||g.units.length===0){var r=this._avcTrack.samples;g=r[r.length-1]}if((v=g)!==null&&v!==void 0&&v.units){var i=g.units;f=i[i.length-1]}return f},o.parseAVCNALu=function(v){var f,g,r=v.byteLength,i=this._avcTrack,d=i.naluState||0,b=d,L=[],k=0,I=-1,O=0;for(d===-1&&(I=0,O=31&v[0],d=0,k=1);k<r;)if(f=v[k++],d)if(d!==1)if(f)if(f===1){if(I>=0){var x={data:v.subarray(I,k-d-1),type:O};L.push(x)}else{var P=this.getLastNalUnit();if(P&&(b&&k<=4-b&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-b)),(g=k-d-1)>0)){var F=new Uint8Array(P.data.byteLength+g);F.set(P.data,0),F.set(v.subarray(0,g),P.data.byteLength),P.data=F}}k<r?(I=k,O=31&v[k],d=0):d=-1}else d=0;else d=3;else d=f?0:2;else d=f?0:1;if(I>=0&&d>=0){var M={data:v.subarray(I,r),type:O,state:d};L.push(M)}if(L.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+v.byteLength);U.set(B.data,0),U.set(v,B.data.byteLength),B.data=U}}return i.naluState=d,L},o.parseAACPES=function(v){var f,g,r,i,d,b=0,L=this._audioTrack,k=this.aacOverFlow,I=v.data;if(k){this.aacOverFlow=null;var O=k.sample.unit.byteLength,x=Math.min(k.missing,O),P=O-x;k.sample.unit.set(I.subarray(0,x),P),L.samples.push(k.sample),b=k.missing}for(f=b,g=I.length;f<g-1&&!_.isHeader(I,f);f++);if(f===b||(f<g-1?(r="AAC PES did not start with ADTS header,offset:"+f,i=!1):(r="no ADTS header found in AAC PES",i=!0),A.logger.warn("parsing error:"+r),this.observer.emit(m.Events.ERROR,m.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:i,reason:r}),!i)){if(_.initTrackConfig(L,this.observer,I,f,this.audioCodec),v.pts!==void 0)d=v.pts;else{if(!k)return void A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var F=_.getFrameDuration(L.samplerate);d=k.sample.pts+F}for(var M=0;f<g;){if(_.isHeader(I,f)){if(f+5<g){var B=_.appendFrame(L,I,f,d,M);if(B){if(!B.missing){f+=B.length,M++;continue}this.aacOverFlow=B}}break}f++}}},o.parseMPEGPES=function(v){var f=v.data,g=f.length,r=0,i=0,d=v.pts;if(d!==void 0)for(;i<g;)if(S.isHeader(f,i)){var b=S.appendFrame(this._audioTrack,f,i,d,r);if(!b)break;i+=b.length,r++}else i++;else A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},o.parseID3PES=function(v){v.pts!==void 0?this._id3Track.samples.push(v):A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},n}();function E(n,o,v,f){return{key:n,frame:!1,pts:o,dts:v,units:[],debug:f,length:0}}function u(n,o){return(31&n[o+10])<<8|n[o+11]}function t(n,o,v,f){var g={audio:-1,avc:-1,id3:-1,isAAC:!0},r=o+3+((15&n[o+1])<<8|n[o+2])-4;for(o+=12+((15&n[o+10])<<8|n[o+11]);o<r;){var i=(31&n[o+1])<<8|n[o+2];switch(n[o]){case 207:if(!f){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:g.audio===-1&&(g.audio=i);break;case 21:g.id3===-1&&(g.id3=i);break;case 219:if(!f){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:g.avc===-1&&(g.avc=i);break;case 3:case 4:v?g.audio===-1&&(g.audio=i,g.isAAC=!1):A.logger.log("MPEG audio found, not supported in this browser");break;case 36:A.logger.warn("Unsupported HEVC stream type found")}o+=5+((15&n[o+3])<<8|n[o+4])}return g}function a(n){var o,v,f,g,r,i=0,d=n.data;if(!n||n.size===0)return null;for(;d[0].length<19&&d.length>1;){var b=new Uint8Array(d[0].length+d[1].length);b.set(d[0]),b.set(d[1],d[0].length),d[0]=b,d.splice(1,1)}if(((o=d[0])[0]<<16)+(o[1]<<8)+o[2]===1){if((v=(o[4]<<8)+o[5])&&v>n.size-6)return null;var L=o[7];192&L&&(g=536870912*(14&o[9])+4194304*(255&o[10])+16384*(254&o[11])+128*(255&o[12])+(254&o[13])/2,64&L?g-(r=536870912*(14&o[14])+4194304*(255&o[15])+16384*(254&o[16])+128*(255&o[17])+(254&o[18])/2)>54e5&&(A.logger.warn(Math.round((g-r)/9e4)+"s delta between PTS and DTS, align them"),g=r):r=g);var k=(f=o[8])+9;if(n.size<=k)return null;n.size-=k;for(var I=new Uint8Array(n.size),O=0,x=d.length;O<x;O++){var P=(o=d[O]).byteLength;if(k){if(k>P){k-=P;continue}o=o.subarray(k),P-=k,k=0}I.set(o,i),i+=P}return v&&(v-=f+3),{data:I,pts:g,dts:r,len:v}}return null}function e(n,o){if(n.units.length&&n.frame){if(n.pts===void 0){var v=o.samples,f=v.length;if(!f)return void o.dropped++;var g=v[f-1];n.pts=g.pts,n.dts=g.dts}o.samples.push(n)}n.debug.length&&A.logger.log(n.pts+"/"+n.dts+":"+n.debug)}function s(n,o){var v=n.length;if(v>0){if(o.pts>=n[v-1].pts)n.push(o);else for(var f=v-1;f>=0;f--)if(o.pts<n[f].pts){n.splice(f,0,o);break}}else n.push(o)}function l(n){for(var o=n.byteLength,v=[],f=1;f<o-2;)n[f]===0&&n[f+1]===0&&n[f+2]===3?(v.push(f+2),f+=2):f++;if(v.length===0)return n;var g=o-v.length,r=new Uint8Array(g),i=0;for(f=0;f<g;i++,f++)i===v[0]&&(i++,v.shift()),r[f]=n[i];return r}T.minProbeByteLength=188,w.default=T},"./src/errors.ts":function(N,w,h){var _,S,D,R;h.r(w),h.d(w,"ErrorTypes",function(){return _}),h.d(w,"ErrorDetails",function(){return D}),(S=_||(_={})).NETWORK_ERROR="networkError",S.MEDIA_ERROR="mediaError",S.KEY_SYSTEM_ERROR="keySystemError",S.MUX_ERROR="muxError",S.OTHER_ERROR="otherError",(R=D||(D={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"},"./src/events.ts":function(N,w,h){var _,S;h.r(w),h.d(w,"Events",function(){return _}),(S=_||(_={})).MEDIA_ATTACHING="hlsMediaAttaching",S.MEDIA_ATTACHED="hlsMediaAttached",S.MEDIA_DETACHING="hlsMediaDetaching",S.MEDIA_DETACHED="hlsMediaDetached",S.BUFFER_RESET="hlsBufferReset",S.BUFFER_CODECS="hlsBufferCodecs",S.BUFFER_CREATED="hlsBufferCreated",S.BUFFER_APPENDING="hlsBufferAppending",S.BUFFER_APPENDED="hlsBufferAppended",S.BUFFER_EOS="hlsBufferEos",S.BUFFER_FLUSHING="hlsBufferFlushing",S.BUFFER_FLUSHED="hlsBufferFlushed",S.MANIFEST_LOADING="hlsManifestLoading",S.MANIFEST_LOADED="hlsManifestLoaded",S.MANIFEST_PARSED="hlsManifestParsed",S.LEVEL_SWITCHING="hlsLevelSwitching",S.LEVEL_SWITCHED="hlsLevelSwitched",S.LEVEL_LOADING="hlsLevelLoading",S.LEVEL_LOADED="hlsLevelLoaded",S.LEVEL_UPDATED="hlsLevelUpdated",S.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",S.LEVELS_UPDATED="hlsLevelsUpdated",S.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",S.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",S.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",S.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",S.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",S.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",S.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",S.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",S.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",S.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",S.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",S.CUES_PARSED="hlsCuesParsed",S.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",S.INIT_PTS_FOUND="hlsInitPtsFound",S.FRAG_LOADING="hlsFragLoading",S.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",S.FRAG_LOADED="hlsFragLoaded",S.FRAG_DECRYPTED="hlsFragDecrypted",S.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",S.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",S.FRAG_PARSING_METADATA="hlsFragParsingMetadata",S.FRAG_PARSED="hlsFragParsed",S.FRAG_BUFFERED="hlsFragBuffered",S.FRAG_CHANGED="hlsFragChanged",S.FPS_DROP="hlsFpsDrop",S.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",S.ERROR="hlsError",S.DESTROYING="hlsDestroying",S.KEY_LOADING="hlsKeyLoading",S.KEY_LOADED="hlsKeyLoaded",S.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",S.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return e});var _=h("./node_modules/url-toolkit/src/url-toolkit.js"),S=h("./src/loader/playlist-loader.ts"),D=h("./src/loader/key-loader.ts"),R=h("./src/controller/id3-track-controller.ts"),C=h("./src/controller/latency-controller.ts"),m=h("./src/controller/level-controller.ts"),p=h("./src/controller/fragment-tracker.ts"),A=h("./src/controller/stream-controller.ts"),y=h("./src/is-supported.ts"),c=h("./src/utils/logger.ts"),T=h("./src/config.ts"),E=h("./node_modules/eventemitter3/index.js"),u=h("./src/events.ts"),t=h("./src/errors.ts");function a(s,l){for(var n=0;n<l.length;n++){var o=l[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,o.key,o)}}var e=function(){function s(f){f===void 0&&(f={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var g=this.config=Object(T.mergeConfig)(s.DefaultConfig,f);this.userConfig=f,Object(c.enableLogs)(g.debug),this._autoLevelCapping=-1,g.progressive&&Object(T.enableStreamingMode)(g);var r=g.abrController,i=g.bufferController,d=g.capLevelController,b=g.fpsController,L=this.abrController=new r(this),k=this.bufferController=new i(this),I=this.capLevelController=new d(this),O=new b(this),x=new S.default(this),P=new D.default(this),F=new R.default(this),M=this.levelController=new m.default(this),B=new p.FragmentTracker(this),U=this.streamController=new A.default(this,B);I.setStreamController(U),O.setStreamController(U);var G=[M,U];this.networkControllers=G;var K=[x,P,L,k,I,O,F,B];this.audioTrackController=this.createController(g.audioTrackController,null,G),this.createController(g.audioStreamController,B,G),this.subtitleTrackController=this.createController(g.subtitleTrackController,null,G),this.createController(g.subtitleStreamController,B,G),this.createController(g.timelineController,null,K),this.emeController=this.createController(g.emeController,null,K),this.latencyController=this.createController(C.default,null,K),this.coreComponents=K}s.isSupported=function(){return Object(y.isSupported)()};var l,n,o,v=s.prototype;return v.createController=function(f,g,r){if(f){var i=g?new f(this,g):new f(this);return r&&r.push(i),i}return null},v.on=function(f,g,r){r===void 0&&(r=this),this._emitter.on(f,g,r)},v.once=function(f,g,r){r===void 0&&(r=this),this._emitter.once(f,g,r)},v.removeAllListeners=function(f){this._emitter.removeAllListeners(f)},v.off=function(f,g,r,i){r===void 0&&(r=this),this._emitter.off(f,g,r,i)},v.listeners=function(f){return this._emitter.listeners(f)},v.emit=function(f,g,r){return this._emitter.emit(f,g,r)},v.trigger=function(f,g){if(this.config.debug)return this.emit(f,f,g);try{return this.emit(f,f,g)}catch(r){c.logger.error("An internal error happened while handling event "+f+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(u.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:f,error:r})}return!1},v.listenerCount=function(f){return this._emitter.listenerCount(f)},v.destroy=function(){c.logger.log("destroy"),this.trigger(u.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(f){return f.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(f){return f.destroy()}),this.coreComponents.length=0},v.attachMedia=function(f){c.logger.log("attachMedia"),this._media=f,this.trigger(u.Events.MEDIA_ATTACHING,{media:f})},v.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(u.Events.MEDIA_DETACHING,void 0),this._media=null},v.loadSource=function(f){this.stopLoad();var g=this.media,r=this.url,i=this.url=_.buildAbsoluteURL(self.location.href,f,{alwaysNormalize:!0});c.logger.log("loadSource:"+i),g&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(g)),this.trigger(u.Events.MANIFEST_LOADING,{url:f})},v.startLoad=function(f){f===void 0&&(f=-1),c.logger.log("startLoad("+f+")"),this.networkControllers.forEach(function(g){g.startLoad(f)})},v.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(f){f.stopLoad()})},v.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},v.recoverMediaError=function(){c.logger.log("recoverMediaError");var f=this._media;this.detachMedia(),f&&this.attachMedia(f)},v.removeLevel=function(f,g){g===void 0&&(g=0),this.levelController.removeLevel(f,g)},l=s,o=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return u.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:T.hlsDefaultConfig},set:function(f){s.defaultConfig=f}}],(n=[{key:"levels",get:function(){var f=this.levelController.levels;return f||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(f){c.logger.log("set currentLevel:"+f),this.loadLevel=f,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(f){c.logger.log("set nextLevel:"+f),this.levelController.manualLevel=f,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(f){c.logger.log("set loadLevel:"+f),this.levelController.manualLevel=f}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(f){this.levelController.nextLoadLevel=f}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(f){c.logger.log("set firstLevel:"+f),this.levelController.firstLevel=f}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(f){c.logger.log("set startLevel:"+f),f!==-1&&(f=Math.max(f,this.minAutoLevel)),this.levelController.startLevel=f}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(f){var g=!!f;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(f){this._autoLevelCapping!==f&&(c.logger.log("set autoLevelCapping:"+f),this._autoLevelCapping=f)}},{key:"bandwidthEstimate",get:function(){var f=this.abrController.bwEstimator;return f?f.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var f=this.levels,g=this.config.minAutoBitrate;if(!f)return 0;for(var r=f.length,i=0;i<r;i++)if(f[i].maxBitrate>g)return i;return 0}},{key:"maxAutoLevel",get:function(){var f=this.levels,g=this.autoLevelCapping;return g===-1&&f&&f.length?f.length-1:g}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(f){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,f)}},{key:"audioTracks",get:function(){var f=this.audioTrackController;return f?f.audioTracks:[]}},{key:"audioTrack",get:function(){var f=this.audioTrackController;return f?f.audioTrack:-1},set:function(f){var g=this.audioTrackController;g&&(g.audioTrack=f)}},{key:"subtitleTracks",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTrack:-1},set:function(f){var g=this.subtitleTrackController;g&&(g.subtitleTrack=f)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var f=this.subtitleTrackController;return!!f&&f.subtitleDisplay},set:function(f){var g=this.subtitleTrackController;g&&(g.subtitleDisplay=f)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(f){this.config.lowLatencyMode=f}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&a(l.prototype,n),o&&a(l,o),s}();e.defaultConfig=void 0},"./src/is-supported.ts":function(N,w,h){h.r(w),h.d(w,"isSupported",function(){return D}),h.d(w,"changeTypeSupported",function(){return R});var _=h("./src/utils/mediasource-helper.ts");function S(){return self.SourceBuffer||self.WebKitSourceBuffer}function D(){var C=Object(_.getMediaSource)();if(!C)return!1;var m=S(),p=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!m||m.prototype&&typeof m.prototype.appendBuffer=="function"&&typeof m.prototype.remove=="function";return!!p&&!!A}function R(){var C,m=S();return typeof(m==null||(C=m.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return y}),h.d(w,"LoadError",function(){return T});var _=h("./src/polyfills/number.ts"),S=h("./src/errors.ts");function D(E){var u=typeof Map=="function"?new Map:void 0;return(D=function(t){if(t===null||(a=t,Function.toString.call(a).indexOf("[native code]")===-1))return t;var a;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(t))return u.get(t);u.set(t,e)}function e(){return R(t,arguments,p(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),m(e,t)})(E)}function R(E,u,t){return(R=C()?Reflect.construct:function(a,e,s){var l=[null];l.push.apply(l,e);var n=new(Function.bind.apply(a,l));return s&&m(n,s.prototype),n}).apply(null,arguments)}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function m(E,u){return(m=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t})(E,u)}function p(E){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(E)}var A=Math.pow(2,17),y=function(){function E(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var u=E.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(t,a){var e=this,s=t.url;if(!s)return Promise.reject(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var l=this.config,n=l.fLoader,o=l.loader;return new Promise(function(v,f){e.loader&&e.loader.destroy();var g=e.loader=t.loader=n?new n(l):new o(l),r=c(t),i={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:A};t.stats=g.stats,g.load(r,i,{onSuccess:function(d,b,L,k){e.resetLoader(t,g),v({frag:t,part:null,payload:d.data,networkDetails:k})},onError:function(d,b,L){e.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:d,networkDetails:L}))},onAbort:function(d,b,L){e.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:L}))},onTimeout:function(d,b,L){e.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:L}))},onProgress:function(d,b,L,k){a&&a({frag:t,part:null,payload:L,networkDetails:k})}})})},u.loadPart=function(t,a,e){var s=this;this.abort();var l=this.config,n=l.fLoader,o=l.loader;return new Promise(function(v,f){s.loader&&s.loader.destroy();var g=s.loader=t.loader=n?new n(l):new o(l),r=c(t,a),i={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:A};a.stats=g.stats,g.load(r,i,{onSuccess:function(d,b,L,k){s.resetLoader(t,g),s.updateStatsFromPart(t,a);var I={frag:t,part:a,payload:d.data,networkDetails:k};e(I),v(I)},onError:function(d,b,L){s.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:a,response:d,networkDetails:L}))},onAbort:function(d,b,L){t.stats.aborted=a.stats.aborted,s.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:a,networkDetails:L}))},onTimeout:function(d,b,L){s.resetLoader(t,g),f(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:a,networkDetails:L}))}})})},u.updateStatsFromPart=function(t,a){var e=t.stats,s=a.stats,l=s.total;if(e.loaded+=s.loaded,l){var n=Math.round(t.duration/a.duration),o=Math.min(Math.round(e.loaded/l),n),v=(n-o)*Math.round(e.loaded/o);e.total=e.loaded+v}else e.total=Math.max(e.loaded,e.total);var f=e.loading,g=s.loading;f.start?f.first+=g.first-g.start:(f.start=g.start,f.first=g.first),f.end=g.end},u.resetLoader=function(t,a){t.loader=null,this.loader===a&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),a.destroy()},E}();function c(E,u){u===void 0&&(u=null);var t=u||E,a={frag:E,part:u,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},e=t.byteRangeStartOffset,s=t.byteRangeEndOffset;return Object(_.isFiniteNumber)(e)&&Object(_.isFiniteNumber)(s)&&(a.rangeStart=e,a.rangeEnd=s),a}var T=function(E){var u,t;function a(e){for(var s,l=arguments.length,n=new Array(l>1?l-1:0),o=1;o<l;o++)n[o-1]=arguments[o];return(s=E.call.apply(E,[this].concat(n))||this).data=void 0,s.data=e,s}return t=E,(u=a).prototype=Object.create(t.prototype),u.prototype.constructor=u,m(u,t),a}(D(Error))},"./src/loader/fragment.ts":function(N,w,h){h.r(w),h.d(w,"ElementaryStreamTypes",function(){return _}),h.d(w,"BaseSegment",function(){return E}),h.d(w,"Fragment",function(){return u}),h.d(w,"Part",function(){return t});var _,S,D=h("./src/polyfills/number.ts"),R=h("./node_modules/url-toolkit/src/url-toolkit.js"),C=h("./src/utils/logger.ts"),m=h("./src/loader/level-key.ts"),p=h("./src/loader/load-stats.ts");function A(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,y(a,e)}function y(a,e){return(y=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s})(a,e)}function c(a,e){for(var s=0;s<e.length;s++){var l=e[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(a,l.key,l)}}function T(a,e,s){return e&&c(a.prototype,e),s&&c(a,s),a}(S=_||(_={})).AUDIO="audio",S.VIDEO="video",S.AUDIOVIDEO="audiovideo";var E=function(){function a(e){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((s={})[_.AUDIO]=null,s[_.VIDEO]=null,s[_.AUDIOVIDEO]=null,s),this.baseurl=e}return a.prototype.setByteRange=function(e,s){var l=e.split("@",2),n=[];l.length===1?n[0]=s?s.byteRangeEndOffset:0:n[0]=parseInt(l[1]),n[1]=parseInt(l[0])+n[0],this._byteRange=n},T(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),a}(),u=function(a){function e(l,n){var o;return(o=a.call(this,n)||this)._decryptdata=null,o.rawProgramDateTime=null,o.programDateTime=null,o.tagList=[],o.duration=0,o.sn=0,o.levelkey=void 0,o.type=void 0,o.loader=null,o.level=-1,o.cc=0,o.startPTS=void 0,o.endPTS=void 0,o.appendedPTS=void 0,o.startDTS=void 0,o.endDTS=void 0,o.start=0,o.deltaPTS=void 0,o.maxStartPTS=void 0,o.minEndPTS=void 0,o.stats=new p.LoadStats,o.urlId=0,o.data=void 0,o.bitrateTest=!1,o.title=null,o.initSegment=null,o.type=l,o}A(e,a);var s=e.prototype;return s.createInitializationVector=function(l){for(var n=new Uint8Array(16),o=12;o<16;o++)n[o]=l>>8*(15-o)&255;return n},s.setDecryptDataFromLevelKey=function(l,n){var o=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&((o=m.LevelKey.fromURI(l.uri)).method=l.method,o.iv=this.createInitializationVector(n),o.keyFormat="identity"),o},s.setElementaryStreamInfo=function(l,n,o,v,f,g){g===void 0&&(g=!1);var r=this.elementaryStreams,i=r[l];i?(i.startPTS=Math.min(i.startPTS,n),i.endPTS=Math.max(i.endPTS,o),i.startDTS=Math.min(i.startDTS,v),i.endDTS=Math.max(i.endDTS,f)):r[l]={startPTS:n,endPTS:o,startDTS:v,endDTS:f,partial:g}},s.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[_.AUDIO]=null,l[_.VIDEO]=null,l[_.AUDIOVIDEO]=null},T(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&C.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(D.isFiniteNumber)(this.programDateTime))return null;var l=Object(D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*l}},{key:"encrypted",get:function(){var l;return!((l=this.decryptdata)===null||l===void 0||!l.keyFormat||!this.decryptdata.uri)}}]),e}(E),t=function(a){function e(s,l,n,o,v){var f;(f=a.call(this,n)||this).fragOffset=0,f.duration=0,f.gap=!1,f.independent=!1,f.relurl=void 0,f.fragment=void 0,f.index=void 0,f.stats=new p.LoadStats,f.duration=s.decimalFloatingPoint("DURATION"),f.gap=s.bool("GAP"),f.independent=s.bool("INDEPENDENT"),f.relurl=s.enumeratedString("URI"),f.fragment=l,f.index=o;var g=s.enumeratedString("BYTERANGE");return g&&f.setByteRange(g,v),v&&(f.fragOffset=v.fragOffset+v.duration),f}return A(e,a),T(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),e}(E)},"./src/loader/key-loader.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return R});var _=h("./src/events.ts"),S=h("./src/errors.ts"),D=h("./src/utils/logger.ts"),R=function(){function C(p){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=p,this._registerListeners()}var m=C.prototype;return m._registerListeners=function(){this.hls.on(_.Events.KEY_LOADING,this.onKeyLoading,this)},m._unregisterListeners=function(){this.hls.off(_.Events.KEY_LOADING,this.onKeyLoading)},m.destroy=function(){for(var p in this._unregisterListeners(),this.loaders){var A=this.loaders[p];A&&A.destroy()}this.loaders={}},m.onKeyLoading=function(p,A){var y=A.frag,c=y.type,T=this.loaders[c];if(y.decryptdata){var E=y.decryptdata.uri;if(E!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(T&&(D.logger.warn("abort previous key loader for type:"+c),T.abort()),!E)return void D.logger.warn("key uri is falsy");var t=u.loader,a=y.loader=this.loaders[c]=new t(u);this.decrypturl=E,this.decryptkey=null;var e={url:E,frag:y,responseType:"arraybuffer"},s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(e,s,l)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(_.Events.KEY_LOADED,{frag:y}))}else D.logger.warn("Missing decryption data on fragment in onKeyLoading")},m.loadsuccess=function(p,A,y){var c=y.frag;c.decryptdata?(this.decryptkey=c.decryptdata.key=new Uint8Array(p.data),c.loader=null,delete this.loaders[c.type],this.hls.trigger(_.Events.KEY_LOADED,{frag:c})):D.logger.error("after key load, decryptdata unset")},m.loaderror=function(p,A){var y=A.frag,c=y.loader;c&&c.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:p})},m.loadtimeout=function(p,A){var y=A.frag,c=y.loader;c&&c.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},C}()},"./src/loader/level-details.ts":function(N,w,h){h.r(w),h.d(w,"LevelDetails",function(){return D});var _=h("./src/polyfills/number.ts");function S(R,C){for(var m=0;m<C.length;m++){var p=C[m];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(R,p.key,p)}}var D=function(){function R(p){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=p}var C,m;return R.prototype.reloaded=function(p){if(!p)return this.advanced=!0,void(this.updated=!0);var A=this.lastPartSn-p.lastPartSn,y=this.lastPartIndex-p.lastPartIndex;this.updated=this.endSN!==p.endSN||!!y||!!A,this.advanced=this.endSN>p.endSN||A>0||A===0&&y>0,this.updated||this.advanced?this.misses=Math.floor(.6*p.misses):this.misses=p.misses+1,this.availabilityDelay=p.availabilityDelay},C=R,(m=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(_.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var p=this.driftEndTime-this.driftStartTime;return p>0?1e3*(this.driftEnd-this.driftStart)/p:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var p;return(p=this.fragments)!==null&&p!==void 0&&p.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&S(C.prototype,m),R}()},"./src/loader/level-key.ts":function(N,w,h){h.r(w),h.d(w,"LevelKey",function(){return D});var _=h("./node_modules/url-toolkit/src/url-toolkit.js");function S(R,C){for(var m=0;m<C.length;m++){var p=C[m];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(R,p.key,p)}}var D=function(){function R(p,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=A?Object(_.buildAbsoluteURL)(p,A,{alwaysNormalize:!0}):p}var C,m;return R.fromURL=function(p,A){return new R(p,A)},R.fromURI=function(p){return new R(p)},C=R,(m=[{key:"uri",get:function(){return this._uri}}])&&S(C.prototype,m),R}()},"./src/loader/load-stats.ts":function(N,w,h){h.r(w),h.d(w,"LoadStats",function(){return _});var _=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return t});var _=h("./src/polyfills/number.ts"),S=h("./node_modules/url-toolkit/src/url-toolkit.js"),D=h("./src/loader/fragment.ts"),R=h("./src/loader/level-details.ts"),C=h("./src/loader/level-key.ts"),m=h("./src/utils/attr-list.ts"),p=h("./src/utils/logger.ts"),A=h("./src/utils/codecs.ts"),y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,c=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),E=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,t=function(){function l(){}return l.findGroup=function(n,o){for(var v=0;v<n.length;v++){var f=n[v];if(f.id===o)return f}},l.convertAVC1ToAVCOTI=function(n){var o=n.split(".");if(o.length>2){var v=o.shift()+".";return v+=parseInt(o.shift()).toString(16),v+=("000"+parseInt(o.shift()).toString(16)).substr(-4)}return n},l.resolve=function(n,o){return S.buildAbsoluteURL(o,n,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(n,o){var v,f=[],g={},r=!1;for(y.lastIndex=0;(v=y.exec(n))!=null;)if(v[1]){var i=new m.AttrList(v[1]),d={attrs:i,bitrate:i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),name:i.NAME,url:l.resolve(v[2],o)},b=i.decimalResolution("RESOLUTION");b&&(d.width=b.width,d.height=b.height),a((i.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),d),d.videoCodec&&d.videoCodec.indexOf("avc1")!==-1&&(d.videoCodec=l.convertAVC1ToAVCOTI(d.videoCodec)),f.push(d)}else if(v[3]){var L=new m.AttrList(v[3]);L["DATA-ID"]&&(r=!0,g[L["DATA-ID"]]=L)}return{levels:f,sessionData:r?g:null}},l.parseMasterPlaylistMedia=function(n,o,v,f){var g;f===void 0&&(f=[]);var r=[],i=0;for(c.lastIndex=0;(g=c.exec(n))!==null;){var d=new m.AttrList(g[1]);if(d.TYPE===v){var b={attrs:d,bitrate:0,id:i++,groupId:d["GROUP-ID"],instreamId:d["INSTREAM-ID"],name:d.NAME||d.LANGUAGE||"",type:v,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:d.LANGUAGE,url:d.URI?l.resolve(d.URI,o):""};if(f.length){var L=l.findGroup(f,b.groupId)||f[0];e(b,L,"audioCodec"),e(b,L,"textCodec")}r.push(b)}}return r},l.parseLevelPlaylist=function(n,o,v,f,g){var r,i,d,b=new R.LevelDetails(o),L=b.fragments,k=null,I=0,O=0,x=0,P=0,F=null,M=new D.Fragment(f,o),B=-1,U=!1;for(T.lastIndex=0,b.m3u8=n;(r=T.exec(n))!==null;){U&&(U=!1,(M=new D.Fragment(f,o)).start=x,M.sn=I,M.cc=P,M.level=v,k&&(M.initSegment=k,M.rawProgramDateTime=k.rawProgramDateTime));var G=r[1];if(G){M.duration=parseFloat(G);var K=(" "+r[2]).slice(1);M.title=K||null,M.tagList.push(K?["INF",G,K]:["INF",G])}else if(r[3])Object(_.isFiniteNumber)(M.duration)&&(M.start=x,d&&(M.levelkey=d),M.sn=I,M.level=v,M.cc=P,M.urlId=g,L.push(M),M.relurl=(" "+r[3]).slice(1),s(M,F),F=M,x+=M.duration,I++,O=0,U=!0);else if(r[4]){var H=(" "+r[4]).slice(1);F?M.setByteRange(H,F):M.setByteRange(H)}else if(r[5])M.rawProgramDateTime=(" "+r[5]).slice(1),M.tagList.push(["PROGRAM-DATE-TIME",M.rawProgramDateTime]),B===-1&&(B=L.length);else{if(!(r=r[0].match(E))){p.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<r.length&&r[i]===void 0;i++);var Y=(" "+r[i]).slice(1),W=(" "+r[i+1]).slice(1),q=r[i+2]?(" "+r[i+2]).slice(1):"";switch(Y){case"PLAYLIST-TYPE":b.type=W.toUpperCase();break;case"MEDIA-SEQUENCE":I=b.startSN=parseInt(W);break;case"SKIP":var Q=new m.AttrList(W),tt=Q.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.isFiniteNumber)(tt)){b.skippedSegments=tt;for(var rt=tt;rt--;)L.unshift(null);I+=tt}var z=Q.enumeratedString("RECENTLY-REMOVED-DATERANGES");z&&(b.recentlyRemovedDateranges=z.split("	"));break;case"TARGETDURATION":b.targetduration=parseFloat(W);break;case"VERSION":b.version=parseInt(W);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"#":(W||q)&&M.tagList.push(q?[W,q]:[W]);break;case"DIS":P++;case"GAP":M.tagList.push([Y]);break;case"BITRATE":M.tagList.push([Y,W]);break;case"DISCONTINUITY-SEQ":P=parseInt(W);break;case"KEY":var at,X=new m.AttrList(W),J=X.enumeratedString("METHOD"),nt=X.URI,it=X.hexadecimalInteger("IV"),dt=X.enumeratedString("KEYFORMATVERSIONS"),gt=X.enumeratedString("KEYID"),vt=(at=X.enumeratedString("KEYFORMAT"))!=null?at:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(vt)>-1){p.logger.warn("Keyformat "+vt+" is not supported from the manifest");continue}if(vt!=="identity")continue;J&&(d=C.LevelKey.fromURL(o,nt),nt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(J)>=0&&(d.method=J,d.keyFormat=vt,gt&&(d.keyID=gt),dt&&(d.keyFormatVersions=dt),d.iv=it));break;case"START":var mt=new m.AttrList(W).decimalFloatingPoint("TIME-OFFSET");Object(_.isFiniteNumber)(mt)&&(b.startTimeOffset=mt);break;case"MAP":var lt=new m.AttrList(W);M.relurl=lt.URI,lt.BYTERANGE&&M.setByteRange(lt.BYTERANGE),M.level=v,M.sn="initSegment",d&&(M.levelkey=d),M.initSegment=null,k=M,U=!0;break;case"SERVER-CONTROL":var ot=new m.AttrList(W);b.canBlockReload=ot.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=ot.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&ot.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=ot.optionalFloat("PART-HOLD-BACK",0),b.holdBack=ot.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Mt=new m.AttrList(W);b.partTarget=Mt.decimalFloatingPoint("PART-TARGET");break;case"PART":var yt=b.partList;yt||(yt=b.partList=[]);var Lt=O>0?yt[yt.length-1]:void 0,Nt=O++,kt=new D.Part(new m.AttrList(W),M,o,Nt,Lt);yt.push(kt),M.duration+=kt.duration;break;case"PRELOAD-HINT":var St=new m.AttrList(W);b.preloadHint=St;break;case"RENDITION-REPORT":var Kt=new m.AttrList(W);b.renditionReports=b.renditionReports||[],b.renditionReports.push(Kt);break;default:p.logger.warn("line parsed but not handled: "+r)}}}F&&!F.relurl?(L.pop(),x-=F.duration,b.partList&&(b.fragmentHint=F)):b.partList&&(s(M,F),M.cc=P,b.fragmentHint=M);var Bt=L.length,bt=L[0],Vt=L[Bt-1];if((x+=b.skippedSegments*b.targetduration)>0&&Bt&&Vt){b.averagetargetduration=x/Bt;var Ut=Vt.sn;b.endSN=Ut!=="initSegment"?Ut:0,bt&&(b.startCC=bt.cc,bt.initSegment||b.fragments.every(function(Rt){return Rt.relurl&&(At=Rt.relurl,u.test((_t=(Et=S.parseURL(At))===null||Et===void 0?void 0:Et.path)!=null?_t:""));var At,_t,Et})&&(p.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(M=new D.Fragment(f,o)).relurl=Vt.relurl,M.level=v,M.sn="initSegment",bt.initSegment=M,b.needSidxRanges=!0))}else b.endSN=0,b.startCC=0;return b.fragmentHint&&(x+=b.fragmentHint.duration),b.totalduration=x,b.endCC=P,B>0&&function(Rt,At){for(var _t=Rt[At],Et=At;Et--;){var It=Rt[Et];if(!It)return;It.programDateTime=_t.programDateTime-1e3*It.duration,_t=It}}(L,B),b},l}();function a(l,n){["video","audio","text"].forEach(function(o){var v=l.filter(function(g){return Object(A.isCodecType)(g,o)});if(v.length){var f=v.filter(function(g){return g.lastIndexOf("avc1",0)===0||g.lastIndexOf("mp4a",0)===0});n[o+"Codec"]=f.length>0?f[0]:v[0],l=l.filter(function(g){return v.indexOf(g)===-1})}}),n.unknownCodecs=l}function e(l,n,o){var v=n[o];v&&(l[o]=v)}function s(l,n){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):n!=null&&n.programDateTime&&(l.programDateTime=n.endProgramDateTime),Object(_.isFiniteNumber)(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),S=h("./src/events.ts"),D=h("./src/errors.ts"),R=h("./src/utils/logger.ts"),C=h("./src/utils/mp4-tools.ts"),m=h("./src/loader/m3u8-parser.ts"),p=h("./src/types/loader.ts"),A=h("./src/utils/attr-list.ts");function y(T,E){var u=T.url;return u!==void 0&&u.indexOf("data:")!==0||(u=E.url),u}var c=function(){function T(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var E=T.prototype;return E.registerListeners=function(){var u=this.hls;u.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(S.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.unregisterListeners=function(){var u=this.hls;u.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(S.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.createInternalLoader=function(u){var t=this.hls.config,a=t.pLoader,e=t.loader,s=new(a||e)(t);return u.loader=s,this.loaders[u.type]=s,s},E.getInternalLoader=function(u){return this.loaders[u.type]},E.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},E.destroyInternalLoaders=function(){for(var u in this.loaders){var t=this.loaders[u];t&&t.destroy(),this.resetInternalLoader(u)}},E.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},E.onManifestLoading=function(u,t){var a=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:p.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},E.onLevelLoading=function(u,t){var a=t.id,e=t.level,s=t.url,l=t.deliveryDirectives;this.load({id:a,groupId:null,level:e,responseType:"text",type:p.PlaylistContextType.LEVEL,url:s,deliveryDirectives:l})},E.onAudioTrackLoading=function(u,t){var a=t.id,e=t.groupId,s=t.url,l=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:p.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:l})},E.onSubtitleTrackLoading=function(u,t){var a=t.id,e=t.groupId,s=t.url,l=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:p.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:l})},E.load=function(u){var t,a,e,s,l,n,o=this.hls.config,v=this.getInternalLoader(u);if(v){var f=v.context;if(f&&f.url===u.url)return void R.logger.trace("[playlist-loader]: playlist request ongoing");R.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),v.abort()}switch(u.type){case p.PlaylistContextType.MANIFEST:a=o.manifestLoadingMaxRetry,e=o.manifestLoadingTimeOut,s=o.manifestLoadingRetryDelay,l=o.manifestLoadingMaxRetryTimeout;break;case p.PlaylistContextType.LEVEL:case p.PlaylistContextType.AUDIO_TRACK:case p.PlaylistContextType.SUBTITLE_TRACK:a=0,e=o.levelLoadingTimeOut;break;default:a=o.levelLoadingMaxRetry,e=o.levelLoadingTimeOut,s=o.levelLoadingRetryDelay,l=o.levelLoadingMaxRetryTimeout}if(v=this.createInternalLoader(u),(t=u.deliveryDirectives)!==null&&t!==void 0&&t.part&&(u.type===p.PlaylistContextType.LEVEL&&u.level!==null?n=this.hls.levels[u.level].details:u.type===p.PlaylistContextType.AUDIO_TRACK&&u.id!==null?n=this.hls.audioTracks[u.id].details:u.type===p.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(n=this.hls.subtitleTracks[u.id].details),n)){var g=n.partTarget,r=n.targetduration;g&&r&&(e=Math.min(1e3*Math.max(3*g,.8*r),e))}var i={timeout:e,maxRetry:a,retryDelay:s,maxRetryDelay:l,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};v.load(u,i,d)},E.loadsuccess=function(u,t,a,e){if(e===void 0&&(e=null),a.isSidxRequest)return this.handleSidxRequest(u,a),void this.handlePlaylistLoaded(u,t,a,e);this.resetInternalLoader(a.type);var s=u.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,t,a,e):this.handleMasterPlaylist(u,t,a,e)):this.handleManifestParsingError(u,a,"no EXTM3U delimiter",e)},E.loaderror=function(u,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!1,u)},E.loadtimeout=function(u,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!0)},E.handleMasterPlaylist=function(u,t,a,e){var s=this.hls,l=u.data,n=y(u,a),o=m.default.parseMasterPlaylist(l,n),v=o.levels,f=o.sessionData;if(v.length){var g=v.map(function(L){return{id:L.attrs.AUDIO,audioCodec:L.audioCodec}}),r=v.map(function(L){return{id:L.attrs.SUBTITLES,textCodec:L.textCodec}}),i=m.default.parseMasterPlaylistMedia(l,n,"AUDIO",g),d=m.default.parseMasterPlaylistMedia(l,n,"SUBTITLES",r),b=m.default.parseMasterPlaylistMedia(l,n,"CLOSED-CAPTIONS");i.length&&(i.some(function(L){return!L.url})||!v[0].audioCodec||v[0].attrs.AUDIO||(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),i.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))),s.trigger(S.Events.MANIFEST_LOADED,{levels:v,audioTracks:i,subtitles:d,captions:b,url:n,stats:t,networkDetails:e,sessionData:f})}else this.handleManifestParsingError(u,a,"no level found in manifest",e)},E.handleTrackOrLevelPlaylist=function(u,t,a,e){var s=this.hls,l=a.id,n=a.level,o=a.type,v=y(u,a),f=Object(_.isFiniteNumber)(l)?l:0,g=Object(_.isFiniteNumber)(n)?n:f,r=function(k){switch(k.type){case p.PlaylistContextType.AUDIO_TRACK:return p.PlaylistLevelType.AUDIO;case p.PlaylistContextType.SUBTITLE_TRACK:return p.PlaylistLevelType.SUBTITLE;default:return p.PlaylistLevelType.MAIN}}(a),i=m.default.parseLevelPlaylist(u.data,v,g,r,f);if(i.fragments.length){if(o===p.PlaylistContextType.MANIFEST){var d={attrs:new A.AttrList({}),bitrate:0,details:i,name:"",url:v};s.trigger(S.Events.MANIFEST_LOADED,{levels:[d],audioTracks:[],url:v,stats:t,networkDetails:e,sessionData:null})}if(t.parsing.end=performance.now(),i.needSidxRanges){var b,L=(b=i.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:L,isSidxRequest:!0,type:o,level:n,levelDetails:i,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else a.levelDetails=i,this.handlePlaylistLoaded(u,t,a,e)}else s.trigger(S.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0})},E.handleSidxRequest=function(u,t){var a=Object(C.parseSegmentIndex)(new Uint8Array(u.data));if(a){var e=a.references,s=t.levelDetails;e.forEach(function(l,n){var o=l.info,v=s.fragments[n];v.byteRange.length===0&&v.setByteRange(String(1+o.end-o.start)+"@"+String(o.start)),v.initSegment&&v.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},E.handleManifestParsingError=function(u,t,a,e){this.hls.trigger(S.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===p.PlaylistContextType.MANIFEST,url:u.url,reason:a,response:u,context:t,networkDetails:e})},E.handleNetworkError=function(u,t,a,e){a===void 0&&(a=!1),R.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var s=D.ErrorDetails.UNKNOWN,l=!1,n=this.getInternalLoader(u);switch(u.type){case p.PlaylistContextType.MANIFEST:s=a?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case p.PlaylistContextType.LEVEL:s=a?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case p.PlaylistContextType.AUDIO_TRACK:s=a?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case p.PlaylistContextType.SUBTITLE_TRACK:s=a?D.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:D.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}n&&this.resetInternalLoader(u.type);var o={type:D.ErrorTypes.NETWORK_ERROR,details:s,fatal:l,url:u.url,loader:n,context:u,networkDetails:t};e&&(o.response=e),this.hls.trigger(S.Events.ERROR,o)},E.handlePlaylistLoaded=function(u,t,a,e){var s=a.type,l=a.level,n=a.id,o=a.groupId,v=a.loader,f=a.levelDetails,g=a.deliveryDirectives;if(f!=null&&f.targetduration){if(v)switch(f.live&&(v.getCacheAge&&(f.ageHeader=v.getCacheAge()||0),v.getCacheAge&&!isNaN(f.ageHeader)||(f.ageHeader=0)),s){case p.PlaylistContextType.MANIFEST:case p.PlaylistContextType.LEVEL:this.hls.trigger(S.Events.LEVEL_LOADED,{details:f,level:l||0,id:n||0,stats:t,networkDetails:e,deliveryDirectives:g});break;case p.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(S.Events.AUDIO_TRACK_LOADED,{details:f,id:n||0,groupId:o||"",stats:t,networkDetails:e,deliveryDirectives:g});break;case p.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(S.Events.SUBTITLE_TRACK_LOADED,{details:f,id:n||0,groupId:o||"",stats:t,networkDetails:e,deliveryDirectives:g})}}else this.handleManifestParsingError(u,a,"invalid target duration",e)},T}();w.default=c},"./src/polyfills/number.ts":function(N,w,h){h.r(w),h.d(w,"isFiniteNumber",function(){return _}),h.d(w,"MAX_SAFE_INTEGER",function(){return S});var _=Number.isFinite||function(D){return typeof D=="number"&&isFinite(D)},S=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(N,w,h){h.r(w);var _=function(){function S(){}return S.getSilentFrame=function(D,R){switch(D){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},S}();w.default=_},"./src/remux/mp4-generator.ts":function(N,w,h){h.r(w);var _=Math.pow(2,32)-1,S=function(){function D(){}return D.init=function(){var R;for(R in D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},D.types)D.types.hasOwnProperty(R)&&(D.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),m=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:C,audio:m};var p=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=A,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,y,T,y,c),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,p))},D.box=function(R){for(var C=8,m=arguments.length,p=new Array(m>1?m-1:0),A=1;A<m;A++)p[A-1]=arguments[A];for(var y=p.length,c=y;y--;)C+=p[y].byteLength;var T=new Uint8Array(C);for(T[0]=C>>24&255,T[1]=C>>16&255,T[2]=C>>8&255,T[3]=255&C,T.set(R,4),y=0,C=8;y<c;y++)T.set(p[y],C),C+=p[y].byteLength;return T},D.hdlr=function(R){return D.box(D.types.hdlr,D.HDLR_TYPES[R])},D.mdat=function(R){return D.box(D.types.mdat,R)},D.mdhd=function(R,C){C*=R;var m=Math.floor(C/(_+1)),p=Math.floor(C%(_+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,m>>24,m>>16&255,m>>8&255,255&m,p>>24,p>>16&255,p>>8&255,255&p,85,196,0,0]))},D.mdia=function(R){return D.box(D.types.mdia,D.mdhd(R.timescale,R.duration),D.hdlr(R.type),D.minf(R))},D.mfhd=function(R){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},D.minf=function(R){return R.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(R)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(R))},D.moof=function(R,C,m){return D.box(D.types.moof,D.mfhd(R),D.traf(m,C))},D.moov=function(R){for(var C=R.length,m=[];C--;)m[C]=D.trak(R[C]);return D.box.apply(null,[D.types.moov,D.mvhd(R[0].timescale,R[0].duration)].concat(m).concat(D.mvex(R)))},D.mvex=function(R){for(var C=R.length,m=[];C--;)m[C]=D.trex(R[C]);return D.box.apply(null,[D.types.mvex].concat(m))},D.mvhd=function(R,C){C*=R;var m=Math.floor(C/(_+1)),p=Math.floor(C%(_+1)),A=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,m>>24,m>>16&255,m>>8&255,255&m,p>>24,p>>16&255,p>>8&255,255&p,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,A)},D.sdtp=function(R){var C,m,p=R.samples||[],A=new Uint8Array(4+p.length);for(C=0;C<p.length;C++)m=p[C].flags,A[C+4]=m.dependsOn<<4|m.isDependedOn<<2|m.hasRedundancy;return D.box(D.types.sdtp,A)},D.stbl=function(R){return D.box(D.types.stbl,D.stsd(R),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(R){var C,m,p,A=[],y=[];for(C=0;C<R.sps.length;C++)p=(m=R.sps[C]).byteLength,A.push(p>>>8&255),A.push(255&p),A=A.concat(Array.prototype.slice.call(m));for(C=0;C<R.pps.length;C++)p=(m=R.pps[C]).byteLength,y.push(p>>>8&255),y.push(255&p),y=y.concat(Array.prototype.slice.call(m));var c=D.box(D.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|R.sps.length].concat(A).concat([R.pps.length]).concat(y))),T=R.width,E=R.height,u=R.pixelRatio[0],t=R.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,255&T,E>>8&255,255&E,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,t>>24,t>>16&255,t>>8&255,255&t])))},D.esds=function(R){var C=R.config.length;return new Uint8Array([0,0,0,0,3,23+C,0,1,0,4,15+C,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([C]).concat(R.config).concat([6,1,2]))},D.mp4a=function(R){var C=R.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]),D.box(D.types.esds,D.esds(R)))},D.mp3=function(R){var C=R.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]))},D.stsd=function(R){return R.type==="audio"?R.isAAC||R.codec!=="mp3"?D.box(D.types.stsd,D.STSD,D.mp4a(R)):D.box(D.types.stsd,D.STSD,D.mp3(R)):D.box(D.types.stsd,D.STSD,D.avc1(R))},D.tkhd=function(R){var C=R.id,m=R.duration*R.timescale,p=R.width,A=R.height,y=Math.floor(m/(_+1)),c=Math.floor(m%(_+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,0,0,0,0,y>>24,y>>16&255,y>>8&255,255&y,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,p>>8&255,255&p,0,0,A>>8&255,255&A,0,0]))},D.traf=function(R,C){var m=D.sdtp(R),p=R.id,A=Math.floor(C/(_+1)),y=Math.floor(C%(_+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,p>>24,p>>16&255,p>>8&255,255&p])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,y>>24,y>>16&255,y>>8&255,255&y])),D.trun(R,m.length+16+20+8+16+8+8),m)},D.trak=function(R){return R.duration=R.duration||4294967295,D.box(D.types.trak,D.tkhd(R),D.mdia(R))},D.trex=function(R){var C=R.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(R,C){var m,p,A,y,c,T,E=R.samples||[],u=E.length,t=12+16*u,a=new Uint8Array(t);for(C+=8+t,a.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,C>>>24&255,C>>>16&255,C>>>8&255,255&C],0),m=0;m<u;m++)A=(p=E[m]).duration,y=p.size,c=p.flags,T=p.cts,a.set([A>>>24&255,A>>>16&255,A>>>8&255,255&A,y>>>24&255,y>>>16&255,y>>>8&255,255&y,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,T>>>24&255,T>>>16&255,T>>>8&255,255&T],12+16*m);return D.box(D.types.trun,a)},D.initSegment=function(R){D.types||D.init();var C=D.moov(R),m=new Uint8Array(D.FTYP.byteLength+C.byteLength);return m.set(D.FTYP),m.set(C,D.FTYP.byteLength),m},D}();S.types=void 0,S.HDLR_TYPES=void 0,S.STTS=void 0,S.STSC=void 0,S.STCO=void 0,S.STSZ=void 0,S.VMHD=void 0,S.SMHD=void 0,S.STSD=void 0,S.FTYP=void 0,S.DINF=void 0,w.default=S},"./src/remux/mp4-remuxer.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return u}),h.d(w,"normalizePts",function(){return t});var _=h("./src/polyfills/number.ts"),S=h("./src/remux/aac-helper.ts"),D=h("./src/remux/mp4-generator.ts"),R=h("./src/events.ts"),C=h("./src/errors.ts"),m=h("./src/utils/logger.ts"),p=h("./src/types/loader.ts"),A=h("./src/utils/timescale-conversion.ts");function y(){return(y=Object.assign||function(s){for(var l=1;l<arguments.length;l++){var n=arguments[l];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s[o]=n[o])}return s}).apply(this,arguments)}var c=null,T=null,E=!1,u=function(){function s(n,o,v,f){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=o,this.typeSupported=v,this.ISGenerated=!1,c===null){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);c=g?parseInt(g[1]):0}if(T===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);T=r?parseInt(r[1]):0}E=!!c&&c<75||!!T&&T<600}var l=s.prototype;return l.destroy=function(){},l.resetTimeStamp=function(n){m.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},l.resetNextTimestamp=function(){m.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},l.resetInitSegment=function(){m.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},l.getVideoStartPts=function(n){var o=!1,v=n.reduce(function(f,g){var r=g.pts-f;return r<-4294967296?(o=!0,t(f,g.pts)):r>0?f:g.pts},n[0].pts);return o&&m.logger.debug("PTS rollover detected"),v},l.remux=function(n,o,v,f,g,r,i,d){var b,L,k,I,O,x,P=g,F=g,M=n.pid>-1,B=o.pid>-1,U=o.samples.length,G=n.samples.length>0,K=U>1;if((!M||G)&&(!B||K)||this.ISGenerated||i){this.ISGenerated||(k=this.generateIS(n,o,g));var H=this.isVideoContiguous,Y=-1;if(K&&(Y=function(rt){for(var z=0;z<rt.length;z++)if(rt[z].key)return z;return-1}(o.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,Y>0){m.logger.warn("[mp4-remuxer]: Dropped "+Y+" out of "+U+" video samples due to a missing keyframe");var W=this.getVideoStartPts(o.samples);o.samples=o.samples.slice(Y),o.dropped+=Y,F+=(o.samples[0].pts-W)/(o.timescale||9e4)}else Y===-1&&(m.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),x=!1);if(this.ISGenerated){if(G&&K){var q=this.getVideoStartPts(o.samples),Q=(t(n.samples[0].pts,q)-q)/o.inputTimeScale;P+=Math.max(0,Q),F+=Math.max(0,-Q)}if(G){if(n.samplerate||(m.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),k=this.generateIS(n,o,g)),L=this.remuxAudio(n,P,this.isAudioContiguous,r,B||K||d===p.PlaylistLevelType.AUDIO?F:void 0),K){var tt=L?L.endPTS-L.startPTS:0;o.inputTimeScale||(m.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),k=this.generateIS(n,o,g)),b=this.remuxVideo(o,F,H,tt)}}else K&&(b=this.remuxVideo(o,F,H,0));b&&(b.firstKeyFrame=Y,b.independent=Y!==-1)}}return this.ISGenerated&&(v.samples.length&&(O=this.remuxID3(v,g)),f.samples.length&&(I=this.remuxText(f,g))),{audio:L,video:b,initSegment:k,independent:x,text:I,id3:O}},l.generateIS=function(n,o,v){var f,g,r,i=n.samples,d=o.samples,b=this.typeSupported,L={},k=!Object(_.isFiniteNumber)(this._initPTS),I="audio/mp4";if(k&&(f=g=1/0),n.config&&i.length&&(n.timescale=n.samplerate,n.isAAC||(b.mpeg?(I="audio/mpeg",n.codec=""):b.mp3&&(n.codec="mp3")),L.audio={id:"audio",container:I,codec:n.codec,initSegment:!n.isAAC&&b.mpeg?new Uint8Array(0):D.default.initSegment([n]),metadata:{channelCount:n.channelCount}},k&&(r=n.inputTimeScale,f=g=i[0].pts-Math.round(r*v))),o.sps&&o.pps&&d.length&&(o.timescale=o.inputTimeScale,L.video={id:"main",container:"video/mp4",codec:o.codec,initSegment:D.default.initSegment([o]),metadata:{width:o.width,height:o.height}},k)){r=o.inputTimeScale;var O=this.getVideoStartPts(d),x=Math.round(r*v);g=Math.min(g,t(d[0].dts,O)-x),f=Math.min(f,O-x)}if(Object.keys(L).length)return this.ISGenerated=!0,k&&(this._initPTS=f,this._initDTS=g),{tracks:L,initPTS:f,timescale:r}},l.remuxVideo=function(n,o,v,f){var g,r,i,d=n.inputTimeScale,b=n.samples,L=[],k=b.length,I=this._initPTS,O=this.nextAvcDts,x=8,P=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,M=0,B=!1;v&&O!==null||(O=o*d-(b[0].pts-t(b[0].dts,b[0].pts)));for(var U=0;U<k;U++){var G=b[U];G.pts=t(G.pts-I,O),G.dts=t(G.dts-I,O),G.dts>G.pts&&(M=Math.max(Math.min(M,G.pts-G.dts),-18e3)),G.dts<b[U>0?U-1:U].dts&&(B=!0)}B&&b.sort(function(Et,It){var me=Et.dts-It.dts,ye=Et.pts-It.pts;return me||ye}),r=b[0].dts,i=b[b.length-1].dts;var K=Math.round((i-r)/(k-1));if(M<0){if(M<-2*K){m.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(A.toMsFromMpegTsClock)(-K,!0)+" ms");for(var H=M,Y=0;Y<k;Y++)b[Y].dts=H=Math.max(H,b[Y].pts-K),b[Y].pts=Math.max(H,b[Y].pts)}else{m.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(A.toMsFromMpegTsClock)(M,!0)+" ms to overcome this issue");for(var W=0;W<k;W++)b[W].dts=b[W].dts+M}r=b[0].dts}if(v){var q=r-O,Q=q>K;if(Q||q<-1){Q?m.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(q,!0)+" ms ("+q+"dts) hole between fragments detected, filling it"):m.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(-q,!0)+" ms ("+q+"dts) overlapping between fragments detected"),r=O;var tt=b[0].pts-q;b[0].dts=r,b[0].pts=tt,m.logger.log("Video: First PTS/DTS adjusted: "+Object(A.toMsFromMpegTsClock)(tt,!0)+"/"+Object(A.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(A.toMsFromMpegTsClock)(q,!0)+" ms")}}E&&(r=Math.max(0,r));for(var rt=0,z=0,at=0;at<k;at++){for(var X=b[at],J=X.units,nt=J.length,it=0,dt=0;dt<nt;dt++)it+=J[dt].data.length;z+=it,rt+=nt,X.length=it,X.dts=Math.max(X.dts,r),X.pts=Math.max(X.pts,X.dts,0),P=Math.min(X.pts,P),F=Math.max(X.pts,F)}i=b[k-1].dts;var gt,vt=z+4*rt+8;try{gt=new Uint8Array(vt)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:vt,reason:"fail allocating video mdat "+vt})}var mt=new DataView(gt.buffer);mt.setUint32(0,vt),gt.set(D.default.types.mdat,4);for(var lt=0;lt<k;lt++){for(var ot=b[lt],Mt=ot.units,yt=0,Lt=0,Nt=Mt.length;Lt<Nt;Lt++){var kt=Mt[Lt],St=kt.data,Kt=kt.data.byteLength;mt.setUint32(x,Kt),x+=4,gt.set(St,x),x+=Kt,yt+=4+Kt}if(lt<k-1)g=b[lt+1].dts-ot.dts;else{var Bt=this.config,bt=ot.dts-b[lt>0?lt-1:lt].dts;if(Bt.stretchShortVideoTrack&&this.nextAudioPts!==null){var Vt=Math.floor(Bt.maxBufferHole*d),Ut=(f?P+f*d:this.nextAudioPts)-ot.pts;Ut>Vt?((g=Ut-bt)<0&&(g=bt),m.logger.log("[mp4-remuxer]: It is approximately "+Ut/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=bt}else g=bt}var Rt=Math.round(ot.pts-ot.dts);L.push(new a(ot.key,g,yt,Rt))}if(L.length&&c&&c<70){var At=L[0].flags;At.dependsOn=2,At.isNonSync=0}console.assert(g!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=O=i+g,this.isVideoContiguous=!0;var _t={data1:D.default.moof(n.sequenceNumber++,r,y({},n,{samples:L})),data2:gt,startPTS:P/d,endPTS:(F+g)/d,startDTS:r/d,endDTS:O/d,type:"video",hasAudio:!1,hasVideo:!0,nb:L.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(gt.length,"MDAT length must not be zero"),_t},l.remuxAudio=function(n,o,v,f,g){var r=n.inputTimeScale,i=r/(n.samplerate?n.samplerate:r),d=n.isAAC?1024:1152,b=d*i,L=this._initPTS,k=!n.isAAC&&this.typeSupported.mpeg,I=[],O=n.samples,x=k?0:8,P=this.nextAudioPts||-1,F=o*r;if(this.isAudioContiguous=v=v||O.length&&P>0&&(f&&Math.abs(F-P)<9e3||Math.abs(t(O[0].pts-L,F)-P)<20*b),O.forEach(function(St){St.pts=t(St.pts-L,F)}),!v||P<0){if(!(O=O.filter(function(St){return St.pts>=0})).length)return;P=g===0?0:f?Math.max(0,F):O[0].pts}if(n.isAAC)for(var M=g!==void 0,B=this.config.maxAudioFramesDrift,U=0,G=P;U<O.length;U++){var K=O[U],H=K.pts,Y=H-G,W=Math.abs(1e3*Y/r);if(Y<=-B*b&&M)U===0&&(m.logger.warn("Audio frame @ "+(H/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Y/r)+" ms."),this.nextAudioPts=P=G=H);else if(Y>=B*b&&W<1e4&&M){var q=Math.round(Y/b);(G=H-q*b)<0&&(q--,G+=b),U===0&&(this.nextAudioPts=P=G),m.logger.warn("[mp4-remuxer]: Injecting "+q+" audio frame @ "+(G/r).toFixed(3)+"s due to "+Math.round(1e3*Y/r)+" ms gap.");for(var Q=0;Q<q;Q++){var tt=Math.max(G,0),rt=S.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);rt||(m.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),rt=K.unit.subarray()),O.splice(U,0,{unit:rt,pts:tt}),G+=b,U++}}K.pts=G,G+=b}for(var z,at=null,X=null,J=0,nt=O.length;nt--;)J+=O[nt].unit.byteLength;for(var it=0,dt=O.length;it<dt;it++){var gt=O[it],vt=gt.unit,mt=gt.pts;if(X!==null)I[it-1].duration=Math.round((mt-X)/i);else{if(v&&n.isAAC&&(mt=P),at=mt,!(J>0))return;J+=x;try{z=new Uint8Array(J)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:J,reason:"fail allocating audio mdat "+J})}k||(new DataView(z.buffer).setUint32(0,J),z.set(D.default.types.mdat,4))}z.set(vt,x);var lt=vt.byteLength;x+=lt,I.push(new a(!0,d,lt,0)),X=mt}var ot=I.length;if(ot){var Mt=I[I.length-1];this.nextAudioPts=P=X+i*Mt.duration;var yt=k?new Uint8Array(0):D.default.moof(n.sequenceNumber++,at/i,y({},n,{samples:I}));n.samples=[];var Lt=at/r,Nt=P/r,kt={data1:yt,data2:z,startPTS:Lt,endPTS:Nt,startDTS:Lt,endDTS:Nt,type:"audio",hasAudio:!0,hasVideo:!1,nb:ot};return this.isAudioContiguous=!0,console.assert(z.length,"MDAT length must not be zero"),kt}},l.remuxEmptyAudio=function(n,o,v,f){var g=n.inputTimeScale,r=g/(n.samplerate?n.samplerate:g),i=this.nextAudioPts,d=(i!==null?i:f.startDTS*g)+this._initDTS,b=f.endDTS*g+this._initDTS,L=1024*r,k=Math.ceil((b-d)/L),I=S.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(m.logger.warn("[mp4-remuxer]: remux empty Audio"),I){for(var O=[],x=0;x<k;x++){var P=d+x*L;O.push({unit:I,pts:P,dts:P})}return n.samples=O,this.remuxAudio(n,o,v,!1)}m.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},l.remuxID3=function(n,o){var v=n.samples.length;if(v){for(var f=n.inputTimeScale,g=this._initPTS,r=this._initDTS,i=0;i<v;i++){var d=n.samples[i];d.pts=t(d.pts-g,o*f)/f,d.dts=t(d.dts-r,o*f)/f}var b=n.samples;return n.samples=[],{samples:b}}},l.remuxText=function(n,o){var v=n.samples.length;if(v){for(var f=n.inputTimeScale,g=this._initPTS,r=0;r<v;r++){var i=n.samples[r];i.pts=t(i.pts-g,o*f)/f}n.samples.sort(function(b,L){return b.pts-L.pts});var d=n.samples;return n.samples=[],{samples:d}}},s}();function t(s,l){var n;if(l===null)return s;for(n=l<s?-8589934592:8589934592;Math.abs(s-l)>4294967296;)s+=n;return s}var a=function(s,l,n,o){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=n,this.cts=o,this.flags=new e(s)},e=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),S=h("./src/utils/mp4-tools.ts"),D=h("./src/loader/fragment.ts"),R=h("./src/utils/logger.ts"),C=function(){function A(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=A.prototype;return y.destroy=function(){},y.resetTimeStamp=function(c){this.initPTS=c,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(c,T,E){this.audioCodec=T,this.videoCodec=E,this.generateInitSegment(c),this.emitInitSegment=!0},y.generateInitSegment=function(c){var T=this.audioCodec,E=this.videoCodec;if(!c||!c.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var u=this.initData=Object(S.parseInitSegment)(c);T||(T=p(u.audio,D.ElementaryStreamTypes.AUDIO)),E||(E=p(u.video,D.ElementaryStreamTypes.VIDEO));var t={};u.audio&&u.video?t.audiovideo={container:"video/mp4",codec:T+","+E,initSegment:c,id:"main"}:u.audio?t.audio={container:"audio/mp4",codec:T,initSegment:c,id:"audio"}:u.video?t.video={container:"video/mp4",codec:E,initSegment:c,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},y.remux=function(c,T,E,u,t){var a=this.initPTS,e=this.lastEndDTS,s={audio:void 0,video:void 0,text:u,id3:E,initSegment:void 0};Object(_.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var l=T.samples;if(!l||!l.length)return s;var n={initPTS:void 0,timescale:1},o=this.initData;if(o&&o.length||(this.generateInitSegment(l),o=this.initData),!o||!o.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(_.isFiniteNumber)(a)||(this.initPTS=n.initPTS=a=m(o,l,e));var v=Object(S.getDuration)(l,o),f=e,g=v+f;Object(S.offsetStartDTS)(o,l,a),v>0?this.lastEndDTS=g:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!o.audio,i=!!o.video,d="";r&&(d+="audio"),i&&(d+="video");var b={data1:l,startPTS:f,startDTS:f,endPTS:g,endDTS:g,type:d,hasAudio:r,hasVideo:i,nb:1,dropped:0};return s.audio=b.type==="audio"?b:void 0,s.video=b.type!=="audio"?b:void 0,s.text=u,s.id3=E,s.initSegment=n,s},A}(),m=function(A,y,c){return Object(S.getStartDTS)(A,y)-c};function p(A,y){var c=A==null?void 0:A.codec;return c&&c.length>4?c:c==="hvc1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||y===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}w.default=C},"./src/task-loop.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function S(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var D=S.prototype;return D.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},D.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},D.onHandlerDestroyed=function(){},D.hasInterval=function(){return!!this._tickInterval},D.hasNextTick=function(){return!!this._tickTimer},D.setInterval=function(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},D.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},D.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},D.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},D.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},D.doTick=function(){},S}()},"./src/types/level.ts":function(N,w,h){function _(p,A){for(var y=0;y<A.length;y++){var c=A[y];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(p,c.key,c)}}var S,D;function R(p,A){var y=p.canSkipUntil,c=p.canSkipDateRanges,T=p.endSN;return y&&(A!==void 0?A-T:0)<y?c?S.v2:S.Yes:S.No}h.r(w),h.d(w,"HlsSkip",function(){return S}),h.d(w,"getSkipValue",function(){return R}),h.d(w,"HlsUrlParameters",function(){return C}),h.d(w,"Level",function(){return m}),(D=S||(S={})).No="",D.Yes="YES",D.v2="v2";var C=function(){function p(A,y,c){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=A,this.part=y,this.skip=c}return p.prototype.addDirectives=function(A){var y=new self.URL(A);return this.msn!==void 0&&y.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&y.searchParams.set("_HLS_part",this.part.toString()),this.skip&&y.searchParams.set("_HLS_skip",this.skip),y.toString()},p}(),m=function(){function p(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}var A,y;return A=p,(y=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(c){var T=c%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}])&&_(A.prototype,y),p}()},"./src/types/loader.ts":function(N,w,h){var _,S,D,R;h.r(w),h.d(w,"PlaylistContextType",function(){return _}),h.d(w,"PlaylistLevelType",function(){return D}),(S=_||(_={})).MANIFEST="manifest",S.LEVEL="level",S.AUDIO_TRACK="audioTrack",S.SUBTITLE_TRACK="subtitleTrack",(R=D||(D={})).MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(N,w,h){h.r(w),h.d(w,"ChunkMetadata",function(){return _});var _=function(S,D,R,C,m,p){C===void 0&&(C=0),m===void 0&&(m=-1),p===void 0&&(p=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=S,this.sn=D,this.id=R,this.size=C,this.part=m,this.partial=p}},"./src/utils/attr-list.ts":function(N,w,h){h.r(w),h.d(w,"AttrList",function(){return D});var _=/^(\d+)x(\d+)$/,S=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,D=function(){function R(m){for(var p in typeof m=="string"&&(m=R.parseAttrList(m)),m)m.hasOwnProperty(p)&&(this[p]=m[p])}var C=R.prototype;return C.decimalInteger=function(m){var p=parseInt(this[m],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},C.hexadecimalInteger=function(m){if(this[m]){var p=(this[m]||"0x").slice(2);p=(1&p.length?"0":"")+p;for(var A=new Uint8Array(p.length/2),y=0;y<p.length/2;y++)A[y]=parseInt(p.slice(2*y,2*y+2),16);return A}return null},C.hexadecimalIntegerAsNumber=function(m){var p=parseInt(this[m],16);return p>Number.MAX_SAFE_INTEGER?1/0:p},C.decimalFloatingPoint=function(m){return parseFloat(this[m])},C.optionalFloat=function(m,p){var A=this[m];return A?parseFloat(A):p},C.enumeratedString=function(m){return this[m]},C.bool=function(m){return this[m]==="YES"},C.decimalResolution=function(m){var p=_.exec(this[m]);if(p!==null)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},R.parseAttrList=function(m){var p,A={};for(S.lastIndex=0;(p=S.exec(m))!==null;){var y=p[2];y.indexOf('"')===0&&y.lastIndexOf('"')===y.length-1&&(y=y.slice(1,-1)),A[p[1]]=y}return A},R}()},"./src/utils/binary-search.ts":function(N,w,h){h.r(w),w.default={search:function(_,S){for(var D=0,R=_.length-1,C=null,m=null;D<=R;){var p=S(m=_[C=(D+R)/2|0]);if(p>0)D=C+1;else{if(!(p<0))return m;R=C-1}}return null}}},"./src/utils/buffer-helper.ts":function(N,w,h){h.r(w),h.d(w,"BufferHelper",function(){return D});var _=h("./src/utils/logger.ts"),S={length:0,start:function(){return 0},end:function(){return 0}},D=function(){function R(){}return R.isBuffered=function(C,m){try{if(C){for(var p=R.getBuffered(C),A=0;A<p.length;A++)if(m>=p.start(A)&&m<=p.end(A))return!0}}catch{}return!1},R.bufferInfo=function(C,m,p){try{if(C){var A,y=R.getBuffered(C),c=[];for(A=0;A<y.length;A++)c.push({start:y.start(A),end:y.end(A)});return this.bufferedInfo(c,m,p)}}catch{}return{len:0,start:m,end:m,nextStart:void 0}},R.bufferedInfo=function(C,m,p){m=Math.max(0,m),C.sort(function(n,o){var v=n.start-o.start;return v||o.end-n.end});var A=[];if(p)for(var y=0;y<C.length;y++){var c=A.length;if(c){var T=A[c-1].end;C[y].start-T<p?C[y].end>T&&(A[c-1].end=C[y].end):A.push(C[y])}else A.push(C[y])}else A=C;for(var E,u=0,t=m,a=m,e=0;e<A.length;e++){var s=A[e].start,l=A[e].end;if(m+p>=s&&m<l)t=s,u=(a=l)-m;else if(m+p<s){E=s;break}}return{len:u,start:t||0,end:a||0,nextStart:E}},R.getBuffered=function(C){try{return C.buffered}catch(m){return _.logger.log("failed to get media.buffered",m),S}},R}()},"./src/utils/cea-608-parser.ts":function(N,w,h){h.r(w),h.d(w,"Row",function(){return s}),h.d(w,"CaptionScreen",function(){return l});var _,S,D=h("./src/utils/logger.ts"),R={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},C=function(g){var r=g;return R.hasOwnProperty(g)&&(r=R[g]),String.fromCharCode(r)},m=15,p=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},y={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},E=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(S=_||(_={}))[S.ERROR=0]="ERROR",S[S.TEXT=1]="TEXT",S[S.WARNING=2]="WARNING",S[S.INFO=2]="INFO",S[S.DEBUG=3]="DEBUG",S[S.DATA=3]="DATA";var u=function(){function g(){this.time=null,this.verboseLevel=_.ERROR}return g.prototype.log=function(r,i){this.verboseLevel>=r&&D.logger.log(this.time+" ["+r+"] "+i)},g}(),t=function(g){for(var r=[],i=0;i<g.length;i++)r.push(g[i].toString(16));return r},a=function(){function g(i,d,b,L,k){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=d||!1,this.italics=b||!1,this.background=L||"black",this.flash=k||!1}var r=g.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(i){for(var d=["foreground","underline","italics","background","flash"],b=0;b<d.length;b++){var L=d[b];i.hasOwnProperty(L)&&(this[L]=i[L])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},r.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),e=function(){function g(i,d,b,L,k,I){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new a(d,b,L,k,I)}var r=g.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(i,d){this.uchar=i,this.penState.copy(d)},r.setPenState=function(i){this.penState.copy(i)},r.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},r.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),s=function(){function g(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var d=0;d<p;d++)this.chars.push(new e);this.logger=i,this.pos=0,this.currPenState=new a}var r=g.prototype;return r.equals=function(i){for(var d=!0,b=0;b<p;b++)if(!this.chars[b].equals(i.chars[b])){d=!1;break}return d},r.copy=function(i){for(var d=0;d<p;d++)this.chars[d].copy(i.chars[d])},r.isEmpty=function(){for(var i=!0,d=0;d<p;d++)if(!this.chars[d].isEmpty()){i=!1;break}return i},r.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>p&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=p)},r.moveCursor=function(i){var d=this.pos+i;if(i>1)for(var b=this.pos+1;b<d+1;b++)this.chars[b].setPenState(this.currPenState);this.setCursor(d)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(i){i>=144&&this.backSpace();var d=C(i);this.pos>=p?this.logger.log(_.ERROR,"Cannot insert "+i.toString(16)+" ("+d+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(i){var d;for(d=i;d<p;d++)this.chars[d].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var i=[],d=!0,b=0;b<p;b++){var L=this.chars[b].uchar;L!==" "&&(d=!1),i.push(L)}return d?"":i.join("")},r.setPenStyles=function(i){this.currPenState.setStyles(i),this.chars[this.pos].setPenState(this.currPenState)},g}(),l=function(){function g(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var d=0;d<m;d++)this.rows.push(new s(i));this.logger=i,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=g.prototype;return r.reset=function(){for(var i=0;i<m;i++)this.rows[i].clear();this.currRow=14},r.equals=function(i){for(var d=!0,b=0;b<m;b++)if(!this.rows[b].equals(i.rows[b])){d=!1;break}return d},r.copy=function(i){for(var d=0;d<m;d++)this.rows[d].copy(i.rows[d])},r.isEmpty=function(){for(var i=!0,d=0;d<m;d++)if(!this.rows[d].isEmpty()){i=!1;break}return i},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(i){this.rows[this.currRow].insertChar(i)},r.setPen=function(i){this.rows[this.currRow].setPenStyles(i)},r.moveCursor=function(i){this.rows[this.currRow].moveCursor(i)},r.setCursor=function(i){this.logger.log(_.INFO,"setCursor: "+i),this.rows[this.currRow].setCursor(i)},r.setPAC=function(i){this.logger.log(_.INFO,"pacData = "+JSON.stringify(i));var d=i.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var b=0;b<m;b++)this.rows[b].clear();var L=this.currRow+1-this.nrRollUpRows,k=this.lastOutputScreen;if(k){var I=k.rows[L].cueStartTime,O=this.logger.time;if(I&&O!==null&&I<O)for(var x=0;x<this.nrRollUpRows;x++)this.rows[d-this.nrRollUpRows+x+1].copy(k.rows[L+x])}}this.currRow=d;var P=this.rows[this.currRow];if(i.indent!==null){var F=i.indent,M=Math.max(F-1,0);P.setCursor(i.indent),i.color=P.chars[M].penState.foreground}var B={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(i){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},r.setRollUpRows=function(i){this.nrRollUpRows=i},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(_.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(i,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(_.INFO,"Rolling up")}else this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(i){i=i||!1;for(var d=[],b="",L=-1,k=0;k<m;k++){var I=this.rows[k].getTextString();I&&(L=k+1,i?d.push("Row "+L+": '"+I+"'"):d.push(I.trim()))}return d.length>0&&(b=i?"["+d.join(" | ")+"]":d.join(`
`)),b},r.getTextAndFormat=function(){return this.rows},g}(),n=function(){function g(i,d,b){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=d,this.mode=null,this.verbose=0,this.displayedMemory=new l(b),this.nonDisplayedMemory=new l(b),this.lastOutputScreen=new l(b),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=b}var r=g.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(i){this.outputFilter=i},r.setPAC=function(i){this.writeScreen.setPAC(i)},r.setBkgData=function(i){this.writeScreen.setBkgData(i)},r.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(_.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},r.insertChars=function(i){for(var d=0;d<i.length;d++)this.writeScreen.insertChar(i[d]);var b=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,b+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(i){this.logger.log(_.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},r.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(i){this.logger.log(_.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},r.ccMIDROW=function(i){var d={flash:!1};if(d.underline=i%2==1,d.italics=i>=46,d.italics)d.foreground="white";else{var b=Math.floor(i/2)-16;d.foreground=["white","green","blue","cyan","red","yellow","magenta"][b]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},r.outputDataUpdate=function(i){i===void 0&&(i=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d):this.cueStartTime=d,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},g}(),o=function(){function g(i,d,b){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new u;this.channels=[null,new n(i,d,L),new n(i+1,b,L)],this.cmdHistory={a:null,b:null},this.logger=L}var r=g.prototype;return r.getHandler=function(i){return this.channels[i].getHandler()},r.setHandler=function(i,d){this.channels[i].setHandler(d)},r.addData=function(i,d){var b,L,k,I=!1;this.logger.time=i;for(var O=0;O<d.length;O+=2)if(L=127&d[O],k=127&d[O+1],L!==0||k!==0){if(this.logger.log(_.DATA,"["+t([d[O],d[O+1]])+"] -> ("+t([L,k])+")"),(b=this.parseCmd(L,k))||(b=this.parseMidrow(L,k)),b||(b=this.parsePAC(L,k)),b||(b=this.parseBackgroundAttributes(L,k)),!b&&(I=this.parseChars(L,k))){var x=this.currentChannel;x&&x>0?this.channels[x].insertChars(I):this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}b||I||this.logger.log(_.WARNING,"Couldn't parse cleaned data "+t([L,k])+" orig: "+t([d[O],d[O+1]]))}},r.parseCmd=function(i,d){var b=this.cmdHistory;if(!((i===20||i===28||i===21||i===29)&&d>=32&&d<=47||(i===23||i===31)&&d>=33&&d<=35))return!1;if(f(i,d,b))return v(null,null,b),this.logger.log(_.DEBUG,"Repeated command ("+t([i,d])+") is dropped"),!0;var L=i===20||i===21||i===23?1:2,k=this.channels[L];return i===20||i===21||i===28||i===29?d===32?k.ccRCL():d===33?k.ccBS():d===34?k.ccAOF():d===35?k.ccAON():d===36?k.ccDER():d===37?k.ccRU(2):d===38?k.ccRU(3):d===39?k.ccRU(4):d===40?k.ccFON():d===41?k.ccRDC():d===42?k.ccTR():d===43?k.ccRTD():d===44?k.ccEDM():d===45?k.ccCR():d===46?k.ccENM():d===47&&k.ccEOC():k.ccTO(d-32),v(i,d,b),this.currentChannel=L,!0},r.parseMidrow=function(i,d){var b=0;if((i===17||i===25)&&d>=32&&d<=47){if((b=i===17?1:2)!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[b];return!!L&&(L.ccMIDROW(d),this.logger.log(_.DEBUG,"MIDROW ("+t([i,d])+")"),!0)}return!1},r.parsePAC=function(i,d){var b,L=this.cmdHistory;if(!((i>=17&&i<=23||i>=25&&i<=31)&&d>=64&&d<=127||(i===16||i===24)&&d>=64&&d<=95))return!1;if(f(i,d,L))return v(null,null,L),!0;var k=i<=23?1:2;b=d>=64&&d<=95?k===1?A[i]:c[i]:k===1?y[i]:T[i];var I=this.channels[k];return!!I&&(I.setPAC(this.interpretPAC(b,d)),v(i,d,L),this.currentChannel=k,!0)},r.interpretPAC=function(i,d){var b,L={color:null,italics:!1,indent:null,underline:!1,row:i};return b=d>95?d-96:d-64,L.underline=(1&b)==1,b<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(b/2)]:b<=15?(L.italics=!0,L.color="white"):L.indent=4*Math.floor((b-16)/2),L},r.parseChars=function(i,d){var b,L,k=null,I=null;if(i>=25?(b=2,I=i-8):(b=1,I=i),I>=17&&I<=19?(L=I===17?d+80:I===18?d+112:d+144,this.logger.log(_.INFO,"Special char '"+C(L)+"' in channel "+b),k=[L]):i>=32&&i<=127&&(k=d===0?[i]:[i,d]),k){var O=t(k);this.logger.log(_.DEBUG,"Char codes =  "+O.join(",")),v(i,d,this.cmdHistory)}return k},r.parseBackgroundAttributes=function(i,d){var b;if(!((i===16||i===24)&&d>=32&&d<=47||(i===23||i===31)&&d>=45&&d<=47))return!1;var L={};i===16||i===24?(b=Math.floor((d-32)/2),L.background=E[b],d%2==1&&(L.background=L.background+"_semi")):d===45?L.background="transparent":(L.foreground="black",d===47&&(L.underline=!0));var k=i<=23?1:2;return this.channels[k].setBkgData(L),v(i,d,this.cmdHistory),!0},r.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var d=this.channels[i];d&&d.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(i){for(var d=0;d<this.channels.length;d++){var b=this.channels[d];b&&b.cueSplitAtTime(i)}},g}();function v(g,r,i){i.a=g,i.b=r}function f(g,r,i){return i.a===g&&i.b===r}w.default=o},"./src/utils/codecs.ts":function(N,w,h){h.r(w),h.d(w,"isCodecType",function(){return S}),h.d(w,"isCodecSupportedInMp4",function(){return D});var _={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function S(R,C){var m=_[C];return!!m&&m[R.slice(0,4)]===!0}function D(R,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function(N,w,h){h.r(w);var _=h("./src/utils/vttparser.ts"),S=h("./src/utils/webvtt-parser.ts"),D=h("./src/utils/texttrack-utils.ts"),R=/\s/,C={newCue:function(m,p,A,y){for(var c,T,E,u,t,a=[],e=self.VTTCue||self.TextTrackCue,s=0;s<y.rows.length;s++)if(E=!0,u=0,t="",!(c=y.rows[s]).isEmpty()){for(var l=0;l<c.chars.length;l++)R.test(c.chars[l].uchar)&&E?u++:(t+=c.chars[l].uchar,E=!1);c.cueStartTime=p,p===A&&(A+=1e-4),u>=16?u--:u++;var n=Object(_.fixLineBreaks)(t.trim()),o=Object(S.generateCueId)(p,A,n);m&&m.cues&&m.cues.getCueById(o)||((T=new e(p,A,n)).id=o,T.line=s+1,T.align="left",T.position=10+Math.min(80,10*Math.floor(8*u/32)),a.push(T))}return m&&a.length&&(a.sort(function(v,f){return v.line==="auto"||f.line==="auto"?0:v.line>8&&f.line>8?f.line-v.line:v.line-f.line}),a.forEach(function(v){return Object(D.addCueToTrack)(m,v)})),a}};w.default=C},"./src/utils/discontinuities.ts":function(N,w,h){h.r(w),h.d(w,"findFirstFragWithCC",function(){return R}),h.d(w,"shouldAlignOnDiscontinuities",function(){return C}),h.d(w,"findDiscontinuousReferenceFrag",function(){return m}),h.d(w,"adjustSlidingStart",function(){return A}),h.d(w,"alignStream",function(){return y}),h.d(w,"alignPDT",function(){return c});var _=h("./src/polyfills/number.ts"),S=h("./src/utils/logger.ts"),D=h("./src/controller/level-helper.ts");function R(T,E){for(var u=null,t=0,a=T.length;t<a;t++){var e=T[t];if(e&&e.cc===E){u=e;break}}return u}function C(T,E,u){return!(!E.details||!(u.endCC>u.startCC||T&&T.cc<u.startCC))}function m(T,E){var u=T.fragments,t=E.fragments;if(t.length&&u.length){var a=R(u,t[0].cc);if(a&&(!a||a.startPTS))return a;S.logger.log("No frag in previous level to align on")}else S.logger.log("No fragments to align")}function p(T,E){if(T){var u=T.start+E;T.start=T.startPTS=u,T.endPTS=u+T.duration}}function A(T,E){for(var u=E.fragments,t=0,a=u.length;t<a;t++)p(u[t],T);E.fragmentHint&&p(E.fragmentHint,T),E.alignedSliding=!0}function y(T,E,u){E&&(function(t,a,e){if(C(t,e,a)){var s=m(e.details,a);s&&Object(_.isFiniteNumber)(s.start)&&(S.logger.log("Adjusting PTS using last level due to CC increase within current level "+a.url),A(s.start,a))}}(T,u,E),!u.alignedSliding&&E.details&&c(u,E.details),u.alignedSliding||!E.details||u.skippedSegments||Object(D.adjustSliding)(E.details,u))}function c(T,E){if(E.fragments.length&&T.hasProgramDateTime&&E.hasProgramDateTime){var u=E.fragments[0].programDateTime,t=T.fragments[0].programDateTime,a=(t-u)/1e3+E.fragments[0].start;a&&Object(_.isFiniteNumber)(a)&&(S.logger.log("Adjusting PTS using programDateTime delta "+(t-u)+"ms, sliding:"+a.toFixed(3)+" "+T.url+" "),A(a,T))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(N,w,h){h.r(w);var _=h("./src/utils/ewma.ts"),S=function(){function D(C,m,p){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=p,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _.default(C),this.fast_=new _.default(m)}var R=D.prototype;return R.update=function(C,m){var p=this.slow_,A=this.fast_;this.slow_.halfLife!==C&&(this.slow_=new _.default(C,p.getEstimate(),p.getTotalWeight())),this.fast_.halfLife!==m&&(this.fast_=new _.default(m,A.getEstimate(),A.getTotalWeight()))},R.sample=function(C,m){var p=(C=Math.max(C,this.minDelayMs_))/1e3,A=8*m/p;this.fast_.sample(p,A),this.slow_.sample(p,A)},R.canEstimate=function(){var C=this.fast_;return C&&C.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},D}();w.default=S},"./src/utils/ewma.ts":function(N,w,h){h.r(w);var _=function(){function S(R,C,m){C===void 0&&(C=0),m===void 0&&(m=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=C,this.totalWeight_=m}var D=S.prototype;return D.sample=function(R,C){var m=Math.pow(this.alpha_,R);this.estimate_=C*(1-m)+m*this.estimate_,this.totalWeight_+=R},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},S}();w.default=_},"./src/utils/fetch-loader.ts":function(N,w,h){h.r(w),h.d(w,"fetchSupported",function(){return y});var _=h("./src/polyfills/number.ts"),S=h("./src/loader/load-stats.ts"),D=h("./src/demux/chunk-cache.ts");function R(u){var t=typeof Map=="function"?new Map:void 0;return(R=function(a){if(a===null||(e=a,Function.toString.call(e).indexOf("[native code]")===-1))return a;var e;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(a))return t.get(a);t.set(a,s)}function s(){return C(a,arguments,A(this).constructor)}return s.prototype=Object.create(a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),p(s,a)})(u)}function C(u,t,a){return(C=m()?Reflect.construct:function(e,s,l){var n=[null];n.push.apply(n,s);var o=new(Function.bind.apply(e,n));return l&&p(o,l.prototype),o}).apply(null,arguments)}function m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(u,t){return(p=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(u,t)}function A(u){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(u)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var c=function(){function u(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||T,this.controller=new self.AbortController,this.stats=new S.LoadStats}var t=u.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(a,e,s){var l=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var o=function(r,i){var d={method:"GET",mode:"cors",credentials:"same-origin",signal:i};return r.rangeEnd&&(d.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),d}(a,this.controller.signal),v=s.onProgress,f=a.responseType==="arraybuffer",g=f?"byteLength":"length";this.context=a,this.config=e,this.callbacks=s,this.request=this.fetchSetup(a,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),s.onTimeout(n,a,l.response)},e.timeout),self.fetch(this.request).then(function(r){if(l.response=l.loader=r,!r.ok){var i=r.status,d=r.statusText;throw new E(d||"fetch, bad network response",i,r)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(r.headers.get("Content-Length")||"0"),v&&Object(_.isFiniteNumber)(e.highWaterMark)?l.loadProgressively(r,n,a,e.highWaterMark,v):f?r.arrayBuffer():r.text()}).then(function(r){var i=l.response;self.clearTimeout(l.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=r[g];var d={url:i.url,data:r};v&&!Object(_.isFiniteNumber)(e.highWaterMark)&&v(n,a,r,i),s.onSuccess(d,n,a,i)}).catch(function(r){if(self.clearTimeout(l.requestTimeout),!n.aborted){var i=r.code||0;s.onError({code:i,text:r.message},a,r.details)}})},t.getCacheAge=function(){var a=null;if(this.response){var e=this.response.headers.get("age");a=e?parseFloat(e):null}return a},t.loadProgressively=function(a,e,s,l,n){l===void 0&&(l=0);var o=new D.default,v=a.body.getReader();return function f(){return v.read().then(function(g){if(g.done)return o.dataLength&&n(e,s,o.flush(),a),Promise.resolve(new ArrayBuffer(0));var r=g.value,i=r.length;return e.loaded+=i,i<l||o.dataLength?(o.push(r),o.dataLength>=l&&n(e,s,o.flush(),a)):n(e,s,r,a),f()}).catch(function(){return Promise.reject()})}()},u}();function T(u,t){return new self.Request(u.url,t)}var E=function(u){var t,a;function e(s,l,n){var o;return(o=u.call(this,s)||this).code=void 0,o.details=void 0,o.code=l,o.details=n,o}return a=u,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,p(t,a),e}(R(Error));w.default=c},"./src/utils/imsc1-ttml-parser.ts":function(N,w,h){h.r(w),h.d(w,"IMSC1_CODEC",function(){return A}),h.d(w,"parseIMSC1",function(){return E});var _=h("./src/utils/mp4-tools.ts"),S=h("./src/utils/vttparser.ts"),D=h("./src/utils/vttcue.ts"),R=h("./src/demux/id3.ts"),C=h("./src/utils/timescale-conversion.ts"),m=h("./src/utils/webvtt-parser.ts");function p(){return(p=Object.assign||function(n){for(var o=1;o<arguments.length;o++){var v=arguments[o];for(var f in v)Object.prototype.hasOwnProperty.call(v,f)&&(n[f]=v[f])}return n}).apply(this,arguments)}var A="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,c=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(n,o,v,f,g){var r=Object(_.findBox)(new Uint8Array(n),["mdat"]);if(r.length!==0){var i=r[0],d=Object(R.utf8ArrayToStr)(new Uint8Array(n,i.start,i.end-i.start)),b=Object(C.toTimescaleFromScale)(o,1,v);try{f(function(L,k){var I=new DOMParser().parseFromString(L,"text/xml").getElementsByTagName("tt")[0];if(!I)throw new Error("Invalid ttml");var O={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(O).reduce(function(U,G){return U[G]=I.getAttribute("ttp:"+G)||O[G],U},{}),P=I.getAttribute("xml:space")!=="preserve",F=t(u(I,"styling","style")),M=t(u(I,"layout","region")),B=u(I,"body","[begin]");return[].map.call(B,function(U){var G=a(U,P);if(!G||!U.hasAttribute("begin"))return null;var K=l(U.getAttribute("begin"),x),H=l(U.getAttribute("dur"),x),Y=l(U.getAttribute("end"),x);if(K===null)throw s(U);if(Y===null){if(H===null)throw s(U);Y=K+H}var W=new D.default(K-k,Y-k,G);W.id=Object(m.generateCueId)(W.startTime,W.endTime,W.text);var q=M[U.getAttribute("region")],Q=F[U.getAttribute("style")];W.position=10,W.size=80;var tt=function(at,X){var J="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(nt,it){var dt=e(X,J,it)||e(at,J,it);return dt&&(nt[it]=dt),nt},{})}(q,Q),rt=tt.textAlign;if(rt){var z=T[rt];z&&(W.lineAlign=z),W.align=rt}return p(W,tt),W}).filter(function(U){return U!==null})}(d,b))}catch(L){g(L)}}else g(new Error("Could not parse IMSC1 mdat"))}function u(n,o,v){var f=n.getElementsByTagName(o)[0];return f?[].slice.call(f.querySelectorAll(v)):[]}function t(n){return n.reduce(function(o,v){var f=v.getAttribute("xml:id");return f&&(o[f]=v),o},{})}function a(n,o){return[].slice.call(n.childNodes).reduce(function(v,f,g){var r;return f.nodeName==="br"&&g?v+`
`:(r=f.childNodes)!==null&&r!==void 0&&r.length?a(f,o):o?v+f.textContent.trim().replace(/\s+/g," "):v+f.textContent},"")}function e(n,o,v){return n.hasAttributeNS(o,v)?n.getAttributeNS(o,v):null}function s(n){return new Error("Could not parse ttml timestamp "+n)}function l(n,o){if(!n)return null;var v=Object(S.parseTimeStamp)(n);return v===null&&(y.test(n)?v=function(f,g){var r=y.exec(f),i=(0|r[4])+(0|r[5])/g.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/g.frameRate}(n,o):c.test(n)&&(v=function(f,g){var r=c.exec(f),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/g.frameRate;case"t":return i/g.tickRate}return i}(n,o))),v}},"./src/utils/logger.ts":function(N,w,h){h.r(w),h.d(w,"enableLogs",function(){return C}),h.d(w,"logger",function(){return m});var _=function(){},S={trace:_,debug:_,log:_,warn:_,info:_,error:_},D=S;function R(p){var A=self.console[p];return A?A.bind(self.console,"["+p+"] >"):_}function C(p){if(self.console&&p===!0||typeof p=="object"){(function(A){for(var y=arguments.length,c=new Array(y>1?y-1:0),T=1;T<y;T++)c[T-1]=arguments[T];c.forEach(function(E){D[E]=A[E]?A[E].bind(A):R(E)})})(p,"debug","log","info","warn","error");try{D.log()}catch{D=S}}else D=S}var m=S},"./src/utils/mediakeys-helper.ts":function(N,w,h){var _,S;h.r(w),h.d(w,"KeySystems",function(){return _}),h.d(w,"requestMediaKeySystemAccess",function(){return D}),(S=_||(_={})).WIDEVINE="com.widevine.alpha",S.PLAYREADY="com.microsoft.playready";var D=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(N,w,h){function _(){return self.MediaSource||self.WebKitMediaSource}h.r(w),h.d(w,"getMediaSource",function(){return _})},"./src/utils/mp4-tools.ts":function(N,w,h){h.r(w),h.d(w,"bin2str",function(){return C}),h.d(w,"readUint16",function(){return m}),h.d(w,"readUint32",function(){return p}),h.d(w,"writeUint32",function(){return A}),h.d(w,"findBox",function(){return y}),h.d(w,"parseSegmentIndex",function(){return c}),h.d(w,"parseInitSegment",function(){return T}),h.d(w,"getStartDTS",function(){return E}),h.d(w,"getDuration",function(){return u}),h.d(w,"computeRawDurationFromSamples",function(){return t}),h.d(w,"offsetStartDTS",function(){return a}),h.d(w,"segmentValidRange",function(){return e}),h.d(w,"appendUint8Array",function(){return s});var _=h("./src/utils/typed-array.ts"),S=h("./src/loader/fragment.ts"),D=Math.pow(2,32)-1,R=[].push;function C(l){return String.fromCharCode.apply(null,l)}function m(l,n){"data"in l&&(n+=l.start,l=l.data);var o=l[n]<<8|l[n+1];return o<0?65536+o:o}function p(l,n){"data"in l&&(n+=l.start,l=l.data);var o=l[n]<<24|l[n+1]<<16|l[n+2]<<8|l[n+3];return o<0?4294967296+o:o}function A(l,n,o){"data"in l&&(n+=l.start,l=l.data),l[n]=o>>24,l[n+1]=o>>16&255,l[n+2]=o>>8&255,l[n+3]=255&o}function y(l,n){var o,v,f,g=[];if(!n.length)return g;"data"in l?(o=l.data,v=l.start,f=l.end):(v=0,f=(o=l).byteLength);for(var r=v;r<f;){var i=p(o,r),d=i>1?r+i:f;if(C(o.subarray(r+4,r+8))===n[0])if(n.length===1)g.push({data:o,start:r+8,end:d});else{var b=y({data:o,start:r+8,end:d},n.slice(1));b.length&&R.apply(g,b)}r=d}return g}function c(l){var n=y(l,["moov"])[0],o=n?n.end:null,v=y(l,["sidx"]);if(!v||!v[0])return null;var f=[],g=v[0],r=g.data[0],i=r===0?8:16,d=p(g,i);i+=4,i+=r===0?8:16,i+=2;var b=g.end+0,L=m(g,i);i+=2;for(var k=0;k<L;k++){var I=i,O=p(g,I);I+=4;var x=2147483647&O;if((2147483648&O)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var P=p(g,I);I+=4,f.push({referenceSize:x,subsegmentDuration:P,info:{duration:P/d,start:b,end:b+x-1}}),b+=x,i=I+=4}return{earliestPresentationTime:0,timescale:d,version:r,referencesCount:L,references:f,moovEndOffset:o}}function T(l){for(var n=[],o=y(l,["moov","trak"]),v=0;v<o.length;v++){var f=o[v],g=y(f,["tkhd"])[0];if(g){var r=g.data[g.start],i=r===0?12:20,d=p(g,i),b=y(f,["mdia","mdhd"])[0];if(b){var L=p(b,i=(r=b.data[b.start])===0?12:20),k=y(f,["mdia","hdlr"])[0];if(k){var I=C(k.data.subarray(k.start+8,k.start+12)),O={soun:S.ElementaryStreamTypes.AUDIO,vide:S.ElementaryStreamTypes.VIDEO}[I];if(O){var x=y(f,["mdia","minf","stbl","stsd"])[0],P=void 0;x&&(P=C(x.data.subarray(x.start+12,x.start+16))),n[d]={timescale:L,type:O},n[O]={timescale:L,id:d,codec:P}}}}}}return y(l,["moov","mvex","trex"]).forEach(function(F){var M=p(F,4),B=n[M];B&&(B.default={duration:p(F,12),flags:p(F,20)})}),n}function E(l,n){return y(n,["moof","traf"]).reduce(function(o,v){var f=y(v,["tfdt"])[0],g=f.data[f.start],r=y(v,["tfhd"]).reduce(function(i,d){var b=p(d,4),L=l[b];if(L){var k=p(f,4);g===1&&(k*=Math.pow(2,32),k+=p(f,8));var I=k/(L.timescale||9e4);if(isFinite(I)&&(i===null||I<i))return I}return i},null);return r!==null&&isFinite(r)&&(o===null||r<o)?r:o},null)||0}function u(l,n){for(var o=0,v=0,f=0,g=y(l,["moof","traf"]),r=0;r<g.length;r++){var i=g[r],d=y(i,["tfhd"])[0],b=n[p(d,4)];if(b){var L=b.default,k=p(d,0)|(L==null?void 0:L.flags),I=L==null?void 0:L.duration;8&k&&(I=p(d,2&k?12:8));for(var O=b.timescale||9e4,x=y(i,["trun"]),P=0;P<x.length;P++)o=I?I*p(x[P],4):t(x[P]),b.type===S.ElementaryStreamTypes.VIDEO?v+=o/O:b.type===S.ElementaryStreamTypes.AUDIO&&(f+=o/O)}}if(v===0&&f===0){var F=c(l);if(F!=null&&F.references)return F.references.reduce(function(M,B){return M+B.info.duration||0},0)}return v||f}function t(l){var n=p(l,0),o=8;1&n&&(o+=4),4&n&&(o+=4);for(var v=0,f=p(l,4),g=0;g<f;g++)256&n&&(v+=p(l,o),o+=4),512&n&&(o+=4),1024&n&&(o+=4),2048&n&&(o+=4);return v}function a(l,n,o){y(n,["moof","traf"]).forEach(function(v){y(v,["tfhd"]).forEach(function(f){var g=p(f,4),r=l[g];if(r){var i=r.timescale||9e4;y(v,["tfdt"]).forEach(function(d){var b=d.data[d.start],L=p(d,4);if(b===0)A(d,4,L-o*i);else{L*=Math.pow(2,32),L+=p(d,8),L-=o*i,L=Math.max(L,0);var k=Math.floor(L/(D+1)),I=Math.floor(L%(D+1));A(d,4,k),A(d,8,I)}})}})})}function e(l){var n={valid:null,remainder:null},o=y(l,["moof"]);if(!o)return n;if(o.length<2)return n.remainder=l,n;var v=o[o.length-1];return n.valid=Object(_.sliceUint8)(l,0,v.start-8),n.remainder=Object(_.sliceUint8)(l,v.start-8),n}function s(l,n){var o=new Uint8Array(l.length+n.length);return o.set(l),o.set(n,l.length),o}},"./src/utils/output-filter.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function S(R,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=C}var D=S.prototype;return D.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},D.newCue=function(R,C,m){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=C,this.screen=m,this.timelineController.createCaptionsTrack(this.trackName)},D.reset=function(){this.cueRanges=[]},S}()},"./src/utils/texttrack-utils.ts":function(N,w,h){h.r(w),h.d(w,"sendAddTrackEvent",function(){return S}),h.d(w,"addCueToTrack",function(){return D}),h.d(w,"clearCurrentCues",function(){return R}),h.d(w,"removeCuesInRange",function(){return C}),h.d(w,"getCuesInRange",function(){return m});var _=h("./src/utils/logger.ts");function S(p,A){var y;try{y=new Event("addtrack")}catch{(y=document.createEvent("Event")).initEvent("addtrack",!1,!1)}y.track=p,A.dispatchEvent(y)}function D(p,A){var y=p.mode;if(y==="disabled"&&(p.mode="hidden"),p.cues&&!p.cues.getCueById(A.id))try{if(p.addCue(A),!p.cues.getCueById(A.id))throw new Error("addCue is failed for: "+A)}catch(T){_.logger.debug("[texttrack-utils]: "+T);var c=new self.TextTrackCue(A.startTime,A.endTime,A.text);c.id=A.id,p.addCue(c)}y==="disabled"&&(p.mode=y)}function R(p){var A=p.mode;if(A==="disabled"&&(p.mode="hidden"),p.cues)for(var y=p.cues.length;y--;)p.removeCue(p.cues[y]);A==="disabled"&&(p.mode=A)}function C(p,A,y){var c=p.mode;if(c==="disabled"&&(p.mode="hidden"),p.cues&&p.cues.length>0)for(var T=m(p.cues,A,y),E=0;E<T.length;E++)p.removeCue(T[E]);c==="disabled"&&(p.mode=c)}function m(p,A,y){var c=[],T=function(a,e){if(e<a[0].startTime)return 0;var s=a.length-1;if(e>a[s].endTime)return-1;for(var l=0,n=s;l<=n;){var o=Math.floor((n+l)/2);if(e<a[o].startTime)n=o-1;else{if(!(e>a[o].startTime&&l<s))return o;l=o+1}}return a[l].startTime-e<e-a[n].startTime?l:n}(p,A);if(T>-1)for(var E=T,u=p.length;E<u;E++){var t=p[E];if(t.startTime>=A&&t.endTime<=y)c.push(t);else if(t.startTime>y)return c}return c}},"./src/utils/time-ranges.ts":function(N,w,h){h.r(w),w.default={toString:function(_){for(var S="",D=_.length,R=0;R<D;R++)S+="["+_.start(R).toFixed(3)+","+_.end(R).toFixed(3)+"]";return S}}},"./src/utils/timescale-conversion.ts":function(N,w,h){function _(C,m,p,A){p===void 0&&(p=1),A===void 0&&(A=!1);var y=C*m*p;return A?Math.round(y):y}function S(C,m,p,A){return p===void 0&&(p=1),A===void 0&&(A=!1),_(C,m,1/p,A)}function D(C,m){return m===void 0&&(m=!1),_(C,1e3,1/9e4,m)}function R(C,m){return m===void 0&&(m=1),_(C,9e4,1/m)}h.r(w),h.d(w,"toTimescaleFromBase",function(){return _}),h.d(w,"toTimescaleFromScale",function(){return S}),h.d(w,"toMsFromMpegTsClock",function(){return D}),h.d(w,"toMpegTsClockFromTimescale",function(){return R})},"./src/utils/typed-array.ts":function(N,w,h){function _(S,D,R){return Uint8Array.prototype.slice?S.slice(D,R):new Uint8Array(Array.prototype.slice.call(S,D,R))}h.r(w),h.d(w,"sliceUint8",function(){return _})},"./src/utils/vttcue.ts":function(N,w,h){h.r(w),w.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var _=["","lr","rl"],S=["start","middle","end","left","right"];function D(p,A){if(typeof A!="string"||!Array.isArray(p))return!1;var y=A.toLowerCase();return!!~p.indexOf(y)&&y}function R(p){return D(S,p)}function C(p){for(var A=arguments.length,y=new Array(A>1?A-1:0),c=1;c<A;c++)y[c-1]=arguments[c];for(var T=1;T<arguments.length;T++){var E=arguments[T];for(var u in E)p[u]=E[u]}return p}function m(p,A,y){var c=this,T={enumerable:!0};c.hasBeenReset=!1;var E="",u=!1,t=p,a=A,e=y,s=null,l="",n=!0,o="auto",v="start",f=50,g="middle",r=50,i="middle";Object.defineProperty(c,"id",C({},T,{get:function(){return E},set:function(d){E=""+d}})),Object.defineProperty(c,"pauseOnExit",C({},T,{get:function(){return u},set:function(d){u=!!d}})),Object.defineProperty(c,"startTime",C({},T,{get:function(){return t},set:function(d){if(typeof d!="number")throw new TypeError("Start time must be set to a number.");t=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",C({},T,{get:function(){return a},set:function(d){if(typeof d!="number")throw new TypeError("End time must be set to a number.");a=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",C({},T,{get:function(){return e},set:function(d){e=""+d,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",C({},T,{get:function(){return s},set:function(d){s=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",C({},T,{get:function(){return l},set:function(d){var b=function(L){return D(_,L)}(d);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",C({},T,{get:function(){return n},set:function(d){n=!!d,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",C({},T,{get:function(){return o},set:function(d){if(typeof d!="number"&&d!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",C({},T,{get:function(){return v},set:function(d){var b=R(d);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",C({},T,{get:function(){return f},set:function(d){if(d<0||d>100)throw new Error("Position must be between 0 and 100.");f=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",C({},T,{get:function(){return g},set:function(d){var b=R(d);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",C({},T,{get:function(){return r},set:function(d){if(d<0||d>100)throw new Error("Size must be between 0 and 100.");r=d,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",C({},T,{get:function(){return i},set:function(d){var b=R(d);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");i=b,this.hasBeenReset=!0}})),c.displayState=void 0}return m.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},m}()},"./src/utils/vttparser.ts":function(N,w,h){h.r(w),h.d(w,"parseTimeStamp",function(){return D}),h.d(w,"fixLineBreaks",function(){return y}),h.d(w,"VTTParser",function(){return c});var _=h("./src/utils/vttcue.ts"),S=function(){function T(){}return T.prototype.decode=function(E,u){if(!E)return"";if(typeof E!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(E))},T}();function D(T){function E(t,a,e,s){return 3600*(0|t)+60*(0|a)+(0|e)+parseFloat(s||0)}var u=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return u?parseFloat(u[2])>59?E(u[2],u[3],0,u[4]):E(u[1],u[2],u[3],u[4]):null}var R=function(){function T(){this.values=Object.create(null)}var E=T.prototype;return E.set=function(u,t){this.get(u)||t===""||(this.values[u]=t)},E.get=function(u,t,a){return a?this.has(u)?this.values[u]:t[a]:this.has(u)?this.values[u]:t},E.has=function(u){return u in this.values},E.alt=function(u,t,a){for(var e=0;e<a.length;++e)if(t===a[e]){this.set(u,t);break}},E.integer=function(u,t){/^-?\d+$/.test(t)&&this.set(u,parseInt(t,10))},E.percent=function(u,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var a=parseFloat(t);if(a>=0&&a<=100)return this.set(u,a),!0}return!1},T}();function C(T,E,u,t){var a=t?T.split(t):[T];for(var e in a)if(typeof a[e]=="string"){var s=a[e].split(u);s.length===2&&E(s[0],s[1])}}var m=new _.default(0,0,""),p=m.align==="middle"?"middle":"center";function A(T,E,u){var t=T;function a(){var s=D(T);if(s===null)throw new Error("Malformed timestamp: "+t);return T=T.replace(/^[^\sa-zA-Z-]+/,""),s}function e(){T=T.replace(/^\s+/,"")}if(e(),E.startTime=a(),e(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);T=T.substr(3),e(),E.endTime=a(),e(),function(s,l){var n=new R;C(s,function(f,g){var r;switch(f){case"region":for(var i=u.length-1;i>=0;i--)if(u[i].id===g){n.set(f,u[i].region);break}break;case"vertical":n.alt(f,g,["rl","lr"]);break;case"line":r=g.split(","),n.integer(f,r[0]),n.percent(f,r[0])&&n.set("snapToLines",!1),n.alt(f,r[0],["auto"]),r.length===2&&n.alt("lineAlign",r[1],["start",p,"end"]);break;case"position":r=g.split(","),n.percent(f,r[0]),r.length===2&&n.alt("positionAlign",r[1],["start",p,"end","line-left","line-right","auto"]);break;case"size":n.percent(f,g);break;case"align":n.alt(f,g,["start",p,"end","left","right"])}},/:/,/\s/),l.region=n.get("region",null),l.vertical=n.get("vertical","");var o=n.get("line","auto");o==="auto"&&m.line===-1&&(o=-1),l.line=o,l.lineAlign=n.get("lineAlign","start"),l.snapToLines=n.get("snapToLines",!0),l.size=n.get("size",100),l.align=n.get("align",p);var v=n.get("position","auto");v==="auto"&&m.position===50&&(v=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=v}(T,E)}function y(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var c=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new S,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=T.prototype;return E.parse=function(u){var t=this;function a(){var o=t.buffer,v=0;for(o=y(o);v<o.length&&o[v]!=="\r"&&o[v]!==`
`;)++v;var f=o.substr(0,v);return o[v]==="\r"&&++v,o[v]===`
`&&++v,t.buffer=o.substr(v),f}u&&(t.buffer+=t.decoder.decode(u,{stream:!0}));try{var e="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(e=a()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var l=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:e=a(),t.state){case"HEADER":/:/.test(e)?C(e,function(o,v){},/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new _.default(0,0,""),t.state="CUE",e.indexOf("-->")===-1){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{A(e,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var n=e.indexOf("-->")!==-1;if(!e||n&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=e;continue;case"BADCUE":e||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){u.onparsingerror&&u.onparsingerror(t)}return u.onflush&&u.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(N,w,h){h.r(w),h.d(w,"generateCueId",function(){return y}),h.d(w,"parseWebVTT",function(){return c});var _=h("./src/polyfills/number.ts"),S=h("./src/utils/vttparser.ts"),D=h("./src/demux/id3.ts"),R=h("./src/utils/timescale-conversion.ts"),C=h("./src/remux/mp4-remuxer.ts"),m=/\r\n|\n\r|\n|\r/g,p=function(T,E,u){return u===void 0&&(u=0),T.substr(u,E.length)===E},A=function(T){for(var E=5381,u=T.length;u;)E=33*E^T.charCodeAt(--u);return(E>>>0).toString()};function y(T,E,u){return A(T.toString())+A(E.toString())+A(u)}function c(T,E,u,t,a,e,s,l){var n,o=new S.VTTParser,v=Object(D.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(m,`
`).split(`
`),f=[],g=Object(R.toMpegTsClockFromTimescale)(E,u),r="00:00.000",i=0,d=0,b=!0,L=!1;o.oncue=function(k){var I=t[a],O=t.ccOffset,x=(i-g)/9e4;if(I!=null&&I.new&&(d!==void 0?O=t.ccOffset=I.start:function(B,U,G){var K=B[U],H=B[K.prevCC];if(!H||!H.new&&K.new)return B.ccOffset=B.presentationOffset=K.start,void(K.new=!1);for(;(Y=H)!==null&&Y!==void 0&&Y.new;){var Y;B.ccOffset+=K.start-H.start,K.new=!1,H=B[(K=H).prevCC]}B.presentationOffset=G}(t,a,x)),x&&(O=x-t.presentationOffset),L){var P=k.endTime-k.startTime,F=Object(C.normalizePts)(9e4*(k.startTime+O-d),9e4*e)/9e4;k.startTime=F,k.endTime=F+P}var M=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(M)),k.id||(k.id=y(k.startTime,k.endTime,M)),k.endTime>0&&f.push(k)},o.onparsingerror=function(k){n=k},o.onflush=function(){n?l(n):s(f)},v.forEach(function(k){if(b){if(p(k,"X-TIMESTAMP-MAP=")){b=!1,L=!0,k.substr(16).split(",").forEach(function(I){p(I,"LOCAL:")?r=I.substr(6):p(I,"MPEGTS:")&&(i=parseInt(I.substr(7)))});try{d=function(I){var O=parseInt(I.substr(-3)),x=parseInt(I.substr(-6,2)),P=parseInt(I.substr(-9,2)),F=I.length>9?parseInt(I.substr(0,I.indexOf(":"))):0;if(!(Object(_.isFiniteNumber)(O)&&Object(_.isFiniteNumber)(x)&&Object(_.isFiniteNumber)(P)&&Object(_.isFiniteNumber)(F)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+I);return O+=1e3*x,(O+=6e4*P)+36e5*F}(r)/1e3}catch(I){L=!1,n=I}return}k===""&&(b=!1)}o.parse(k+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(N,w,h){h.r(w);var _=h("./src/utils/logger.ts"),S=h("./src/loader/load-stats.ts"),D=/^age:\s*[\d.]+\s*$/m,R=function(){function C(p){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=p?p.xhrSetup:null,this.stats=new S.LoadStats,this.retryDelay=0}var m=C.prototype;return m.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},m.abortInternal=function(){var p=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),p&&(p.onreadystatechange=null,p.onprogress=null,p.readyState!==4&&(this.stats.aborted=!0,p.abort()))},m.abort=function(){var p;this.abortInternal(),(p=this.callbacks)!==null&&p!==void 0&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},m.load=function(p,A,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=p,this.config=A,this.callbacks=y,this.retryDelay=A.retryDelay,this.loadInternal()},m.loadInternal=function(){var p=this.config,A=this.context;if(p){var y=this.loader=new self.XMLHttpRequest,c=this.stats;c.loading.first=0,c.loaded=0;var T=this.xhrSetup;try{if(T)try{T(y,A.url)}catch{y.open("GET",A.url,!0),T(y,A.url)}y.readyState||y.open("GET",A.url,!0)}catch(E){return void this.callbacks.onError({code:y.status,text:E.message},A,y)}A.rangeEnd&&y.setRequestHeader("Range","bytes="+A.rangeStart+"-"+(A.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=A.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout),y.send()}},m.readystatechange=function(){var p=this.context,A=this.loader,y=this.stats;if(p&&A){var c=A.readyState,T=this.config;if(!y.aborted&&c>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),c===4){A.onreadystatechange=null,A.onprogress=null;var E=A.status;if(E>=200&&E<300){var u,t;if(y.loading.end=Math.max(self.performance.now(),y.loading.first),t=p.responseType==="arraybuffer"?(u=A.response).byteLength:(u=A.responseText).length,y.loaded=y.total=t,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(y,p,u,A),!this.callbacks)return;var e={url:A.responseURL,data:u};this.callbacks.onSuccess(e,y,p,A)}else y.retry>=T.maxRetry||E>=400&&E<499?(_.logger.error(E+" while loading "+p.url),this.callbacks.onError({code:E,text:A.statusText},p,A)):(_.logger.warn(E+" while loading "+p.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},m.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var p=this.callbacks;p&&(this.abortInternal(),p.onTimeout(this.stats,this.context,this.loader))},m.loadprogress=function(p){var A=this.stats;A.loaded=p.loaded,p.lengthComputable&&(A.total=p.total)},m.getCacheAge=function(){var p=null;if(this.loader&&D.test(this.loader.getAllResponseHeaders())){var A=this.loader.getResponseHeader("age");p=A?parseFloat(A):null}return p},C}();w.default=R}}).default);var Qt=Ie(fe.exports);const Ce={name:"d-icon"},pt=Object.assign(Ce,{props:{icon:String,size:[Number,String]},setup:function(N){const w=N,h=xt(()=>({fontSize:/^\d+$/.test(w.size)?w.size+"px":w.size}));return(_,S)=>($(),Z("i",{class:Ct(["d-icon iconfont",N.icon]),style:wt(j(h))},null,6))}});pt.__scopeId="data-v-0c690e66";Pt("data-v-4cb76d59");const we={class:"d-player-top"},Oe={class:"top-title"},xe={class:"top-title"};Ft();const Pe={props:{title:{default:""}},setup(N){Date.prototype.format=function(_){let S={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var D in S)new RegExp("("+D+")").test(_)&&(_=_.replace(RegExp.$1,RegExp.$1.length==1?S[D]:("00"+S[D]).substr((""+S[D]).length)));return _};let w=Dt("00:00:00");w.value=new Date().format("hh:mm:ss");let h=null;return h=setInterval(()=>{w.value=new Date().format("hh:mm:ss")},1e3),ce(()=>{clearInterval(h)}),(_,S)=>($(),Z("div",we,[V("p",Oe,st(N.title||""),1),V("p",xe,st(j(w)),1)]))},__scopeId:"data-v-4cb76d59"};Pt("data-v-ac2469ec");const Fe={class:"d-status"},Me={class:"d-flex-center"},Ne={class:"d-flex-center"},Be=Tt("5X\u901F\u64AD\u653E\u4E2D ");Ft();var ge=jt({props:["state"],setup:N=>(w,h)=>ht(($(),Z("div",Fe,[ht(V("li",Me,[et(pt,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(N.state.volume==0?"mute":N.state.volume>.5?"up":"down")},null,8,["icon"]),Tt(" "+st(~~(100*N.state.volume))+"% ",1)],512),[[ft,N.state.handleType=="volume"]]),ht(V("li",Ne,[et(pt,{size:"12",icon:"icon-play"}),et(pt,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Be],512),[[ft,N.state.handleType=="playbackRate"||N.state.isMultiplesPlay]])],512)),[[ft,N.state.handleType||N.state.isMultiplesPlay]])});ge.__scopeId="data-v-ac2469ec",Pt("data-v-385f7870");const Ue=["checked","true-value","false-value"],Ge=V("span",{class:"d-switch_action"},null,-1);Ft();var Yt=jt({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(N,{emit:w}){const h=N;ie(R=>({"014e5dc0":N.width,e4e32852:N.activeColor}));const _=Dt(null),S=xt(()=>h.modelValue===h.trueValue),D=()=>{he(()=>{const R=_.value.checked;w("update:modelValue",R),w("change",R)})};return(R,C)=>($(),Z("div",{class:Ct(["d-switch",{"is-checked":j(S)}])},[V("input",{class:"d-switch__input",ref:_,type:"checkbox",checked:j(S),onChange:D,"true-value":N.trueValue,"false-value":N.falseValue},null,40,Ue),Ge],2))}});Yt.__scopeId="data-v-385f7870",Pt("data-v-b2384226");const je={key:0},Ke=V("i",{class:"rotating iconfont icon-loading f50"},null,-1),Ve=[V("i",{class:"rotating iconfont icon-loading f50"},null,-1),V("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],He=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Tt("\u91CD\u65B0\u64AD\u653E ")],We=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Tt("\u8BF7\u6C42\u9519\u8BEF ")];Ft();var ve=jt({props:{loadType:String,text:{type:String,default:""}},setup(N){const w=N,{proxy:h}=Le(),_=["loadstart","waiting","ended","error","stalled"],S=()=>{h.$parent.play()},D=xt(()=>{let R="background: rgba(0, 0, 0, .1);z-index:1";return w.loadType=="loadstart"&&(R="background: rgba(0, 0, 0, 1);;z-index:3"),R});return(R,C)=>ht(($(),Z("div",{class:"d-loading",style:wt(j(D))},[V("div",null,[N.loadType=="loadstart"?($(),Z("span",je,[Ke,V("p",null,st(N.text),1)])):ut("",!0),ht(V("span",null,Ve,512),[[ft,N.loadType=="waiting"]]),ht(V("span",null,[V("p",{onClick:S,class:"d-flex-x d-pointer"},He)],512),[[ft,N.loadType=="ended"]]),ht(V("span",null,[V("p",{onClick:S,class:"d-flex-x d-pointer"},We)],512),[[ft,N.loadType=="error"||N.loadType=="stalled"]])])],4)),[[ft,_.includes(N.loadType)]])}});ve.__scopeId="data-v-b2384226";const Ot=function(N,w,h,_=!1){N&&w&&h&&N.addEventListener(w,h,_)},ct=function(N,w,h,_=!1){N&&w&&h&&N.removeEventListener(w,h,_)};Pt("data-v-5a794390");const Ye=["onMousedown"];Ft();var Gt=jt(re(ee({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(N,{emit:w}){const h=N;ie(t=>({"5242b67b":N.size}));const _=Dt(null),S=Dt(null),D=qt({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),R=xt(()=>{let t=h.modelValue<0?0:h.modelValue>1?1:h.modelValue;return h.vertical?`height:${100*t}%`:`width:${100*t}%`}),C=xt(()=>{let t=h.preload<0?0:h.preload>1?1:h.preload;return h.vertical?`height:${100*t}%`:`width:${100*t}%`}),m=xt(()=>{let t=D.hoverPosition<0?0:D.hoverPosition>1?1:D.hoverPosition;return h.vertical?`bottom:${100*t}%`:`left:${100*t}%`}),p=t=>{t.preventDefault()},A=t=>{h.disabled||(t.preventDefault(),D.dragging=!0,c(t),Ot(window,"mousemove",E),Ot(window,"touchmove",E),Ot(window,"mouseup",u),Ot(window,"touchend",u))},y=t=>{if(!h.hover)return;let a=T(t);if(w("onMousemove",t,a),D.hoverPosition=a,h.vertical)return;let e=_.value,s=S.value.clientWidth/2,l=t.clientX-e.getBoundingClientRect().left;l<s?D.hoverTipsLeft=s-l+"px":e.clientWidth-l<s?D.hoverTipsLeft=e.clientWidth-l-s+"px":D.hoverTipsLeft="50%"},c=t=>{let a=T(t);w("update:modelValue",a),w("change",t,a)},T=t=>{let a=_.value,e=0;if(h.vertical){let s=a.clientHeight;e=(a.getBoundingClientRect().bottom-t.clientY)/s}else e=(t.clientX-a.getBoundingClientRect().left)/a.clientWidth;return e<0?0:e>1?1:e},E=t=>{c(t)},u=t=>{D.dragging&&(ct(window,"mousemove",E),ct(window,"touchmove",E),ct(window,"mouseup",u),ct(window,"touchend",u),ct(window,"contextmenu",u),setTimeout(()=>{D.dragging=!1},0))};return(t,a)=>($(),Z("div",{ref:_,class:Ct(["d-slider",{"is-vertical":h.vertical}]),onMousedown:be(A,["stop"]),onContextmenu:p},[V("div",{class:"d-slider__runway",onMousemove:y},[ht(V("div",{class:"d-slider__cursor",style:wt(j(m))},[ht(V("div",{class:"d-slider__tips",ref:S,style:wt({left:j(D).hoverTipsLeft})},st(h.hoverText),5),[[ft,h.hoverText]])],4),[[ft,h.hover]]),V("div",{class:"d-slider__preload",style:wt(j(C))},null,4),V("div",{class:"d-slider__bar",style:wt(j(R))},null,4)],32)],42,Ye))}}));Gt.__scopeId="data-v-5a794390";Pt("data-v-570fa0d1");const qe={key:0,class:"d-player-dialog"},Xe={class:"d-player-dialog-body"},ze={class:"d-player-dialog-title"},$e={class:"d-player-hotkey-panel"},Qe={class:"d-player-filter-panel"},Ze={class:"d-player-filter-panel-item"},Je=V("span",null,"\u9971\u548C\u5EA6",-1),tr={class:"d-player-filter-panel-item"},er=V("span",null,"\u4EAE\u5EA6",-1),rr={class:"d-player-filter-panel-item"},ir=V("span",null,"\u5BF9\u6BD4\u5EA6",-1),nr={key:0,class:"d-player-contextmenu"},ar=["dplayerKeyCode"],sr=V("input",{class:"d-player-copyText"},null,-1);Ft();var pe=jt({setup(N){const w=qt({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.5",mouseX:0,mouseY:0}),h=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.5",key:"version"}],_=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],S=qt({saturate:.392,brightness:.392,contrast:.392}),D=xt(()=>({left:w.mouseX+"px",top:w.mouseY+"px"}));ue(S,A=>{let y=document.querySelector("#dPlayerVideo"),c=(2.55*A.saturate).toFixed(2),T=(2.55*A.brightness).toFixed(2),E=(2.55*A.contrast).toFixed(2);y.style.filter=`saturate(${c}) brightness(${T}) contrast(${E})`});const R=()=>{S.saturate=.392,S.brightness=.392,S.contrast=.392},C=A=>{A.key=="Escape"&&p(0)},m=A=>{A.preventDefault(),Ot(window,"keydown",C),Ot(window,"click",p);let y=document.querySelector("#refPlayerWrap"),c=y.clientWidth;y.clientHeight,w.mouseX=A.clientX-y.getBoundingClientRect().left,c-w.mouseX<130&&(w.mouseX=w.mouseX+(c-w.mouseX-130)),w.mouseY=A.clientY-y.getBoundingClientRect().top,w.show=!0},p=A=>{let y=A.path[0].tagName=="LI",c=A.path[0].attributes.dplayerKeyCode&&A.path[0].attributes.dplayerKeyCode.value,T=h.map(E=>E.key);if(y&&T.includes(c))if(w.dialogTitle=A.path[0].innerText,w.dialogType=c,c=="copy"){let E=document.querySelector(".d-player-copyText");E.value=window.location.href,E.select(),document.execCommand("copy"),w.dialogType=""}else c=="version"&&(w.dialogType="");w.show=!1,ct(window,"keydown",C),ct(window,"click",p)};return de(()=>{let A=document.querySelector("#refPlayerWrap");ct(window,"keydown",C),ct(window,"click",p),ct(A,"contextmenu",m),Ot(A,"contextmenu",m)}),ce(()=>{let A=document.querySelector("#refPlayerWrap");ct(window,"keydown",C),ct(window,"click",p),ct(A,"contextmenu",m)}),(A,y)=>($(),Z("div",null,[et(te,{name:"d-fade-in"},{default:Jt(()=>[j(w).dialogType?($(),Z("div",qe,[V("div",Xe,[V("h5",ze,[Tt(st(j(w).dialogTitle)+" ",1),V("i",{onClick:y[0]||(y[0]=c=>j(w).dialogType=!1),class:"icon icon-close"},"X")]),ht(V("ul",$e,[($(),Z(Xt,null,zt(_,c=>V("li",{class:"d-player-hotkey-panel-item",key:c.key},[V("span",null,st(c.key),1),V("span",null,st(c.label),1)])),64))],512),[[ft,j(w).dialogType=="hotkey"]]),ht(V("ul",Qe,[V("li",Ze,[Je,et(Gt,{class:"filter-panel-slider",size:"5px",modelValue:j(S).saturate,"onUpdate:modelValue":y[1]||(y[1]=c=>j(S).saturate=c)},null,8,["modelValue"]),V("span",null,st(Math.round(255*j(S).saturate)),1)]),V("li",tr,[er,et(Gt,{class:"filter-panel-slider",size:"5px",modelValue:j(S).brightness,"onUpdate:modelValue":y[2]||(y[2]=c=>j(S).brightness=c)},null,8,["modelValue"]),V("span",null,st(Math.round(255*j(S).brightness)),1)]),V("li",rr,[ir,et(Gt,{class:"filter-panel-slider",size:"5px",modelValue:j(S).contrast,"onUpdate:modelValue":y[3]||(y[3]=c=>j(S).contrast=c)},null,8,["modelValue"]),V("span",null,st(Math.round(255*j(S).contrast)),1)]),V("span",{onClick:R,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[ft,j(w).dialogType=="filter"]])])])):ut("",!0)]),_:1}),j(w).show?($(),Z("div",nr,[V("ul",{class:"d-player-contextmenu-body",style:wt(j(D))},[($(),Z(Xt,null,zt(h,c=>V("li",{dplayerKeyCode:c.key,key:c.key},st(c.label),9,ar)),64))],4),sr])):ut("",!0)]))}});pe.__scopeId="data-v-570fa0d1";const Zt=N=>{let w=~~(N/3600),h=~~(N%3600/60),_=~~(N%60);return w=w<10?"0"+w:w,h=h<10?"0"+h:h,_=_<10?"0"+_:_,`${w}:${h}:${_}`},Wt="ontouchstart"in window,le=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],or={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};Pt("data-v-38736a38");const lr={class:"d-player-video",id:"dPlayerVideo"},ur=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],dr={class:"d-player-lightoff"},cr={key:1,class:"d-player-state"},hr={class:"d-play-btn"},fr=["onKeyup","onKeydown"],gr={class:"d-control-progress"},vr={class:"d-tool-bar"},pr={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},mr=V("span",{style:{margin:"0 3px"}},"/",-1),yr={class:"total-time"},Er={class:"d-tool-bar"},Tr={key:0,class:"d-tool-item quality-btn"},Sr={class:"d-tool-item-main"},br={class:"speed-main",style:{"text-align":"center"}},Lr=["onClick"],Ar={key:1,class:"d-tool-item speedRate-btn"},Dr={class:"d-tool-item-main"},kr={class:"speed-main"},Rr=["onClick"],_r={key:2,class:"d-tool-item volume-btn"},Ir={class:"d-tool-item-main volume-box",style:{width:"52px"}},Cr={class:"volume-text-size"},wr={key:3,class:"d-tool-item setting-btn"},Or={class:"d-tool-item-main"},xr={class:"speed-main"},Pr=Tt(" \u955C\u50CF\u753B\u9762 "),Fr=Tt(" \u5FAA\u73AF\u64AD\u653E "),Mr=Tt(" \u5173\u706F\u6A21\u5F0F "),Nr=V("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Br=V("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Ur=V("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Ft();var $t=jt(re(ee({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:or,emits:[...le,"mirrorChange","loopChange","lightOffChange"],setup:function(N,{expose:w,emit:h}){const _=N;ie(I=>({"700c8c00":j(c),"714b73c2":I.width,"0a1f83ee":I.height}));const S=Dt(null),D=Dt(null),R=Dt(null),C=Dt(null),m=qt(re(ee({dVideo:null},_),{muted:_.muted,playBtnState:_.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),p=(...I)=>O=>I.reverse().reduce((x,P)=>P(x),O),A=le.reduce((I,O)=>{var x;return I[`on${x=O,x.charAt(0).toUpperCase()+x.slice(1)}`]=P=>{m.loadStateType=O,h(O,P)},I},{});A.onCanplay=p(A.onCanplay,()=>{m.playBtnState!="play"&&m.dVideo.play(),m.autoPlay&&(m.dVideo.play(),m.playBtnState="pause")}),A.onEnded=p(A.onEnded,()=>{m.playBtnState="replay"}),A.onDurationchange=I=>{h("durationchange",I),_.currentTime!=0&&(m.dVideo.currentTime=_.currentTime),A.onTimeupdate(I)},A.onProgress=I=>{console.log("\u7F13\u51B2\u4E2D..."),h("progress",I);let O=I.target.duration,x=I.target.buffered,P=I.target.buffered.length&&I.target.buffered.end(x-1);m.preloadBar=P/O},A.onTimeupdate=I=>{h("timeupdate",I);let O=I.duration||I.target.duration||0,x=I.currentTime||I.target.currentTime;m.playProgress=x/O,m.currentTime=Zt(x),m.totalTime=Zt(O)},A.onError=p(A.onError,()=>{m.playBtnState="replay"});let y=Ee();for(let I in y)A[I]=y[I];const c=(T=m.color,`${parseInt("0x"+T.slice(1,3))},${parseInt("0x"+T.slice(3,5))},${parseInt("0x"+T.slice(5,7))}`);var T;const E=oe(500,()=>{m.handleType=""}),u=I=>{I.preventDefault(),I.code=="ArrowUp"?m.volume=m.volume+.1>1?1:m.volume+.1:m.volume=m.volume-.1<0?0:m.volume-.1,m.muted=!1,m.handleType="volume",E()},t=I=>{_.speed&&(m.dVideo.currentTime=m.dVideo.currentTime<10?.1:m.dVideo.currentTime-10,A.onTimeupdate(m.dVideo),s())},a=I=>{I.preventDefault();let O=I.type;if(I.key=="ArrowRight"){if(s(),O=="keyup"){if(clearTimeout(m.longPressTimeout),!_.speed&&!m.longPressTimeout)return;m.isMultiplesPlay?(m.dVideo.playbackRate=m.speedActive,m.isMultiplesPlay=!1):(m.dVideo.currentTime=m.dVideo.currentTime+10,A.onTimeupdate(m.dVideo))}else if(O=="keydown"){if(!_.speed)return;m.isMultiplesPlay&&clearTimeout(m.longPressTimeout),m.longPressTimeout=setTimeout(()=>{m.isMultiplesPlay=!0,m.dVideo.playbackRate=5,m.handleType="playbackRate",E()},500)}}},e=()=>{Wt||C.value.focus()},s=()=>{m.loadStateType="play",m.dVideo.play().catch(()=>{setTimeout(()=>{m.playBtnState="replay",m.loadStateType="error"},500)}),m.playBtnState="pause"},l=()=>{m.dVideo.pause(),m.playBtnState="play"},n=I=>{I&&I.preventDefault(),m.playBtnState=="play"||m.playBtnState=="replay"?s():m.playBtnState=="pause"&&l()},o=()=>{m.muted=!m.muted,m.volume==0&&(m.volume=.05)},v=(I,O)=>{let x=m.dVideo.duration||m.dVideo.target.duration;m.dVideo.currentTime=x*O,m.playBtnState=="play"&&(m.dVideo.play(),m.playBtnState="pause")},f=(I,O)=>{m.progressCursorTime=Zt(m.dVideo.duration*O)},g=oe(2500,()=>{m.isVideoHovering=!1}),r=I=>{m.isVideoHovering=!0,g()},i=I=>{h("mirrorChange",I,m.dVideo)},d=I=>{h("loopChange",I,m.dVideo)},b=I=>{h("lightOffChange",I,m.dVideo)},L=()=>{var I;I=m.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(O=>{console.log(O,"Video failed to leave Picture-in-Picture mode.")}):I.requestPictureInPicture().catch(O=>{console.log(O,"Video failed to enter Picture-in-Picture mode.")})},k=()=>{m.fullScreen=(I=>{let O=document,x=O.webkitIsFullScreen||O.fullscreen;return x?(document.exitFullscreen||O.webkitExitFullScreen).call(O):(I.requestFullscreen||I.webkitRequestFullScreen).call(I),!x})(S.value)};return ue(()=>_.src,()=>{he(()=>{(()=>{if(m.dVideo.canPlayType(_.type)||m.dVideo.canPlayType("application/vnd.apple.mpegurl"))m.muted=_.autoPlay;else if(Qt.isSupported()){const I=new Qt({fragLoadingTimeOut:2e3});I.detachMedia(),I.attachMedia(m.dVideo),I.on(Qt.Events.MEDIA_ATTACHED,()=>{I.loadSource(_.src),I.on("hlsManifestParsed",(O,x)=>{console.log(x),m.currentLevel=x.level,m.qualityLevels=x.levels||[]})}),I.on("hlsLevelSwitching",(O,x)=>{console.log(x),console.log("LEVEL_SWITCHING")}),I.on("hlsLevelSwitched",(O,x)=>{m.currentLevel=x.level,console.log("LEVEL_SWITCHED")})}})()})},{immediate:!0}),de(()=>{m.dVideo=D,e()}),w({play:s,pause:l,togglePlay:n}),(I,O)=>($(),Z("div",{ref:S,id:"refPlayerWrap",class:Ct(["d-player-wrap",{"web-full-screen":j(m).webFullScreen,"is-lightoff":j(m).lightOff,"d-player-wrap-hover":j(m).playBtnState=="play"||j(m).isVideoHovering}]),onMousemove:r},[V("div",lr,[V("video",Te({ref:D,class:["d-player-video-main",{"video-mirror":j(m).mirror}],id:"dPlayerVideoMain",controls:!(!j(Wt)||!j(m).speed),"webkit-playsinline":_.playsinline,playsinline:_.playsinline},j(A),{volume:j(m).volume,muted:j(m).muted,loop:j(m).loop,preload:I.preload,width:"100%",height:"100%",src:_.src,poster:_.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,ur)]),et(te,{name:"d-fade-in"},{default:Jt(()=>[ht(V("div",dr,null,512),[[ft,j(m).lightOff]])]),_:1}),j(m).fullScreen?($(),Se(Pe,{key:0,title:_.title},null,8,["title"])):ut("",!0),j(Wt)?ut("",!0):($(),Z("div",cr,[et(te,{name:"d-scale-out"},{default:Jt(()=>[ht(V("div",hr,[et(pt,{icon:"icon-play",size:40})],512),[[ft,j(m).playBtnState=="play"]])]),_:1}),et(ge,{state:j(m)},null,8,["state"])])),j(Wt)?ut("",!0):($(),Z("input",{key:2,type:"input",readonly:"readonly",ref:C,onDblclick:k,onKeyup:[Ht(k,["f"]),O[0]||(O[0]=Ht(x=>j(m).webFullScreen=!1,["esc"])),a],onClick:n,onKeydown:[Ht(n,["space"]),Ht(t,["arrow-left"]),Ht(u,["arrow-up","arrow-down"]),a],class:"d-player-input",maxlength:"0"},null,40,fr)),et(ve,{loadType:j(m).loadStateType},null,8,["loadType"]),et(pe),!j(Wt)&&j(m).control?($(),Z("div",{key:3,class:"d-player-control",ref:R},[V("div",gr,[et(Gt,{class:"d-progress-bar",onOnMousemove:f,onChange:v,disabled:!j(m).speed,hoverText:j(m).progressCursorTime,modelValue:j(m).playProgress,"onUpdate:modelValue":O[1]||(O[1]=x=>j(m).playProgress=x),preload:j(m).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),V("div",{class:"d-control-tool",onClick:e},[V("div",vr,[V("div",{class:"d-tool-item",onClick:n},[et(pt,{size:"24",icon:`icon-${j(m).playBtnState}`},null,8,["icon"])]),_.controlBtns.includes("audioTrack")?($(),Z("div",pr,[V("span",null,st(j(m).currentTime),1),mr,V("span",yr,st(j(m).totalTime),1)])):ut("",!0)]),V("div",Er,[j(m).qualityLevels.length&&_.controlBtns.includes("quality")?($(),Z("div",Tr,[Tt(st(j(m).qualityLevels.length&&(j(m).qualityLevels[j(m).currentLevel]||{}).height)+"P ",1),V("div",Sr,[V("ul",br,[($(!0),Z(Xt,null,zt(j(m).qualityLevels,(x,P)=>($(),Z("li",{class:Ct({"speed-active":j(m).currentLevel==P}),onClick:F=>((M,B)=>{Hls.currentLevel=B,m.currentLevel=B})(0,P),key:x},st(x.height)+"P",11,Lr))),128))])])])):ut("",!0),_.controlBtns.includes("speedRate")?($(),Z("div",Ar,[Tt(st(j(m).speedActive=="1.0"?"\u500D\u901F":j(m).speedActive+"x")+" ",1),V("div",Dr,[V("ul",kr,[($(!0),Z(Xt,null,zt(j(m).speedRate,x=>($(),Z("li",{class:Ct({"speed-active":j(m).speedActive==x}),onClick:P=>(F=>{m.speedActive=F,m.dVideo.playbackRate=F})(x),key:x},st(x)+"x",11,Rr))),128))])])])):ut("",!0),_.controlBtns.includes("volume")?($(),Z("div",_r,[V("div",Ir,[V("div",{class:Ct(["volume-main",{"is-muted":j(m).muted}])},[V("span",Cr,st(j(m).muted?0:~~(100*j(m).volume))+"%",1),et(Gt,{onChange:O[2]||(O[2]=x=>j(m).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:j(m).volume,"onUpdate:modelValue":O[3]||(O[3]=x=>j(m).volume=x)},null,8,["modelValue"])],2)]),V("span",{onClick:o,style:{display:"flex"}},[et(pt,{size:"20",icon:"icon-volume-"+(j(m).volume==0||j(m).muted?"mute":j(m).volume>.5?"up":"down")},null,8,["icon"])])])):ut("",!0),_.controlBtns.includes("setting")?($(),Z("div",wr,[et(pt,{size:"20",class:"rotateHover",icon:"icon-settings"}),V("div",Or,[V("ul",xr,[V("li",null,[Pr,et(Yt,{onChange:i,modelValue:j(m).mirror,"onUpdate:modelValue":O[4]||(O[4]=x=>j(m).mirror=x)},null,8,["modelValue"])]),V("li",null,[Fr,et(Yt,{onChange:d,modelValue:j(m).loop,"onUpdate:modelValue":O[5]||(O[5]=x=>j(m).loop=x)},null,8,["modelValue"])]),V("li",null,[Mr,et(Yt,{onChange:b,modelValue:j(m).lightOff,"onUpdate:modelValue":O[6]||(O[6]=x=>j(m).lightOff=x)},null,8,["modelValue"])])])])])):ut("",!0),_.controlBtns.includes("pip")?($(),Z("div",{key:4,class:"d-tool-item pip-btn",onClick:L},[et(pt,{size:"20",icon:"icon-pip"}),Nr])):ut("",!0),_.controlBtns.includes("pageFullScreen")?($(),Z("div",{key:5,class:"d-tool-item pip-btn",onClick:O[7]||(O[7]=x=>j(m).webFullScreen=!j(m).webFullScreen)},[et(pt,{size:"20",icon:"icon-web-screen"}),Br])):ut("",!0),_.controlBtns.includes("fullScreen")?($(),Z("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:k},[Ur,et(pt,{size:"20",icon:"icon-screen"})])):ut("",!0)])])],512)):ut("",!0)],34))}}));function Gr(N){N.component($t.name,$t)}$t.__scopeId="data-v-38736a38",$t.install=Gr;export{$t as g};
